// This file was generated by modules-webmake (modules for web) project.
// See: https://github.com/medikoo/modules-webmake

(function (modules) {
	'use strict';

	var resolve, getRequire, wmRequire, notFoundError, findFile
	  , extensions = {".js":[],".json":[],".css":[],".html":[]}
	  , envRequire = typeof require === 'function' ? require : null;

	notFoundError = function (path) {
		var error = new Error("Could not find module '" + path + "'");
		error.code = 'MODULE_NOT_FOUND';
		return error;
	};
	findFile = function (scope, name, extName) {
		var i, ext;
		if (typeof scope[name + extName] === 'function') return name + extName;
		for (i = 0; (ext = extensions[extName][i]); ++i) {
			if (typeof scope[name + ext] === 'function') return name + ext;
		}
		return null;
	};
	resolve = function (scope, tree, path, fullPath, state, id) {
		var name, dir, exports, module, fn, found, ext;
		path = path.split('/');
		name = path.pop();
		if ((name === '.') || (name === '..')) {
			path.push(name);
			name = '';
		}
		while ((dir = path.shift()) != null) {
			if (!dir || (dir === '.')) continue;
			if (dir === '..') {
				scope = tree.pop();
				id = id.slice(0, id.lastIndexOf('/'));
			} else {
				tree.push(scope);
				scope = scope[dir];
				id += '/' + dir;
			}
			if (!scope) throw notFoundError(fullPath);
		}
		if (name && (typeof scope[name] !== 'function')) {
			found = findFile(scope, name, '.js');
			if (!found) found = findFile(scope, name, '.json');
			if (!found) found = findFile(scope, name, '.css');
			if (!found) found = findFile(scope, name, '.html');
			if (found) {
				name = found;
			} else if ((state !== 2) && (typeof scope[name] === 'object')) {
				tree.push(scope);
				scope = scope[name];
				id += '/' + name;
				name = '';
			}
		}
		if (!name) {
			if ((state !== 1) && scope[':mainpath:']) {
				return resolve(scope, tree, scope[':mainpath:'], fullPath, 1, id);
			}
			return resolve(scope, tree, 'index', fullPath, 2, id);
		}
		fn = scope[name];
		if (!fn) throw notFoundError(fullPath);
		if (fn.hasOwnProperty('module')) return fn.module.exports;
		exports = {};
		fn.module = module = { exports: exports, id: id + '/' + name };
		fn.call(exports, exports, module, getRequire(scope, tree, id));
		return module.exports;
	};
	wmRequire = function (scope, tree, fullPath, id) {
		var name, path = fullPath, t = fullPath.charAt(0), state = 0;
		if (t === '/') {
			path = path.slice(1);
			scope = modules['/'];
			if (!scope) {
				if (envRequire) return envRequire(fullPath);
				throw notFoundError(fullPath);
			}
			id = '/';
			tree = [];
		} else if (t !== '.') {
			name = path.split('/', 1)[0];
			scope = modules[name];
			if (!scope) {
				if (envRequire) return envRequire(fullPath);
				throw notFoundError(fullPath);
			}
			id = name;
			tree = [];
			path = path.slice(name.length + 1);
			if (!path) {
				path = scope[':mainpath:'];
				if (path) {
					state = 1;
				} else {
					path = 'index';
					state = 2;
				}
			}
		}
		return resolve(scope, tree, path, fullPath, state, id);
	};
	getRequire = function (scope, tree, id) {
		return function (path) {
			return wmRequire(scope, [].concat(tree), path, id);
		};
	};
	return getRequire(modules, [], '');
})({
	"workspace": {
		"editor": {
			"js": {
				"editor": {
					"src": {
						"compat.js": function (exports, module, require) {
							/**
							 * Backwards-compatibility related functionality - transform old elements, update old elements etc
							 */
							(function ( $ ) {
								module.exports = {
									/**
									 * Executed on domready
									 */
									dom_ready: function () {
										this.texts();
										this.rows();
									},
									/**
									 * Searches all "old-style" texts in the page (or in the $root element) and merges every adjacent inline text into a text block
									 *
									 * @param {jQuery} [$root]
									 */
									texts: function ( $root ) {
										$root = $root || $( '#tve_editor' );
										/* old text elements selector */
										var TEXT_ = TVE.ELEM.text,
											HEADINGS_ = TVE.ELEM.headings,
											wrap = '<div class="thrv_wrapper thrv_text_element"></div>',
											wrap_headings = '<div class="thrv_wrapper thrv_heading"></div>',
											$elements = $root.find( TEXT_ ).not( TVE.TEXT_INLINE ).not( '.thrv_custom_html_shortcode *, .tve_wp_shortcode *, .thrive-shortcode-html *, .tve_scT *' ),
											$group = $(),
											$current,
											is_heading;
										while ( $elements.length ) {
											$group = $current = $elements.first();
											while ( $current.next().is( TEXT_ ) ) {
												$group = $group.add( $group.next() );
												$current = $current.next();
											}
											$elements = $elements.not( $group );
											/**
											 * each heading will be wrapped in a heading element
											 * @type {any}
											 */
											is_heading = $group.length === 1 && $group.is( HEADINGS_ );
											if ( is_heading ) {
												if ( ! $current.parent().is( TVE.TEXT_HEADINGS + ',' + TVE.TEXT_BLOCK ) ) {
													$group.wrap( wrap_headings );
												}
												continue;
											}
											if ( ! $current.parent().is( '.thrv_text_element' ) ) {
												$group.wrapAll( wrap );
											}
										}
										/**
										 * Handle the Click-Tweet Label
										 */
										$elements = $root.find( '.thrv_tw_qs_button span span' );
										$elements.addClass( 'thrv-inline-text tve_editable' );

									},
									/**
									 * Search for all the old rows and wrap the columns in a separate div so we can apply styles on it and not on the wrapper
									 *
									 * @param {jQuery} [$root]
									 */
									rows: function ( $root ) {
										$root = $root || $( '#tve_editor' );

										$root.find( '.tcb-flex-row.thrv_wrapper' ).each( function ( index, row ) {
											var $row = $( row );

											$row.removeClass( 'thrv_wrapper' );
											$row.wrap( '<div class="thrv_wrapper thrv-columns"></div>' );
										} );

										/* make sure columns contain an inner .tcb-col element */
										$root.find( '.tcb-flex-col' ).each( function () {
											var $column = $( this ),
												$row = $column.parent();
											if ( ! $column.children( '.tcb-col' ).length ) {
												$column.children( '.col-empty' ).remove();
												$column.children().not( '.ui-resizable-handle' ).wrapAll( '<div class="tcb-col"></div>' );
											}

											if ( $row.hasClass( 'tve-flex-end' ) ) {
												$row.addClass( 'tcb-flex-end' ).removeClass( 'tve-flex-end' );
											} else if ( $row.hasClass( 'tve-flex-center' ) ) {
												$row.addClass( 'tcb-flex-center' ).removeClass( 'tve-flex-center' );
											} else if ( $row.hasClass( 'tve-flex-start' ) ) {
												$row.removeClass( 'tve-flex-start' );
											}
										} );
									},
									/**
									 * Compatible mode - insert CSS rule in the stylesheet
									 *
									 * @param {String} selector
									 * @param {String} rules
									 * @param {Number} index
									 */
									insert_css_rule: function ( selector, rules, index ) {
										for ( var i = 0, _rule; _rule = TVE.stylesheet.cssRules[i ++]; ) {
											if ( _rule.selectorText === selector ) {
												rules = _rule.style.cssText + rules;
												TVE.stylesheet.deleteRule( i );
												break;
											}
										}
										TVE.stylesheet.insertRule( selector + "{" + rules + "}", index );
									},
									/**
									 * Gets the CSS rules defined for the selector
									 * @param {String} data_tve_custom_colour old-style css id selector ( [data-tve-custom-colour="xxx"] )
									 *
									 * @returns {String}
									 */
									get_css_rules: function ( data_tve_custom_colour ) {
										for ( var i = 0, _rule; _rule = TVE.stylesheet.cssRules[i ++]; ) {
											if ( _rule.type === CSSRule.STYLE_RULE ) {
												if ( _rule.cssText && _rule.selectorText && _rule.selectorText.indexOf( 'data-tve-custom-colour="' + data_tve_custom_colour ) !== - 1 ) {
													return _rule.cssText;
												}
											}
										}

										return '';
									}
								};
							})( jQuery );
						},
						"drag.js": function (exports, module, require) {
							/**
							 * Thrive Themes - https://thrivethemes.com
							 *
							 * @package thrive-visual-editor
							 *
							 * handles drag & drop events / insert elements into the editor content
							 *  -> from the side control panel into the editor content
							 *  -> sort elements from within the editor content
							 *  -> add elements when clicking them in the side control panel menu
							 *  -> resize flexbox columns
							 *
							 */
							(function ( $ ) {
								/* elements that should be sortable */
								var droppable_targets = '.thrv_wrapper:not(.canvas-mode,.thrv-styled_list *), p:not(.thrv_custom_html_shortcode p, .wp-caption p), .tve-draggable:not(.canvas-mode), .tve_lp_header, .tve_lp_content, .tve_lp_footer, ' +
								                        //	                        TVE.ELEM.headings.split( ',' ).map( function ( item ) {
								                        //		                        return item + ':not(.thrv_heading ' + item + ')'
								                        //	                        } ).join( ',' ) +
								                        'ul,ol,address,blockquote'.split( ',' ).map( function ( item ) {
									                        return '.thrv_text_element ' + item;
								                        } ).join( ',' ),
									draggable_elements = '.thrv_wrapper,.tve-draggable',
									/* selector for elements that should not be draggable by themselves */
									non_draggable = '.tve_no_drag, .thrive_leads_shortcode *, .thrive_ultimatum_shortcode *, .tve_faqB *, .tve_wp_shortcode *, .thrv_bullets_shortcode ul, .thrv_tw_qs *, .thrv_post_grid *, .thrv_custom_html_shortcode *, .thrv_widget *, .thrv_widget_menu *, .tve_w_menu, .tve_w_menu *, .tve_lg_input_container *,.thrive-shortcode-html *',
									/* jQuery selector for elements that should contain a dropzone if empty (for example columns - so that users can drop elements into an empty column.) */
									dropzone_elements = '.tve_colm, .tve_colm .tve_grt, .tve_faqC, td, th, .fwi, .tve_content_inner, .thrv_content_reveal, .tve_scTC, .cck, .tve_empty_dropzone:not(.tcb-flex-col), .tcb-col, #tve_editor, .tve-cb, .tve_lp_content',
									/* elements that cannot be dropped next to each other, or elements that do now allow drop to their left / right sides */
									side_drop_forbidden = '.thrv_page_section, .thrv-page-section, .tve-page-section-in, .thrv-columns.tcb-elem-placeholder, .tcb-window-w, .tve_lp_content',
									$dragged_element = null,
									scroller = null,
									isCtrl = false,
									handle = {},
									$document,
									$body,
									default_handle_size = 4,
									$previous_dragged_over = $(),
									$clone = $(),
									is_draggable = function ( $element ) {
										if ( $element.is( get_non_draggable() ) ) {
											return false;
										}

										return $element.is( get_draggable_elements() );
									},
									get_non_draggable = function () {

										return TVE.apply_filters( 'non_draggable', non_draggable );
									},
									get_draggable_elements = function () {

										return TVE.apply_filters( 'draggable_elements', draggable_elements );
									},
									get_droppable_targets = function () {
										return TVE.apply_filters( 'droppable_targets', droppable_targets );
									},
									not_draggable = function ( $element ) {
										return $element.is( get_non_draggable() );
									},
									allow_dragenter = function ( $elem ) {
										if ( ! $elem.length ) {
											return false;
										}
										if ( $elem[0].id === 'tve-drop-handle' ) {
											return true;
										}
										return TVE.apply_filters( 'allow_dragenter', $elem.is( get_droppable_targets() ) && ! $elem.is( '.tve_wp_shortcode *' ), $elem );
									},
									allow_dragover = function ( $elem ) {
										if ( $elem[0].id === 'tve-drop-handle' ) {
											return false;
										}

										return allow_dragenter( $elem );
									},
									should_have_dropzone = function ( $elem ) {
										return $elem.is( dropzone_elements );
									},
									/**
									 * empty elements that allow other elements to be dropped next to them
									 * @param $elem
									 */
									allow_drop_near = function ( $elem ) {
										var cls = $elem[0].className.toString();

										return cls.indexOf( 'tve-page-section-in' ) !== - 1 ||
										       cls.indexOf( 'tve-cb' ) !== - 1 ||
										       cls.indexOf( 'tve_reveal_container' ) !== - 1;
									},
									/**
									 * faster implementation of hasClass - just search the string through the className string
									 * ! Do not rely on this method to get exact results. Example: has_class( '<div class="some_class123">', 'some_class') will return true (!)
									 * @param {Node} elem
									 * @param {string} cls
									 * @returns {boolean}
									 */
									has_class = function ( elem, cls ) {
										if ( ! elem || ! elem.className || ! elem.className.indexOf ) {
											return false;
										}
										return elem.className.indexOf( cls ) !== - 1;
									},
									is_disabled = function () {
										var is_canvas_mode = $root && $root.is( '.canvas-mode' );
										return TVE.Editor_Page.STATE === 'disabled' && ! is_canvas_mode;
									},
									/**
									 * Some elements cannot be dropped inside other elements, just in the main content area (#tve_editor)
									 * Examples: Background sections, Full widths columns
									 */
									drop_forbidden = function () {
										var forbidden = '.thrv-page-section, .tcb-window-width';

										return ( $dragged_element && $dragged_element.is( forbidden ) ) || ( TVE.main.dragged_elem && TVE.main.dragged_elem.type === 'section' );
									},
									$dragged_over = null,
									$root = null,
									draggable = {
										init: function () {
											$document = TVE.inner.$document;
											$body = $( document.body );

											/* enable page scroll on drag events */
											scroller = this.page_scroll( tve_path_params.post_type === 'tcb_lightbox' ? '#tve-p-scroller' : 'body' );
											window.$tve_drag_handle = $( '<div id="tve-drag-handle" class="no-blur" draggable="true"></div>' ).appendTo( 'body' );
											$clone = $( '<div id="tve-drag-clone"></div>' ).appendTo( $body );

											$document.add( TVE.$document ).on( 'keydown', this.keydown ).on( 'keyup', this.keyup );
										},
										/**
										 * Insert element when clicking one of the control panel elements
										 *
										 * @param element
										 */
										insert_from_parent: function ( element ) {
											TVE.Editor_Page.enable();
											TVE.Editor_Page.blur();
											this.fetch( element, this.get_available_target() );
											$body.removeClass( 'tve-empty-placeholder' );
										},
										keydown: function ( e ) {
											if ( ! isCtrl && e.ctrlKey ) {
												isCtrl = true;
											}
										},
										keyup: function ( e ) {
											isCtrl = false;
										},
										body_class: function () {
											// in Chrome - the browser prevents dragging of elements "behind" the top and bottom scroll zones - we need to show those after a short delay
											requestAnimationFrame( function () {
												$body.addClass( 'tve-dragging' );
											} );
										},
										/**
										 * handles mouseover the elements and shows the drag handle for each element
										 *
										 * @param $elem
										 *
										 * @returns {boolean}
										 */
										handle_mouseover: function ( $elem ) {
											if ( ! TVE.allow_drag() || ! TVE.state_manager.is_default() ) {
												return false;
											}
											if ( ! is_draggable( $elem ) ) {
												return false;
											}

											window.$tve_drag_handle.show();
											window.$tve_drag_handle.data( 'el', $elem );

											window.$tve_drag_handle[$elem.is( TVE.ActiveElement ) ? 'addClass' : 'removeClass']( 'tve-selected' );
										},
										/**
										 * Completely hide the drag handle
										 */
										hide_handle: function () {
											window.$tve_drag_handle.hide();
										},
										/**
										 * drag events only applied on #tve_editor element
										 */
										editorActions: function ( $elem ) {
											handle.page_init();

											TVE.Editor_Page.editor.find( get_draggable_elements() ).not( get_non_draggable() ).addClass( 'tve-draggable' );
											TVE.Editor_Page.editor.find( get_droppable_targets() ).addClass( 'tve-droppable' );

											if ( $elem ) {

												$root = $elem;

												TVE.Editor_Page.editor.parent().off( 'dragenter.tcb dragleave.tcb dragover.tcb drop.tcb' );
												$body.off( 'drop.tcb dragover.tcb ' );

												$root.off().add( handle.$el )
													.on( 'dragenter.tcb', this.dragenter )
													.on( 'dragleave.tcb', this.dragleave )
													.on( 'dragover.tcb', this.dragover )
													.on( 'drop.tcb', this.drop );

											} else {

												$root && $root.off( 'dragenter.tcb dragleave.tcb dragover.tcb drop.tcb' );
												$root = null;

												TVE.Editor_Page.editor.add( handle.$el )
													.off( 'dragenter.tcb dragleave.tcb dragover.tcb drop.tcb' )
													.on( 'dragenter.tcb', this.dragenter )
													.on( 'dragleave.tcb', this.dragleave )
													.on( 'dragover.tcb', this.dragover )
													.on( 'drop.tcb', this.drop );

												$body
													.off( 'dragstart.tcb' ).on( 'dragstart.tcb', '#tve-drag-handle', this.dragstart )
													.off( 'dragend.tcb' ).on( 'dragend.tcb', '#tve-drag-handle', this.dragend )
													.off( 'drop.tcb' ).on( 'drop.tcb', this.drop )
													.off( 'dragover.tcb' ).on( 'dragover.tcb', this.dragover_body );
											}

											return this.refresh();
										},
										/**
										 * get the compatible dropzone for creating the new element
										 * this is called on click on the menu items from the side control panel
										 */
										get_available_target: function () {
											var $current = $( '.edit_mode' ),
												$target;
											handle.data( 'dir', 'bottom' );
											/* 1. search for the element being edited */
											if ( $current.length === 0 ) {
												/* 2. if no element is in edit mode, append new element to the end of the editor ( or the main editable area ) */
												$current = TVE.Editor_Page.editor.find( '.tve_editor_main_content' ).first();
												if ( ! $current.length ) {
													$current = TVE.Editor_Page.editor;
												}
												handle.data( 'dir', 'mid' );
												$target = $current.children().last();
												if ( $target.length ) {
													$current = $target;
													handle.data( 'dir', 'bottom' );
												}
												var st = TVE.inner.$window.scrollTop();
												if ( $current.offset().top + $current.height() > TVE.inner.$window.height() + st ) {
													$( 'html,body' ).animate( {
														scrollTop: $current.offset().top + $current.height()
													} );
												}
											}
											handle.data( 'tt', $current );
											return $current;
										},
										/**
										 * drag events handling
										 * start drag - fired when user starts dragging an element
										 */
										dragstart: function ( e ) {
											if ( ! TVE.allow_drag() || is_disabled() ) {
												return false;
											}

											$dragged_element = window.$tve_drag_handle.data( 'el' );
											if ( not_draggable( $dragged_element ) ) {
												$dragged_element = null;
												return false;
											}
											$( '#tcb-el-icons .tcb-icon' ).hide();
											$( '#tcb-el-name' ).hide();
											TVE.state( TVE.STATE_DRAG );
											TVE.froala.disable( $dragged_element );
											$dragged_element.addClass( 'tve-dragged' ).removeClass( 'active_delete active_duplicate' );

											draggable.body_class();

											e.stopPropagation();
											e.originalEvent.dataTransfer.setData( 'text/plain', '' );

											/**
											 * create the draggable image
											 */
											$clone.empty().append( $dragged_element.clone() );
											e.originalEvent.dataTransfer.setDragImage( $clone[0], $clone.width() / 2, 10 );

											if ( $dragged_element.is( side_drop_forbidden ) ) {
												handle.force_limit_vertical = true;
											}
										},
										/**
										 * called when the user starts dragging an element from the main frame (from the control panel)
										 *
										 * @param {object} elem_data
										 */
										main_drag_start: function ( elem_data ) {
											TVE.state( TVE.STATE_DRAG );
											draggable.body_class();
											/* if the element that is dragged is not allowed to be dropped next to other elements, setup the flag */
											if ( elem_data.static_element ) {
												var $elem = elem_data.static_element;
												if ( $elem.length && $elem.children().first().is( side_drop_forbidden ) ) {
													handle.force_limit_vertical = true;
												}
											}
										},
										/**
										 * end drag - fired when user stops dragging elements
										 *
										 * this = the element being dragged
										 *
										 * @param {Boolean} [skip_trigger] whether or not to skip triggering the event further
										 */
										dragend: function ( skip_trigger ) {
											TVE.state( TVE.STATE_DEFAULT );

											$body.removeClass( 'tve-dragging' );
											$( '.tve-dragged' ).removeClass( 'tve-dragged' );
											$( '.tve-dragged-over' ).removeClass( 'tve-dragged-over' );
											$dragged_element = null;
											$dragged_over = null;
											handle.reset();
											scroller.hide();
											if ( typeof skip_trigger !== 'undefined' && skip_trigger === true ) {
												TVE.main.child_drag_end();
											}
										},
										/**
										 * fired when the user dragging operation enters a dropzone
										 *
										 * this = the dropzone element
										 */
										dragenter: function ( e ) {
											if ( ! $dragged_element && ! TVE.main.dragged_elem ) {
												return;
											}
											/**
											 * Do not handle dragenter on the drop handle
											 */
											if ( e.target.id === 'tve-drop-handle' ) {
												return;
											}

											handle.limit_vertical = handle.force_limit_vertical;
											handle.data( 'append', false );
											// highlight potential drop target when the draggable element enters it
											if ( e.target.id === 'tve-drop-handle' ) {
												draggable.cancel_dragleave = true;
												return false;
											}

											$dragged_over = $( e.target );
							//				If this is commented out it allows referencing flex columns as drop targets. If users complain about something not working as before, these should be un-commented :)
							//				if ( has_class( e.target, 'tcb-flex-col' ) ) {
							//					if ( $dragged_over.children( droppable_targets ).length !== 0 ) {
							//						$dragged_over = $dragged_over.parent(); // the ROW
							//						handle.limit_vertical = true;
							//					}
							//				}

											/**
											 * do not allow dragging over children of the dragged element
											 */
											if ( $dragged_element && $.contains( $dragged_element[0], $dragged_over[0] ) ) {
												$dragged_over = null;
												return;
											}

											/**
											 * Some elements can only be dropped inside the main content area
											 */
											if ( drop_forbidden() ) {
												$dragged_over = $dragged_over.closest( TVE.Editor_Page.editor.children( droppable_targets ) );
												if ( ! $dragged_over.length ) {
													$dragged_over = TVE.Editor_Page.editor;
												}
											}

											if ( e.target.id === 'tve_editor' ) {
												var children;
												if ( e.pageY < TVE.Editor_Page.editor.offset().top + 30 && (children = TVE.Editor_Page.editor.children( droppable_targets )).length ) {
													$dragged_over = children.first();
												}
											}
											delete handle.dropzone_element;
											if ( ! allow_dragenter( $dragged_over ) ) {
												if ( should_have_dropzone( $dragged_over ) && $dragged_over.children( get_droppable_targets() ).length === 0 ) {
													if ( allow_drop_near( $dragged_over ) ) {
														handle.dropzone_element = true;
														if ( $dragged_over.is( side_drop_forbidden ) ) {
															handle.limit_vertical = true;
														}
													} else {
														handle.position_mid( $dragged_over );
													}
													e.preventDefault();
													$previous_dragged_over.removeClass( 'tve-dragged-over' );
													$dragged_over.addClass( 'tve-dragged-over' );

													return false;
												}
												// this causes some issues with nested elements: if you dragleave a paragraph which is in a container, the container receives the dragenter event
												// and the drop handle will be placed outside of the container
												if ( $dragged_over.children( get_droppable_targets() ).length < 2 ) {
													$dragged_over = $dragged_over.closest( get_droppable_targets() );
												}
											}

											if ( ! allow_dragenter( $dragged_over ) ) {
												$dragged_over = null;
												return;
											}

											handle.last_dir = null;
											e.preventDefault();
											$previous_dragged_over.removeClass( 'tve-dragged-over' );
											$previous_dragged_over = $dragged_over;
											$dragged_over.addClass( 'tve-dragged-over' );

											if ( $dragged_over.is( side_drop_forbidden ) ) {
												handle.limit_vertical = true;
											}

											handle.can_position_mid = should_have_dropzone( $dragged_over ) && $dragged_over.children( droppable_targets ).length === 0;

											return false;
										},
										/**
										 * fired on drag operation over a dropzone
										 *
										 * this = the dropzone element
										 *
										 * @param e the drag event
										 */
										dragover: function ( e ) {
											e.preventDefault(); // Necessary. Allows us to drop.
											if ( ! $dragged_over ) {
												return;
											}
											if ( ! allow_dragover( $dragged_over ) && ! handle.dropzone_element ) {
												return;
											}
											// do not allow drop on children of the dragged element
											if ( $dragged_element && $.contains( $dragged_element[0], $dragged_over[0] ) ) {
												return;
											}

											handle.position( $dragged_over, e );
											$dragged_over.addClass( 'tve-dragged-over' );

											return false;
										},
										/**
										 * fired on dragover on the body element. this is to allow dropping if there is a drop handle active
										 *
										 * @param e the drag event
										 */
										dragover_body: function ( e ) {
											if ( ! handle || ! handle.data( 'tt' ) ) {
												return;
											}
											e.preventDefault();

											return false;
										},
										/**
										 * fired whe the drag operation leaves a dropzone
										 */
										dragleave: function ( e ) {
											/* when dragging over a drop handle - skip the dragleave event */
											if ( draggable.cancel_dragleave ) {
												delete draggable.cancel_dragleave;
												return false;
											}
											var $target = $( e.target );
											if ( handle.data( 'dir' ) !== 'mid' ) {
												$target.removeClass( 'tve-dragged-over' );
											}
											if ( handle.is( ':visible' ) ) {
												$target.removeClass( 'tve-dragged-over' );
											}
											handle.last_dir = null;
											return false;
										},
										/**
										 * fired when the user makes a drop on a dropzone
										 * this = dropzone
										 * @param e drop event
										 */
										drop: function ( e ) {
											// prevent default action (open as link for some elements)
											e.preventDefault();
											e.stopPropagation();
											if ( ! TVE.main.dragged_elem && ! $dragged_element || ! handle.data( 'tt' ) || ! handle.data( 'tt' )[0] ) {
												return false;
											}
											if ( $dragged_element ) {
												var allow_drop = TVE.apply_filters( 'allow_drop', true, [$dragged_element, handle] );
												if ( ! allow_drop ) {
													return false;
												}
											}

											if ( $dragged_element && $.contains( $dragged_element[0], handle.data( 'tt' )[0] ) ) {
												return;
											}

											$body.removeClass( 'tve-dragging tve-empty-placeholder' );

											$dragged_element && $dragged_element.removeClass( 'tve-dragged' );
											handle.hide();

											scroller.hide();
											/** dragged from the parent frame **/
											if ( TVE.main.dragged_elem ) {
												draggable.fetch( TVE.main.dragged_elem, handle.data( 'tt' ) );
											} else {
												draggable.insert( $dragged_element, handle.data( 'tt' ) );
											}

											$dragged_element = null;
											draggable.dragend();
											return false;
										},
										/**
										 * bind draggable events on the $html itself and also on all its children that can be matched by the sortable_elements filter
										 *
										 * @param $html
										 */
										bind_draggable: function ( $html ) {
											$html.add( $html.find( get_draggable_elements() ) ).filter( get_draggable_elements() ).not( get_non_draggable() ).addClass( 'tve-draggable' );
											$html.add( $html.find( get_droppable_targets() ) ).filter( get_droppable_targets() ).addClass( 'tve-droppable' );
										},
										/**
										 * refresh empty dropzone elements
										 */
										refresh: function () {
											TVE.Editor_Page.editor.find( get_droppable_targets() ).each( function () {
												if ( has_class( this.parentNode, 'tcb-flex-col' ) ) {
													return true;
												}
												this.parentNode.classList.add( 'tve_empty_dropzone' );
											} ).end().find( 'a,img' ).attr( 'draggable', 'false' );
											resizable.bind();
											$( '#tve-drag-clone' ).remove();
										},
										/**
										 * Fetch element from DOM (template) and insert it into the page
										 *
										 * @param {object} element element data built from the menu item
										 * @param {jQuery} $target element or dropzone
										 */
										fetch: function ( element, $target ) {
											if ( this.before_fetch( element, $target ) === false ) {
												return false;
											}

											var type = element.type;

											/**
											 * If a JS renderer exists for the element
											 */
											if ( TVE.renderers[type] ) {
												draggable.insert( TVE.renderers[type].render_default(), $target, false, false, true );
												return true;
											}
											var found = TVE.main.static_element( type );
											if ( found.length <= 0 ) {
												return false;
											}

											var copy = found.first().clone();
											copy.find( '.tve_countdown_timer_evergreen' ).attr( 'data-id', 'evergreen_' + Math.floor( Math.random() * 10000 ) ); // countdown timers
											draggable.insert( copy.html(), $target, false, false, true );

											return true;
										},

										/**
										 * triggered before adding elements to the editor
										 * you can return false from this to cancel the ajax request
										 *
										 * @param {object} element data built from the cpanel menu link
										 * @param {jQuery} $target where is the element being inserted
										 */
										before_fetch: function ( element, $target ) {
											var allow = true;

											// user templates come from the database, not external files, so must be handled separately
											if ( element.data && element.data.usertpl ) {
												this.load_template( element.data.key, $target );
												allow = false;
											} else if ( element.type ) {
												TVE.main.trigger( 'insert_element', element );
												if ( element.prevent_insert ) {
													allow = false;
												}
											}

											return allow;
										},
										/**
										 * called after the fetched html code has been inserted into the editor
										 *
										 * @param {jQuery} $inserted_html
										 */
										after_fetch: function ( $inserted_html ) {
											if ( $inserted_html.hasClass( 'thrv_content_container_shortcode' ) ) {
												$inserted_html.parent().addClass( 'tve_clearfix' );
											} else if ( $inserted_html.hasClass( 'thrv_countdown_timer' ) ) {
												if ( $inserted_html.hasClass( 'tve_countdown_timer_evergreen' ) ) {
													$inserted_html.tve_countdown_timer_evergreen().update();
												} else {
													$inserted_html.tve_countdown_timer().update();
												}
											} else if ( $inserted_html.find( '.tve_vtabs' ).length ) {
												$inserted_html.tve_tabs().resize();
											} else if ( $inserted_html.hasClass( 'thrv_lead_generation' ) ) {
												//TODO: review this and implement if still needed
												//$inserted_html.tve_lead_generation().applyStyle( 'thrv_lead_generation_vertical' );
											} else if ( $inserted_html.hasClass( 'thrv_social_default' ) ) {
												TVE_Content_Builder.social.onDefaultInsert( $inserted_html );
											}
											TVE.apply_filters( 'element_drop', $inserted_html );
										},
										/**
										 * insert new element into page and re-initialize the drag events on the inserted content
										 * @param response
										 * @param {jQuery} $target either editable element, or dropzone
										 * @param {boolean} [append] optional, if true, it will append the element to the $target
										 * @param {boolean} [replace] optional - if true, it will replace $target with $element
										 * @param {boolean} [is_cpanel_element] optional, truthy value -> it will trigger the after_fetch event - used to render some default styles / html stuff for elements dragged from the control panel
										 *
										 * @return jQuery jQuery wrapper over the inserted html
										 */
										insert: function ( response, $target, append, replace, is_cpanel_element ) {
											append = typeof append === 'undefined' ? false : append;
											replace = typeof replace === 'undefined' ? false : replace;
											TVE.Editor_Page.before_action();
											TVE.Editor_Page.disable();

											var $new_html = $( response );
											if ( append ) { // case: Custom HTML placeholder, tables
												$target.html( $new_html );
												if ( $new_html.hasClass( 'tve_table' ) ) { // TODO: I think this should be re-written ?
													$new_html = $new_html.parent();
												}
											} else if ( replace ) {
												// case: replace target with new element
												$target.replaceWith( $new_html );
											} else {
												// element dropped next to another element
												this.insert_near( $new_html, $target, handle.data( 'dir' ) );
											}

											this.bind_draggable( $new_html );
											if ( typeof is_cpanel_element !== 'undefined' && is_cpanel_element ) {
												draggable.after_fetch( $new_html );
											}

											draggable.after_drop( $new_html );

											/* wait for the animations to finish */
											setTimeout( function () {
												TVE.Editor_Page.after_action();
												draggable.refresh();

												/** If there is a placeholder action to be performed, perform that action */
												if ( $new_html.hasClass( 'tcb-elem-placeholder' ) ) {
													$new_html.children( '.tcb-inline-placeholder-action' ).first().trigger( 'click' );
												}
											}, 400 );

											if ( ! TVE.prevent_blur ) {
												TVE.Editor_Page.enable();
												TVE.Editor_Page.blur();
											}

											return $new_html;
										},
										/**
										 * called each time an element is dropped
										 * @param $element
										 *
										 * @returns {void}
										 */
										after_drop: function ( $element ) {
											var dom_element = $element[0];
											if ( has_class( dom_element, 'thrv_social_default' ) ) {
												TVE_Content_Builder.social.onDefaultDrop( $element );
												return;
											}
										},
										/**
										 * insert element next to another element ( top, right, bottom, left )
										 * @param {jQuery} $new_element
										 * @param {jQuery} $target
										 * @param {string} dir
										 */
										insert_near: function ( $new_element, $target, dir ) {
											var same_target = $new_element[0] === $target[0],
												$col;
											//if the element has been taken from the editor, remove the empty column in which it sits (if this is the case)
											if ( $dragged_element ) {
												$col = $new_element.parent();
											}
											/**
											 * case: user drops something in between text items ( p, h1, h2 etc ) in a Text Block element
											 * Split the text element into 2 separate parts - before target and after target (depending on the direction)
											 */
											if ( $target.hasClass( 'thrv_text_element' ) || $target.is( '.thrv_text_element *' ) ) {
												if ( $new_element.hasClass( 'thrv_text_element' ) ) {
													if ( dir === 'top' || dir === 'bottom' ) {
														$new_element.detach();
														$new_element = $new_element.children();
														if ( $target.hasClass( 'thrv_text_element' ) ) {
															$target = dir === 'top' ? $target.find( droppable_targets ).first() : $target.find( droppable_targets ).last();
														}
													} else {
														$target = $target.closest( '.thrv_text_element' );
													}
												} else {
													var $prev = $target.prevAll(),
														$next = $target.nextAll(),
														$text_block = $target.closest( '.thrv_text_element' );

													if ( handle.data( 'dir' ) === 'top' && $prev.length ) { // wrap all prev elements into a .thrv_text_element div
														$prev.wrapAll( '<div class="thrv_wrapper thrv_text_element"></div>' );
														$text_block.before( $prev.parent() );
													} else if ( handle.data( 'dir' ) === 'bottom' && $next.length ) {
														$next.wrapAll( '<div class="thrv_wrapper thrv_text_element"></div>' );
														$text_block.after( $next.parent() );
													}
													$target = $text_block;
												}
											}
											switch ( dir ) {
												case 'mid':
													if ( same_target ) {
														return;
													}
													$target.append( $new_element );
													break;
												case 'top':
													if ( same_target ) {
														return;
													}
													$target.before( $new_element );
													break;
												case 'bottom':
													if ( same_target ) {
														return;
													}
													$target.after( $new_element );
													break;
												case 'right':
												case 'left':
													var $row,
														fn,
														$subject,
														$parent = $new_element.parent();
													if ( same_target && $parent.children().length === 1 ) {
														return;
													}
													/* case: user drops something on the left / right side of a row. Do not create new columns in this case */
													if ( has_class( $target[0], 'thrv-columns' ) ) {
														/* we need to change the target to the row <div> */
														$target = $target.find( '.tcb-flex-row' ).first();
														$subject = $target.children( '.tcb-flex-col' )[dir === 'right' ? 'last' : 'first']();
														fn = dir === 'right' ? 'after' : 'before';
													} else if ( has_class( $target[0].parentNode.parentNode, 'tcb-flex-col' ) ) {
														$subject = $target.closest( '.tcb-flex-col' );
														fn = dir === 'right' ? 'after' : 'before';
													} else {
														if ( same_target ) {
															return;
														}
														$target.wrap( '<div class="thrv_wrapper thrv-columns tve-draggable"><div class="tcb-flex-row"></div></div>' );
														$target.wrap( '<div class="tcb-flex-col"></div>' ).wrap( '<div class="tcb-col"></div>' );
														fn = dir === 'right' ? 'append' : 'prepend';
														$subject = $target.closest( '.tcb-flex-row' );
													}
													/* create the new column element */
													$new_element.wrap( '<div class="tcb-flex-col"></div>' ).wrap( '<div class="tcb-col"></div>' );
													$row = $target.closest( '.tcb-flex-row' );
													$subject[fn]( $new_element.closest( '.tcb-flex-col' ) );
													if ( $row.hasClass( 'tcb-resized' ) ) {
														$row.removeClass( 'tcb-resized' );
														$row.children().head_css( {
															'max-width': ''
														}, '_ALL' );
													} else if ( $row[0].className.search( 'tve-flex-wrap-[d|t|m](?!-)' ) !== - 1 ) {
														$new_element.parent().head_css_copy( $subject );
													}
													$row.children().removeClass( 'c-25 c-33 c-50 c-66 c-75' );
													break;
											}
											$new_element.addClass( 'tve-dropped' );
											setTimeout( function () {
												$new_element.removeClass( 'tve-dropped' );
											}, 200 );

											/* remove empty column */
											this.ensure_column_placeholder( $col );
											this.row_class( $new_element.parents( '.tcb-flex-row' ).first() )
											this.bind_draggable( $new_element );
										},
										/**
										 * triggered after an element is duplicated
										 * we need to create a dropzone between the original element and the cloned element
										 * @param element
										 * @param clone
										 */
										after_clone: function ( element, clone ) {
											this.bind_draggable( clone );

											if ( clone.hasClass( 'thrv_social_default' ) ) {
												TVE_Content_Builder.social.onDefaultDrop( clone );
											}
											this.refresh();
										},
										/**
										 * Triggered after removing an element - check if the parent element is an empty flex column - if yes, remove it
										 * @param {jQuery} parent jquery parent of the element that has been removed
										 */
										after_remove: function ( parent ) {
											draggable.ensure_column_placeholder( parent );
											window.$tve_drag_handle.hide();
										},
										/**
										 * Make sure an empty column has a placeholder element
										 *
										 * @param {jQuery} $column
										 */
										ensure_column_placeholder: function ( $column ) {
											if ( ! $column || ! $column.length || ! has_class( $column[0], 'tcb-flex-col' ) || $column.children( '.tcb-col' ).length !== 0 ) {
												return;
											}
											$column.children().not( '.ui-resizable-handle' ).wrapAll( '<div class="tcb-col"></div>' );
											this.row_class( $column.parent(), true );
										},
										/**
										 * Remove an empty column
										 * @param $column
										 */
										remove_column: function ( $column ) {

											var $row = $column.parent(),
												$cols = $column.siblings().removeClass( 'c-25 c-33 c-50 c-66 c-75' );

											$column.remove();
											/* no more columns -> remove the row entirely */
											if ( $cols.length === 0 ) {
												$row.parent().remove();

												return;
											}

											/* only 1 column - unwrap everything */
											/* UPDATE: do not remove the last column if it has been styled */
							//				if ( false && $cols.length === 1 ) {
							//					/* check if the row's parent is an empty column - we need to add the placeholder there */
							//					var $maybe_column = $row.closest( '.tcb-flex-col' );
							//					/* only 1 column - unwrap everything */
							//					$row.parent().replaceWith( $cols.children( ':not(.col-empty,.ui-resizable-handle)' ) );
							//					this.ensure_column_placeholder( $maybe_column );
							//
							//					return;
							//				}

											/* if the row was resized, we need to reset everything */
											if ( has_class( $row[0], 'tcb-resized' ) ) {
												/* remove the resized class and reset the columns to default state - for all media */
												$row.removeClass( 'tcb-resized' );
												$cols.head_css( {'max-width': ''}, '_ALL' );
											}

											this.row_class( $row );
										},
										/**
										 * update the tcb-row classes depending on the number of columns. This should help with responsiveness
										 *
										 * loop through each columns and resize stuff accordingly. example: images
										 * @param $row
										 * @param {Boolean} [skip_column_count] Whether or not to skip counting colmns and update the row class
										 */
										row_class: function ( $row, skip_column_count ) {
											if ( ! $row || ! $row.jquery ) {
												return;
											}
											skip_column_count = typeof skip_column_count === 'undefined' ? false : skip_column_count;

											var cols = $row.children().length;
											$row.parent().toggleClass( 'tcb-row-empty', cols === $row.find( '.tcb-flex-col > .tcb-col:empty' ).children().length );

											if ( skip_column_count ) {
												return;
											}

											$row.removeClass( function ( i, cls ) {
												return cls.split( ' ' ).filter( function ( elem ) {
													return elem.indexOf( 'tcb--cols--' ) !== - 1;
												} ).join( ' ' );
											} ).addClass( 'tcb--cols--' + cols );
											if ( cols > 10 ) {
												$row.addClass( 'tcb--cols--high' );
											}
											this.resize_images( $row );
										},
										/**
										 * Resize all images from a row. (Set inline styles equal to the actual sizes of the image)
										 *
										 * @param {jQuery} $container
										 */
										resize_images: function ( $container ) {
											$container.find( '.tve_image_caption' ).each( function () {
												// make sure the image is always smaller
												var w = parseInt( this.style.width ),
													$this = $( this ),
													actual_width = $this.width();
												if ( isNaN( w ) ) {
													return;
												}
												if ( w > actual_width ) {
													$this.css( 'width', actual_width + 'px' );
													$this.find( '.tve_image' ).css( 'width', actual_width + 'px' );
												}
											} );
										},
										/**
										 * special case of menu item: the user loads one of his saved templates
										 * the ajax call is made to a different php file
										 *
										 * @param {string} template_key
										 * @param {jQuery} $target
										 */
										load_template: function ( template_key, $target ) {
											$target.addClass( 'tcb-el-loading' );
											TVE.ajax( 'load_content_template', 'post', {template_key: template_key} )
												.done( function ( response ) {
													var $new_html = $( response.html_code );
													$new_html = TVE.apply_filters( 'tcb_insert_content_template', $new_html );
													/* this will contain newly generated [data-tve-custom-colour] attributes */
													$new_html = TVE.Editor_Page.content_manager.process_saved_template( response.css_code, $new_html, response.media_css );
													$target.removeClass( 'tcb-el-loading' );

													draggable.insert( $new_html, $target, false, true );
												} )
												.always( function () {
													$target.removeClass( 'tcb-el-loading' );
												} )
										},
										/**
										 * create 2 transparent <div>s positioned at the top and bottom of the page, and on dragover those divs, scroll the page
										 */
										page_scroll: function ( append_to ) {
											if ( typeof append_to === 'undefined' ) {
												append_to = 'body';
											}
											var _top = $( '<div id="tve_page_scroller_top" class="tve_window_drag_scroll"><span class="tve_arrow tve_icm tve-ic-caret-up"></span><div class="tve_drag_events"></div></div>' ).appendTo( append_to ),
												_bot = $( '<div id="tve_page_scroller_bottom" class="tve_window_drag_scroll"><span class="tve_arrow tve_icm tve-ic-caret-down"></span><div class="tve_drag_events"></div></div>' ).appendTo( append_to ),
												_all = _top.add( _bot ),
												last_direction = null,
												i = null,
												$body = $( append_to );
											if ( $body.is( 'body' ) ) {
												$body = $( 'body,html' );
											}
											function do_scroll( direction, skip_animation ) {

												if ( typeof skip_animation === 'undefined' ) {
													skip_animation = false;
												}

												if ( $body.is( ':animated' ) ) {
													return true;
												}

												var st = $body.is( 'body' ) ? $( window ).scrollTop() : $body.scrollTop();
												if ( direction == - 1 ) {
													_bot.removeClass( 'tve_scroll_hide' );
													if ( st === 0 ) {
														_top.addClass( 'tve_scroll_hide' ).removeClass( 'tve_drag_hover' );
													} else {
														_top.removeClass( 'tve_scroll_hide' );
													}
												} else {
													_top.removeClass( 'tve_scroll_hide' );
													if ( st + $( window ).height() >= $( 'body' ).height() - 45 ) {
														_bot.addClass( 'tve_scroll_hide' ).removeClass( 'tve_drag_hover' );
													} else {
														_bot.removeClass( 'tve_scroll_hide' );
													}
												}

												if ( ! skip_animation ) {
													$body.animate( {
														scrollTop: st + (direction * 120)
													}, 80, 'linear' );
												}

												return true;
											}

											_all.each( function () {
												var $target = $( this ).children( '.tve_drag_events' ).first();

												$target.on( 'dragenter', function () {
													var $parent = $( this ).parent(),
														direction = $parent.is( _top ) ? - 1 : 1;
													clearInterval( i );
													last_direction = direction;
													i = setInterval( function () {
														do_scroll( direction );
													}, 20 );
													$parent.addClass( 'tve_drag_hover' );
												} );
												$target.on( 'dragleave', function () {
													clearInterval( i );
													$( this ).parent().removeClass( 'tve_drag_hover' );
												} );
											} );
											do_scroll( - 1, true );
											return {
												show: function () {
													_all.show();
												},
												hide: function () {
													clearInterval( i );
													_all.removeClass( 'tve_drag_hover tve_scroll_hide' );
												}
											};
										},

										/**
										 * check if all selected elements are of the same type, and return the common type
										 *
										 * if no common type can be determined, false is returned
										 *
										 * @param $selected currently selected elements
										 */
										get_selection_type: function ( $selected ) {
											var type = false;

											if ( ! $selected.length ) {
												return false;
											}

											$selected.each( function () {
												if ( type === false ) {
													type = $( this ).data( 'tve-el-type' );
													return true;
												}
												if ( type != $( this ).data( 'tve-el-type' ) ) {
													type = false;
													return false;
												}
											} );

											return type;
										},
										/**
										 * Convert TCB-1 style columns to TCB2 style columns
										 *
										 * @param {jQuery} $element
										 */
										convert_old_columns: function ( $element ) {
											var $columns = $element.children(),
												row_class = 'tcb-flex-row tcb--cols--' + $columns.length,
												wrapper_classes = 'thrv_wrapper tve-draggable tve-droppable edit_mode',
												cls_map = {
													'tve_oth': 'c-33',
													'tve_tth': 'c-66',
													'tve_foc': 'c-25',
													'tve_tfo': 'c-75',
													'tve_twc': 'c-50'
												};
											/* at first, rule out the obvious ones */
											if ( $columns.length >= 4 || $columns.filter( '.tve_twc,.tve_oth' ).length === 2 ) {
												/* same-size columns - nothing to do here */
											} else {
												/* un-even columns */
												$columns.each( function () {
													var col = this;
													$.each( cls_map, function ( cls, new_cls ) {
														col.className = col.className.replace( cls, new_cls );
													} );
												} );
											}

											$columns.removeClass( 'tve_colm tve_df tve_ofo tve_fic tve_lst tve_foc tve_tfo tve_twc tve_oth tve_tth tve_thc' ).addClass( 'tcb-flex-col' );
											$element.removeClass( 'thrv_columns tve_clearfix ' + wrapper_classes ).addClass( row_class ).wrap( '<div class="thrv-columns ' + wrapper_classes + '"></div>' );
											$columns.each( function () {
												$( this ).children().wrapAll( '<div class="tcb-col"></div>' );
											} );
											resizable.bind( $element );
										},
										/**
										 * Re-position all the resizable handles within the $element
										 *
										 * @param {jQuery} $element
										 * @param {Number} padding
										 */
										position_resizables: function ( $element, padding ) {
											resizable.position_handles( $element, padding );
										}
									};

								var resizable = {
									position_handles: function ( $row, padding ) {
										if ( typeof padding === 'undefined' ) {
											padding = parseInt( $row.children( '.tcb-flex-col' ).first().css( 'paddingLeft' ) );
										}
										var pad = padding >= 6 ? ( padding - 6 ) / 2 + 'px' : 0;

										$row.find( '> .tcb-flex-col > .ui-resizable-handle' ).css( 'padding', '0 ' + pad + ' 0 ' + pad ).css( 'marginLeft', pad === 0 ? '-3px' : '' );
									},
									bind: function ( $root ) {
										$root = $root || TVE.Editor_Page.editor;

										var row_w, min_width = 100, $row, $cols,
											initial_percent = {},
											gutter = 15,
											saved_percent = null,
											$left_size = $( '<span>', {class: 'ui-resize-left'} ),
											$right_size = $( '<span>', {class: 'ui-resize-right'} ),
											$widgets = $root.find( '.tcb-flex-col' );

										$widgets.find( '.ui-resizable-handle' ).remove();
										$widgets.each( function () {
											var $this = $( this );
											if ( $this.data( 'ui-resizable' ) ) {
												$this.resizable( 'destroy' );
											}
										} );

										$widgets.resizable( {
											handles: 'e',
											start: function ( event, ui ) {
												TVE.Editor_Page.before_action();
												TVE.Editor_Page.editor.addClass( 'tcb-resizing' );
												$row = ui.element.parent();
												row_w = $row.width();
												var $resize_bar = ui.element.children( '.ui-resizable-handle' );
												$cols = $row.children( '.tcb-flex-col' );
												if ( ! $row.hasClass( 'tcb-resized' ) ) {
													$cols.each( function () {
														var $this = $( this );
														$this.head_css( {
															'max-width': ( ( $this.outerWidth() / row_w ) * 100 ) + '%'
														} );
													} );
													$row.addClass( 'tcb-resized' );
												}
												$row.addClass( 'tcb-resizing' );

												$resize_bar.before( $left_size );
												$resize_bar.after( $right_size );
												gutter = parseInt( ui.element.css( 'padding-left' ) );

												initial_percent = {
													elem: ( ui.element.outerWidth() / row_w ) * 100,
													next: ( ui.element.next().outerWidth() / row_w ) * 100
												};
												saved_percent = null;
											},
											stop: function ( event, ui ) {
												setTimeout( function () {
													TVE.Editor_Page.editor.removeClass( 'tcb-resizing' );
													TVE.Editor_Page.reposition_icons();
												} );
												ui.element.head_css( {
													'max-width': saved_percent.elem + '%'
												} );
												ui.element.next().head_css( {
													'max-width': saved_percent.next + '%'
												} );
												ui.element.css( 'width', '' );
												$cols.css( {
													'max-width': ''
												} );
												$row.removeClass( 'tcb-resizing' );

												ui.element.find( '.ui-resize-left, .ui-resize-right' ).remove();
												draggable.resize_images( $row );
												TVE.Editor_Page.after_action();
											},
											resize: function ( event, ui ) {
												var new_percent = (( 100 * ( gutter + ui.size.width ) / row_w )).toFixed( 1 ),
													next_percent,
													pos = new_percent - Math.floor( new_percent / 5 ) * 5,
													delta = new_percent - ( saved_percent ? saved_percent.elem : initial_percent.elem );
												if ( isCtrl ) {
													new_percent = parseInt( new_percent / 5 ) * 5;
												}
												next_percent = ( initial_percent.next - new_percent + initial_percent.elem ).toFixed( 1 );

												if ( isCtrl && (( pos === 0 ) || ( delta > 0 && pos > 3 ) || ( delta < 0 && pos > 2 )) ) {
													return false;
												}

												if ( new_percent * row_w / 100 <= min_width || next_percent * row_w / 100 <= min_width ) {
													return false;
												}

												ui.element.css( {
													'max-width': new_percent + '%'
												} );
												ui.element.next().css( {
													'max-width': next_percent + '%'
												} );

												saved_percent = {
													elem: new_percent,
													next: next_percent
												};

												$left_size.html( parseFloat( new_percent ).toFixed( isCtrl ? 0 : 1 ) + '%' );
												$right_size.html( parseFloat( next_percent ).toFixed( isCtrl ? 0 : 1 ) + '%' );
												TVE.Editor_Page.reposition_icons();

												return false;
											}
										} );
										$root.find( '.tcb-flex-row' ).each( function () {
											resizable.position_handles( $( this ) );
										} );
									}
								};

								handle.page_init = function () {
									if ( ! this.$el ) {
										this.$el = $( '<div id="tve-drop-handle"></div>' ).appendTo( 'body' );
									}
								};
								handle.show = function () {
									this.$el.show();
									return this;
								};
								handle.hide = function () {
									this.$el.hide();
									return this;
								};
								handle.data = function () {
									return this.$el.data.apply( this.$el, arguments );
								};
								handle.is = function () {
									return this.$el.is.apply( this.$el, arguments );
								};
								handle.reset = function () {
									this.$el.hide();
									this.last_dir = null;
									this.$el.data( 'append', null );
									this.limit_vertical = null;
									this.force_limit_vertical = null;
									this.$el.data( 'tt', null );
								};

								/**
								 * get the top / left / right / bottom position ( where the handle should be shown )
								 *
								 * @param mouse_pos
								 * @param element_pos
								 * @param w
								 * @param h
								 * @returns {*}
								 */
								function get_position( mouse_pos, element_pos, w, h ) {
									var mouse = {
											x: mouse_pos.left - element_pos.left,
											y: mouse_pos.top - element_pos.top + $document.scrollTop()
										}, //normalize_position( mouse_pos, element_pos ),
										ratio = w / h,
										x_delta = w * 0.33,
										is_top_right = mouse.x > ( mouse.y * ratio ),
										is_top_left = mouse.y * ratio + mouse.x < w;

									if ( handle.dropzone_element ) {
										/* also allow mid-positioning over dropzone elements */
										if ( mouse.y > h / 4 && mouse.y < 3 * h / 4 && mouse.x > w / 4 && mouse.x < 3 * w / 4 ) {
											return 'mid';
										}
									}

									if ( handle.limit_vertical ) {
										if ( handle.can_position_mid ) {
											if ( mouse.y > h / 4 && mouse.y < 3 * h / 4 ) {
												return 'mid';
											}
										}
										return mouse.y < h / 2 ? 'top' : 'bottom';
									}

									if ( mouse.x >= x_delta && mouse.x < 2 * x_delta ) {
										return mouse.y < h / 2 ? 'top' : 'bottom';
									}

									if ( is_top_right && is_top_left ) {
										return 'top';
									}

									if ( is_top_right && ! is_top_left ) {
										return 'right';
									}

									if ( ! is_top_right && is_top_left ) {
										return 'left';
									}

									return 'bottom';
								}

								/**
								 * position handle in respect to the $el element
								 *
								 * @param {jQuery} $el
								 * @param {Event} event
								 *
								 * @returns {void|handle}
								 */
								handle.position = function ( $el, event ) {
									var $col;
									if ( has_class( $el[0].parentNode.parentNode, 'tcb-flex-col' ) || has_class( $el[0].parentNode, 'thrv_text_element' ) || has_class( $el[0].parentNode, 'fr-element' ) ) {
										$col = $el.closest( '.tcb-flex-col,.thrv_text_element' );
									}
									var offset = $el.offset(),
										w = $el.outerWidth(),
										h = $el.outerHeight(),
										dir = get_position( {left: event.clientX, top: event.clientY, limit_vertical: $el.limit_vertical}, offset, w, h ),
										handle_width,
										handle_height,
										handle_top,
										handle_left;

									if ( this.last_dir === dir ) {
										return this;
									}
									if ( dir === 'mid' ) {
										return this.position_mid( $el );
									}
									if ( $col && ( dir == 'left' || dir == 'right') ) {
										$el.removeClass( 'tve-dragged-over' );
										$col.addClass( 'tve-dragged-over' );
										offset = $col.offset();
										h = $col.outerHeight();
										w = $col.outerWidth();
									}
									this.data( 'tt', this.dropzone_element ? $el.closest( '.thrv_wrapper' ) : $el );
									this.last_dir = dir;
									// position the handle and size it to fit the element
									switch ( dir ) {
										case 'top':
											handle_width = w;
											handle_height = default_handle_size;
											handle_top = ( offset.top - default_handle_size );
											handle_left = offset.left;
											break;
										case 'right':
											handle_width = default_handle_size;
											handle_height = h;
											handle_top = offset.top;
											handle_left = offset.left + w;
											if ( handle_left + handle_width > TVE.inner.$window.width() ) {
												handle_left -= default_handle_size;
											}
											break;
										case 'bottom':
											handle_width = w;
											handle_height = default_handle_size;
											handle_top = offset.top + h;
											handle_left = offset.left;
											if ( handle_top + handle_height > TVE.inner.$window.height() + TVE.inner.$window.scrollTop() ) {
												handle_top -= default_handle_size;
											}
											break;
										case 'left':
											handle_width = default_handle_size;
											handle_height = h;
											handle_top = offset.top;
											handle_left = offset.left - default_handle_size;
											break;
									}
									this.$el.css( {
										width: handle_width + 'px',
										height: handle_height + 'px',
										top: ( handle_top < 0 ? 0 : handle_top ) + 'px',
										left: ( handle_left < 0 ? 0 : handle_left ) + 'px',
										opacity: 1
									} ).show().data( 'dir', dir );
								};
								handle.position_mid = function ( $el ) {
									this.$el.data( 'tt', $el );
									this.last_dir = 'mid';
									var offset = $el.offset();
									this.$el.css( {
										width: $el.outerWidth(),
										height: default_handle_size,
										top: offset.top + $el.outerHeight() / 2,
										left: offset.left
									} ).show().data( 'dir', 'mid' );
								};

								module.exports = draggable;

							})( jQuery );
						},
						"editor-page.js": function (exports, module, require) {
							(function ( $ ) {
								module.exports = {
									selection_manager: require( './util/selection-manager' ),
									content_manager: require( './util/content' ),
									/* global edit state */
									STATE: 'enabled',
									/* $ object editor */
									editor: null,
									event: null,
									winWidth: null,
									/* html / body offset position from the top of the window - used in positioning menus */
									htmlOffset: null,
									/* used to show to the user the warning message to save his modifications */
									save_notification_timeout: null,
									/**
									 * this should be called only once / page load
									 */
									onDOMReady: function () {
										TVE.drag.init();
										this.winWidth = $( window ).width();
										this.editor = $( '#tve_editor' );
										this.$body = $( 'body' );

										this.bind_events();

										TVE.apply_filters( 'main_ajax_callback' );

										TVE.main.editor_loaded();

										TVE.apply_filters( 'editor_loaded_callback' );
										/**
										 * If this is Landing page, we need to make sure we include the proper hooks on loading and saving
										 */
										if ( TVE.CONST.landing_page ) {
											this.landingPageInit();
										}
									},
									bind_events: function () {
										if ( this.editor.is( ':empty' ) ) {
											this.$body.addClass( 'tve-empty-placeholder' )
										}
										/**
										 * Global events - should apply both on outer frame and on the inner frame
										 */
										TVE.bind_global_events();

										this.initEditorActions();

										this.editor.off( 'click.tcbaction' ).on( 'click.tcbaction', '.tcb-click', function ( e ) {
											var m = this.getAttribute( 'data-fn' ),
												fn = TVE, parts = m.split( '.' ), context = window;

											while ( fn && parts.length ) {
												context = fn;
												fn = fn[parts.shift()];
											}
											if ( typeof fn === 'function' ) {
												return fn.call( context, e );
											}
										} );
									},
									/**
									 * should be called each time the editor div will get replaced
									 */
									initEditorActions: function () {
										this.editor = $( '#tve_editor' );
										TVE.compat.dom_ready();
										this.selection_manager.init( this.editor );
										TVE.stylesheet = (function () {
											var $style = $( ".tve_custom_style" );
											if ( ! $style.length ) {
												$style = $( '<style type="text/css" class="tve_custom_style"></style>' ).appendTo( $( 'head' ) );
											}
											var style = $style[0];

											if ( style.styleSheet ) {
												style.styleSheet.cssText = style.styleSheet.cssText + "";
											} else {
												// WebKit hack :(
												style.appendChild( document.createTextNode( "" ) );
											}

											// Add the <style> element to the page
											return style.sheet;
										})();

										TVE.CSS_Rule_Cache.init();

										$( '.thrv_post_grid' ).tve_post_grid().after_render().masonry();

										/* populate the countdown timers, if any on the page */
										var $timers = $( '.thrv_countdown_timer' );
										if ( $timers.length ) {
											$timers.addClass( 'init_done' ).each( function () {
												if ( $( this ).hasClass( 'tve_countdown_timer_evergreen' ) ) {
													$( this ).tve_countdown_timer_evergreen().update();
												} else {
													$( this ).tve_countdown_timer().update();
												}
											} );
										}
										TVE.drag.editorActions();
										this.enableSaveWarning();

										TVE.froala.init();
									},
									/**
									 * refresh the elements - clear out the focus from the current editable element
									 *
									 * @param {Boolean} [hide_icons] Defaults to true
									 */
									blur: function ( hide_icons ) {
										hide_icons = typeof hide_icons === 'undefined' ? true : hide_icons;
										this.selection_manager.blur( hide_icons );
									},
									/**
									 * Focus an element
									 *
									 * @param $element
									 * @param event
									 * @returns {boolean}
									 */
									focus_element: function ( $element, event ) {
										if ( ! TVE.allow_edit() || this.STATE !== 'enabled' && ! this.editor.find( '.canvas-mode' ).length ) {
											return false;
										}

										if ( ! $element.hasClass( 'edit_mode' ) ) {
											this.blur();
											TVE.state( TVE.STATE_EDIT );
											$element.addClass( 'edit_mode' );

											/**
											 * @var {$.Event} evt
											 * Allows short-circuiting the conversion of the element into edit mode
											 */
											var evt = new $.Event( 'element_selected' );
											TVE.main.element_selected( $element, evt );
											if ( evt.isDefaultPrevented() ) {
												$element.removeClass( 'edit_mode' );
												return false;
											}

											setTimeout( function () {
												$element.focus();
											}, 0 );

										}
									},
									/**
									 * Duplicate an element from the page
									 *
									 * @param $element
									 */
									duplicate_element: function ( $element ) {
										TVE.froala.disable( $element );
										var _clone = $element.clone();
										$element.after( _clone );
										if ( $element.data( 'tve-el-type' ) ) {
											_clone.data( 'tve-el-type', $element.data( 'tve-el-type' ) );
										}
										_clone.removeClass( 'edit_mode canvas-mode active_highlight active_delete active_duplicate' );
										TVE.drag.after_clone( $element, _clone );

										return this;
									},
									/**
									 * Remove an element from the DOM
									 * @param $element
									 * @returns {Object}
									 */
									remove_element: function ( $element ) {
										var $parent = $element.parent();
										TVE.froala.disable( $element );

										this.blur( true );

										// custom delete handling for tab in tabs shortcode
										if ( $element.is( ".thrv_tabs_shortcode > .tve_scT > ul li" ) ) {
											$element.parents( '.thrv_tabs_shortcode' ).first().tve_tabs().removeTab( $element );
											return this;
										}
										// if a nested element and no more elements after this deletion, then delete parent element, too.
										if ( $parent.is( 'ul,ol' ) && $parent.find( 'li' ).length == 1 ) {
											if ( $parent.parent().is( '.thrv_bullets_shortcode' ) ) {
												return this.remove_element( $parent.parent() );
											}
											return this.remove_element( $parent );
										} else if ( $parent.hasClass( 'thrv_toggle_shortcode' ) && $parent.children( '.tve_faq' ).length === 1 ) {
											return this.remove_element( $parent );
										}

										if ( ! TVE.apply_filters( 'allow_remove', true, [$element] ) ) {
											return this;
										}

										if ( $element.hasClass( 'tcb-col' ) ) {
											TVE.drag.remove_column( $element.parent() );
										} else {
											$element.remove();
											TVE.drag.after_remove( $parent );
										}

										if ( this.editor.is( ':empty' ) ) {
											this.$body.addClass( 'tve-empty-placeholder' )
										}

										TVE.apply_filters( 'element_remove', $element );

										return this;
									},
									is_disabled: function () {
										return this.STATE === 'disabled';
									},
									/* disable all clicks, mouseovers, sortable etc */
									disable: function () {
										this.selection_manager.hide_icons();
										TVE.body_overlay();
										this.STATE = 'disabled';
									},
									enable: function () {
										this.STATE = 'enabled';
										TVE.remove_body_overlay();
										$( this ).trigger( 'editor.onenable' );
									},
									/**
									 * handle config data for Thrive Themes shortcodes
									 *
									 * @param $ $config root element which holds the configuration for thrive shortcode
									 */
									thriveShrtcodeConfig: function ( $config, key ) {
										var _configKey = '__CONFIG_' + key + '__';
										return {
											update: function ( value, property ) {
												var _data = this.get();
												_data[property] = value;
												this.save( _data );
											},
											save: function ( data ) {
												$config.html( _configKey + JSON.stringify( data ).replace( /\\"/g, '_tve_quote_' ) + _configKey );
											},
											get: function () {
												var replace = new RegExp( _configKey, 'g' );
												return JSON.parse( $config.html().replace( /_tveutf8_/g, '\\u' ).replace( replace, '' ).replace( /\\\'/g, "'" ).replace( /_tve_quote_/g, '\\"' ) );
											}
										}
									},
									enableSaveWarning: function () {
										var self = this;
										TVE.CONST.tve_display_save_notification = parseInt( TVE.CONST.tve_display_save_notification );
										if ( ! TVE.CONST.tve_display_save_notification || this.save_notification_timeout ) {
											return;
										}
										this.save_notification_timeout = setInterval( function () {
											TVE.page_message( '<div class="tve_icm tve-ic-close"></div><p><strong>Reminder</strong></p><br/><p>You have not saved your work for 10 minutes.</p><p>We recommend you perform a save to make sure you don\'t lose any work !</p></br><a id="tve-stop-saving-warning" style="display: block; text-align: right" href="javascript:void(0)">Stop reminding me for this work only !</a>', - 1, 6000 );
											TVE.$( "#tve-stop-saving-warning" ).click( function () {
												TVE.$notification.fadeOut( 200 );
												self.disableSaveWarning();
												TVE.CONST.tve_display_save_notification = 0;
											} );
											TVE.$notification.find( '.tve-ic-close' ).click( function () {
												$( this ).parent().fadeOut( 200 );
											} );
										}, 10 * 60 * 1000 );
									},
									disableSaveWarning: function () {
										TVE.CONST.tve_display_save_notification = parseInt( TVE.CONST.tve_display_save_notification );
										if ( ! TVE.CONST.tve_display_save_notification ) {
											return;
										}
										clearInterval( this.save_notification_timeout );
										this.save_notification_timeout = null;
									},
									/**
									 * Send the main ajax request for saving the content
									 *
									 * @param update
									 * @param _callback
									 * @param extra_data
									 */
									save: function ( update, _callback, extra_data ) {

										TVE.main.trigger( 'tve.tve_save_post' );
										var data = this.content_manager.prepare_save_data( update, extra_data ),
											args = arguments;

										function show_login_form() {
											if ( ! TVE.login_callback ) {
												TVE.login_callback = TVE.Editor_Page.save.apply( TVE.Editor_Page, args );
											}
											TVE.relogin();
										}

										var route = 'save_post';
										if ( TVE.CONST.save_post_action ) {
											route = 'save_post_external';
											data.external_action = TVE.CONST.save_post_action;
										}
										var xhr = TVE.ajax( route, 'post', data )
											.done( function ( response ) {
												if ( String( response ) === '0' ) {
													/**
													 * This means the user has been logged out
													 */
													return show_login_form();
												}
												if ( ! response.success ) {
													return TVE.page_message( response.message, true, 5000 );
												}
												if ( update ) {
													if ( response.revisions ) {// Reset revisions
														TVE.RevisionManager.reset_revisions( response.revisions );
													}

													TVE.page_message( TVE.t.AllChangesSaved );
												}
												if ( typeof _callback === 'function' ) {
													_callback( response );
												} else {
													TVE.main.overlay( 'close' );
												}
											} )
											.always( function ( response, status ) {
											} );

										xhr.tcb_error = function ( jqXHR ) {
											if ( jqXHR.responseText ) {
												try {
													var response = JSON.parse( jqXHR.responseText );
													if ( response.code === 'nonce_expired' ) {
														show_login_form();
														return false;
													}
												} catch ( e ) {
												}
											}
											// allow further processing
											return true;
										};

										this.disableSaveWarning();
										this.enableSaveWarning();
										if ( TVE.UndoManager ) {
											TVE.UndoManager.clear();
										}
										return xhr;
									},
									/**
									 * Return the editor contents
									 */
									editor_content: function () {
										return $( '<div></div>' ).html( this.editor.html() )
											.find( '.tve_placeholder, .tve-ui-helper, .rangySelectionBoundary' )
											.remove()
											.end()
											.html();
									},
									/**
									 * Save the page content into a variable, to be used on undo / redo
									 *
									 * @returns {exports}
									 */
									before_action: function () {
										window.content_before_action = this.editor_content();
										window.content_editor_class = this.editor.attr( 'class' );

										return this;
									},
									/**
									 * Adds an undo step after a clone / remove / delete / resize etc operation
									 */
									after_action: function () {
										var _before = window.content_before_action,
											editor_class = window.content_editor_class,
											_after = this.editor_content();

										function restore_content( html ) {
											this.editor.html( html );
											this.editor.attr( 'class', editor_class );
											TVE.drag.refresh();
											$( this ).trigger( 'editor.onundo' );
										}

										TVE.UndoManager.add( {
											undo: $.proxy( restore_content, this, _before ),
											redo: $.proxy( restore_content, this, _after )
										} );

										return this;
									},
									/**
									 * Get the user-defined CSS text
									 *
									 * @param return_hint
									 * @returns {string}
									 */
									get_custom_css: function ( return_hint ) {
										var $_style = $( 'style#tve_head_custom_css' );
										if ( $_style.length === 0 ) {
											return (typeof return_hint !== 'undefined' && return_hint) ? '/** Insert your custom CSS rules here. **/' : '';
										}

										return $_style.text();
									},

									/**
									 * append a custom css style to the current page. if it aleardy exists, replace it
									 * @param {string} cssString
									 */
									add_custom_css: function ( cssString ) {
										var $_style = $( 'style#tve_head_custom_css' );
										if ( $_style.length === 0 ) {
											$_style = $( '<style type="text/css" class="tve_user_custom_style" id="tve_head_custom_css"></style>' ).appendTo( $( 'head' ) );
										}
										$_style.text( cssString );
									},
									/**
									 * Reposition the clone, delete, drag and name icons relative to the $element
									 *
									 * @param {jQuery} [$element] Icons will be positioned relative to this element. Optional. Defaults to the currently active Element ( TVE.ActiveElement )
									 */
									reposition_icons: function ( $element ) {
										if ( this.is_disabled() ) {
											return;
										}
										if ( typeof $element === 'undefined' ) {
											$element = TVE.ActiveElement;
										}
										if ( $element && $element.length === 1 ) { //lead generation may have similar inputs as ActiveElement
											this.selection_manager.reposition_icons( $element );
										}
									},
									/**
									 * Initialize listeners for Landing Pages
									 */
									landingPageInit: function () {
										/**
										 * Automatically update the body background settings from the "old" style to head css
										 */
										function landingPageUpdate( $body ) {
											var head_css = {},
												style = $body[0].style;
											if ( ! $body.attr( 'style' ) ) {
												return;
											}

											var i = ' !important';

											if ( style.backgroundColor ) {
												head_css['background-color'] = style.backgroundColor + i;
											}
											if ( style.backgroundImage ) {
												head_css['background-image'] = style.backgroundImage + i;
											}
											if ( style.backgroundSize ) {
												head_css['background-size'] = style.backgroundSize + i;
											}
											if ( style.backgroundAttachment ) {
												head_css['background-attachment'] = style.backgroundAttachment + i;
											}

											$body.removeAttr( 'style' );

											TVE.SKIP_CSS_STATE = true;
											$body.head_css( head_css );
											TVE.SKIP_CSS_STATE = false;
										}

										TVE.main.on( 'element_selected', function () {
											if ( TVE.ActiveElement.is( 'body.tve_lp' ) ) {
												landingPageUpdate( TVE.ActiveElement );
											}
										} );

										TVE.add_filter( 'tcb_save_post_data_before', function ( data ) {
											var globals = TVE.CONST.tve_globals,
												css;
											if ( ( css = TVE.inner.$body.attr( 'data-css' ) ) ) {
												globals.body_css = css;

												delete globals.lp_bg;
												delete globals.lp_bgi;
												delete globals.lp_bgp;
												delete globals.lp_bga;
											}

											return data;
										} );
									}
								};
							})( jQuery );
						},
						"editor.js": function (exports, module, require) {
							(function ( $ ) {
								if ( ! window.parent ) {
									return;
								}
								window.parent.child_context = window;
							
								/**
								 * Cases where javascript from the inner frame is loaded before the main javascript file (?)
								 * @returns {number}
								 */
								function bootstrap() {
									if ( ! window.parent.TVE || ! window.parent.TCB_READY ) {
										return setTimeout( bootstrap, 100 );
									}
							
									window.TVE = window.parent.TVE;
							
									TVE.inner = {
										window: window,
										document: document,
										jQuery: $,
										$window: $( window ),
										$document: $( document )
									};
							
									/**
									 * Extend the TVE object with functionalities from general.js
									 */
									$.extend( TVE, require( './util/general' ) );
							
									/**
									 * Froala editor API
									 * @type {*}
									 */
									TVE.froala = require( './util/froala' );
							
									TVE.inner_$ = $;
									TVE.compat = require( './compat' );
									TVE.drag = require( './drag' );
									TVE.Editor_Page = require( './editor-page' );
									TVE.landing_fonts = require( './util/landing-fonts' );
							
									/**
									 * Custom editor extended functionality - elements that need extra controls on the editor frame
									 * @type {{table}}
									 */
									TVE.plugins = {
										/**
										 * Custom functionality for the table element
										 */
										table: require( './util/table/editor' )
									};
							
									$.extend( true, TVE.CONST, tve_path_params );
							
									require( './util/jquery-plugins' );
							
									$( function () {
										TVE.inner.$body = $( 'body' );
										TVE.Editor_Page.onDOMReady();
										TVE.inner.$window.trigger( 'tcb-ready' );
									} );
								}
							
								bootstrap();
							
							})( jQuery );
							var text_elements = '';
							//throw new Error( 'editor finished' );
							/**
							 * @var {TVE} TVE
							 * @type {{}}
							 */
							var TVE_Content_Builder = TVE_Content_Builder || {};
							
							//jQuery selector of elements which don't have either duplicate or delete buttons on hover
							elements_no_left_menu = "";
							
							//jQuery selector of items that should have the left menu displayed on hover.
							left_menu_hover_items = ".thrv_wrapper:not(.thrv_paste_content), .tve_faq," + text_elements;
							
							// jQuery selector of items that should have the right menu displayed on hover
							right_menu_hover_items = text_elements + ",.thrv_wrapper, blockquote, .tve_clearfix li, ol, ul:not(.tve_scT > ul, .thrv_bullets_shortcode ul), ol li, ul li, .tve_faq, .tve_table_cell, .tve_p_lb_control, .thrv_feature_grid .tve_gri > .tve_image,.tve_element_hover";
							
							/* these are elements that should just have a highlight effect on hover, and no duplicate and delete icons */
							
							// jQuery selector of items that you don't want to show right menu for. This overrides right_menu_hover_items above.
							// If user hovers over one of the elements in the selector below, it will look in the DOM to see if the element is part of a thrive shortcode
							// If element is part of thrive shortcode then the shortcode wrapper will display the delete button, instead.
							elements_without_delete_button = ".thrv_toggle_shortcode h4, .thrv_testimonial_shortcode img, .tve_colm, .thrv_post_grid *, .thrv_custom_html_shortcode *, .tve_table_cell, .tve_rating_stars > span, .tve_rating_stars, .tve_wp_shortcode *, .thrv_widget *, .thrv_widget_menu ul *";
							
							// array of elements that contain child elements.  Unordered lists and Ordered lists, for example, contain LI
							contains_nested_elements = ["UL", "OL"];
							
							// reminder, need to set REGEX in getBlockContainer() to correspond with block_tags
							block_tags = ["ADDRESS", "BLOCKQUOTE", "P", "H1", "H2", "H3", "H4", "H5", "H6", "OL", "UL", "PRE"];
							
							// define global variable to "remember" colours selections. Set default to red.
							window.last_colour_used = "tve_red";
							
							custom_html_placeholder_class = 'tve_custom_html_placeholder';
							custom_html_default_html = '<div class="tve_shortcode_overlay" style="width: 100%; height: 40px; background-color: rgba(0, 0, 0, 0.4); color: #fff; text-align: center;"><span style="display: inline-block; padding-top: 10px">No preview available.</span></div>';
							
							border_styles = 'tve_brdr_none tve_brdr_dotted tve_brdr_dashed tve_brdr_solid tve_brdr_double tve_brdr_groove tve_brdr_ridge tve_brdr_inset tve_brdr_outset';
							img_styles = 'img_style_dark_frame img_style_framed img_style_lifted_style1 img_style_lifted_style2 img_style_polaroid img_style_rounded_corners img_style_circle img_style_caption_overlay';
							rv_styles = 'rv_style_grey_monitor rv_style_black_monitor rv_style_black_tablet rv_style_white_tablet rv_style_white_frame rv_style_gray_frame rv_style_dark_frame rv_style_light_frame rv_style_lifted_style1 rv_style_lifted_style2 rv_style_lifted_style3 rv_style_lifted_style4 rv_style_lifted_style5 rv_style_lifted_style6 rv_style_none';
							rv_play_buttons = "rv_button_rounded_rectangle_light rv_button_rounded_rectangle_dark rv_button_circular_dark rv_button_circular_outline_dark rv_button_simple_play_light rv_button_none";
							rv_accepted_extensions = "mp4 m4v webm ogv wmv flv";
							/* global saved parameters for the current post. These will be saved in a meta post field */
							/* TVE.CONST.tve_globals - holds thigs such as lightbox overlay opacity, background color etc */
							
							/* font manager custom classes */
							window.custom_font_classes = '';
							window.extra_font_classes = '';
							jQuery.each( tve_path_params.custom_fonts, function () {
								custom_font_classes += (custom_font_classes ? ' ' : '') + this.font_class;
							} );
							if ( window.TVE && TVE.CONST && TVE.CONST.tve_globals.extra_fonts ) {
								jQuery.each( TVE.CONST.tve_globals.extra_fonts, function () {
									extra_font_classes += (extra_font_classes ? ' ' : '') + this.font_class;
								} );
							}
							
							/**
							 * Refresh the screen flow
							 * called when user exits edit mode.
							 * when build_sortables set to true it will allow the user to sort the elements on screen.
							 **/
							function tve_refresh( build_sortables ) {
								var $edit = jQuery( '.edit_mode' );
								TVE.Editor_Page.editor.find( 'p:empty' ).html( '&#x200b' );
							//	jQuery( '[contentEditable="true"]' ).attr( 'contentEditable', 'false' );
								$edit.removeClass( 'edit_mode' );
								jQuery( '.edit_light, .edit_dark' ).removeClass( 'edit_light edit_dark' );
							
								if ( build_sortables ) {
									enable_sortables();
								}
								// hide customised menu because no element is selected at this point.
								hide_control_panel_menu();
							
								// check each custom_html block, and if its height is 0, add the default placeholder with "Insert HTML Code"
								jQuery( '.thrv_custom_html_shortcode' ).each( function () {
									var $this = jQuery( this );
									if ( $this.height() == 0 && $this.find( '.' + custom_html_placeholder_class ).length === 0 ) {
										$this.append( custom_html_default_html );
									}
								} );
							}
							
							function convert_element_into_edit_mode( element, e ) {
								e.stopPropagation();
								tve_refresh( false );
								hide_element_right_menu();
								hide_element_left_menu();
							
								element.addClass( 'edit_mode' );
								TVE.Editor_Page.event = e;
							
								/**
								 * @var {jQuery.Event} evt
								 * Allows short-circuiting the conversion of the element into edit mode
								 */
								var evt = new jQuery.Event( 'element_selected' );
								TVE.main.element_selected( element, evt );
								if ( evt.isDefaultPrevented() ) {
									return false;
								}
							
								setTimeout( function () {
									element.focus();
								}, 0 );
							
								return true;
							}
							
							function remove_contenteditable_true() {
								jQuery( "[contenteditable]" ).removeAttr( 'contenteditable' );
							}
							
							/**
							 * Hides the popup control panel
							 */
							function hide_control_panel_menu() {
								jQuery( ".tve_cpanel_onpage, .tve_secondLayer, .tve_secondLayer>div" ).removeClass( 'tve_menu_visible' ).hide();
								/**
								 * stupid bug in Chrome - when the IRIS picker is used when the page has scroll (and it's scrolled) the drag handle will not be
								 * positioned correctly if there is an overflow-x:hidden CSS rule on html,body
								 */
								jQuery( 'html,body' ).tve_css( 'overflow-x', '' );
							
								/**
								 * remove reference to the loaded menu
								 */
								delete TVE_Content_Builder.loaded_menu;
								delete TVE_Content_Builder.edit_element;
							}
							
							// function takes element as input and looks through parents to figure out if the element is a child of a thrive shortcode or not.
							// if wrapper found then will return element, else will return false
							// if the element selected is the shortcode wrapper, then it returns itself.
							// this is the logic that takes place when user hovers over an element where right / left menu is set to display
							function tve_get_shortcode_wrapper_hover( element ) {
								if ( jQuery( element ).is( ".thrv_wrapper" ) ) {
									return element;
								} else {
									var is_shortcode = jQuery( element ).parents( ".thrv_wrapper, .tve_faq" ).first();
									if ( is_shortcode.length !== 0 ) {
										return is_shortcode;
									} else {
										return false;
									}
								}
							}
							
							/**
							 * Takes element as input and looks through parents to figure out if the element is a child of a thrive shortcode or not.
							 * if wrapper found then will return element, else will return false
							 * if the element selected is the shortcode wrapper, then it returns itself.
							 * this is the logic that takes place when user clicks on an editable element
							 */
							function tve_get_shortcode_wrapper_click( element ) {
								element = jQuery( element );
								if ( element.is( '.thrv_wrapper,img' ) || element.hasClass( 'tve_p_lb_control' ) || element.hasClass( 'tve_wrap_all' ) || element.hasClass( 'tve_typefocus' ) ) {
									return element;
								} else {
									var is_shortcode = jQuery( element ).parents( ".thrv_wrapper" ).first();
									if ( is_shortcode.length !== 0 ) {
										return is_shortcode;
									} else {
										return false;
									}
								}
							}
							
							function tve_editor_init( e, element ) {
								e.preventDefault();
							
								var $target = jQuery( e.target ),
									$currentTarget = jQuery( e.currentTarget ),
									$outerMost, $parent;
							
								// certain elements shouldn't be editable
								if ( $target.is( selectors.not_editable ) && $currentTarget.is( selectors.not_editable ) ) {
									// if credit card logo, then get wrapper and use that as element
									if ( $target.is( ".tve_cc_logo" ) || $target.is( '.thrv_custom_html_shortcode *' ) ) {
										element = tve_get_shortcode_wrapper_click( e.target );
										e.target = element;
									} else {
										return false;
									}
								}
							
								e.preventDefault();
							
								if ( ! $target.hasClass( "edit_mode" ) ) {
									TVE.state( TVE.STATE_EDIT );
									convert_element_into_edit_mode( element, e );
									jQuery( document ).on( "click.clearFocus", document, clearFocus );
									jQuery( ".edit_mode" ).on( "click.editHyperlinks", "a", tve_edit_hyperlinks );
								} else {
									// if user clicks on element that's in edit mode then prevent the event from bubbling up the DOM and deselecting the element.
									if ( ! $target.is( "a" ) ) {
										tve_hide_hyperlink_options();
									}
									e.stopPropagation();
								}
							}
							
							// copy inline styles from one element to another
							function tve_copy_style( element_copied_from, element_copied_to ) {
								element_copied_to.attr( "style", element_copied_from.attr( "style" ) );
							}
							
							
							function tve_direct_css_insert( css_rule ) {
								if ( TVE.stylesheet.insertRule ) {
									TVE.stylesheet.insertRule( css_rule, 0 );
								} else {
									TVE.stylesheet.addRule( css_rule, 0 );
								}
							}
							
							/**
							 * Copies the custom styles from the original element to the new element by creating a new unique id
							 * @param element - original element that's being copied
							 * @param cloned_element - the newly cloned element added to the DOM
							 */
							function tve_clone_custom_styles( element, cloned_element ) {
								var already_cloned_id = [];
								cloned_element.find( "[data-tve-custom-colour]" ).each( function () {
									var $this = jQuery( this ),
										css_id = $this.attr( "data-tve-custom-colour" );
							
									if ( ! css_id ) {
										return true;
									}
									if ( already_cloned_id.indexOf( css_id ) == - 1 ) {
										var css_rules = tve_return_css_rule( css_id ),
											new_unique_id = tve_get_unique_css_identifier( $this, false, true );
										for ( var i = 0; i < css_rules.length; i ++ ) {
											new_css_rule = css_rules[i].replace( css_id, new_unique_id );
											tve_direct_css_insert( new_css_rule );
										}
										/** replace all instances of the old id with the new id **/
										jQuery( cloned_element ).find( "[data-tve-custom-colour='" + css_id + "']" ).each( function () {
											if ( already_cloned_id.indexOf( jQuery( this ).attr( "data-tve-custom-colour" ) ) == - 1 ) {
												jQuery( this ).attr( "data-tve-custom-colour", new_unique_id );
											}
										} );
										already_cloned_id.push( css_id );
									}
								} );
								//at this point we don't clone the css code, we leave the same class
							//	cloned_element.add( cloned_element.find( '[data-css^="tve-u-"]' ) ).head_css_clone();
							}
							
							/**
							 * function to delete css rules in custom stylesheet
							 * @param selector - delete all rules that match selector
							 */
							function tve_remove_css_rule( selector, rule, selector_suffix, selector_prefix ) {
							
								if ( typeof selector_suffix === 'undefined' ) {
									selector_suffix = '';
								}
							
								if ( typeof selector_prefix === 'undefined' ) {
									selector_prefix = '';
								}
							
								var myrules = TVE.stylesheet.cssRules ? TVE.stylesheet.cssRules : TVE.stylesheet.rules,
									expected_selector = '[data-tve-custom-colour="' + selector + '"]' + selector_suffix,
									expected_alt = "[data-tve-custom-colour='" + selector + "']" + selector_suffix;
							
								expected_selector = selector_prefix + expected_selector;
								expected_alt = selector_prefix + expected_alt;
							
								TVE.stylesheet.crossdelete = TVE.stylesheet.deleteRule ? TVE.stylesheet.deleteRule : TVE.stylesheet.removeRule;
							
								for ( i = 0; i < myrules.length; i ++ ) {
									if ( myrules[i].type === CSSRule.MEDIA_RULE ) {
										continue;
									}
									if ( myrules[i].selectorText.indexOf( selector ) === - 1 ) { // bail early
										continue;
									}
									if ( myrules[i].selectorText == expected_selector || myrules[i].selectorText == expected_alt || myrules[i].selectorText == selector ) { /* we need to remove the exact rule */
										if ( typeof rule !== 'undefined' && rule ) {
											jQuery.each( rule.split( ' ' ), function ( index, rule ) {
												if ( myrules[i].style.removeProperty ) {
													myrules[i].style.removeProperty( rule );
												} else if ( myrules[i].style.removeAttribute ) {
													myrules[i].style.removeAttribute( rule );
												}
											} );
										} else {
											TVE.stylesheet.crossdelete( i );
											i --;
										}
									}
								}
							}
							
							/**
							 * function to return the css rule of a matching selector
							 * @param selector - css selection text
							 * @returns {string} - first matching css style
							 */
							function tve_return_css_rule( css_id ) {
								selector = '[data-tve-custom-colour="' + css_id + '"]';
								var myrules = TVE.stylesheet.cssRules ? TVE.stylesheet.cssRules : TVE.stylesheet.rules;
								TVE.stylesheet.crossdelete = TVE.stylesheet.deleteRule ? TVE.stylesheet.deleteRule : TVE.stylesheet.removeRule;
								matching_rules = new Array();
								for ( i = 0; i < myrules.length; i ++ ) {
									if ( myrules[i].type === CSSRule.MEDIA_RULE ) {
										continue;
									}
									if ( myrules[i].selectorText.toLowerCase().indexOf( css_id ) != - 1 ) {
										matching_rules.push( myrules[i].cssText );
									}
								}
								return matching_rules;
							}
							
							/**
							 * extracts custom CSS rules filtered by the custom_css_rules array
							 *
							 * @param custom_css_rules
							 */
							function tve_extract_stylesheet_rules_filtered( custom_css_rules ) {
								if ( ! custom_css_rules || ! custom_css_rules.length ) {
									return '';
								}
								var myrules = TVE.stylesheet.cssRules ? TVE.stylesheet.cssRules : TVE.stylesheet.rules;
								var inline_rules = "";
								for ( var i = 0; i < myrules.length; i ++ ) {
									if ( myrules[i].type === 4 ) { // media rule, skip it here, this is built separately
										continue;
									}
									for ( var j = 0, _key; _key = custom_css_rules[j ++]; ) {
										if ( myrules[i].selectorText.indexOf( _key ) !== - 1 ) {
											inline_rules = inline_rules + myrules[i].cssText;
										}
									}
								}
								return inline_rules;
							}
							
							/**
							 * Generates a unique id that can be used for attaching CSS styles
							 * @param selector - the jquery element to generate unique css id for
							 * @param return_current - boolean.  If true then will return the current id if exists, if false then will generate a completely new id.
							 * @param return_first - boolean. If true, it will it will return the id from the first element in the set
							 * @returns Array|string either existing ids or newly generated id
							 *
							 * update 28.10.2015 - changed the return type of this to be array, one string for each element identified by the selector
							 */
							function tve_get_unique_css_identifier( selector, return_current, return_first ) {
								var $element = jQuery( selector ),
									ids = [],
									rand_id = null;
							
								$element.each( function () {
									var $elem = jQuery( this );
									if ( $elem.attr( 'data-tve-custom-colour' ) && return_current ) {
										ids.push( $elem.attr( 'data-tve-custom-colour' ) );
										return true; // return and continue the loop
									}
									if ( ! return_first || (return_first && rand_id === null) ) {
										rand_id = Math.floor( (Math.random() * 100000000) + 1 );
									}
									$elem.attr( 'data-tve-custom-colour', rand_id );
									ids.push( rand_id );
								} );
							
								return return_first ? ids[0] : ids;
							}
							
							/**
							 * Removes any custom colours that have been applied to an element
							 */
							function tve_remove_custom_colours( element ) {
								tve_remove_css_rule( element.tve_color_selector() );
								if ( element.is( 'img' ) ) {
									element.removeAttr( 'data-tve-custom-colour' );
								}
								jQuery( element ).find( "[data-tve-custom-colour]" ).each( function () {
									var $this = jQuery( this );
									tve_remove_css_rule( $this.tve_color_selector() );
									$this.removeAttr( "data-tve-custom-colour" );
								} );
								element.tve_remove_hover();
							
							}
							
							/**
							 * Escapes the regex for colour extraction
							 * @param s
							 * @returns {XML|string}
							 */
							function escapeHTML( s ) {
								return s.replace( /&/g, "&amp;" ).replace( /"/g, "&quot;" ).replace( /</g, "&lt;" ).replace( />/g, "&gt;" );
							}
							
							/**
							 * Takes the selector from the custom_colour mapping file and appends .edit mode to each comma separated jquery selector
							 * @param selector - jquery selector of element to which a custom colour is being applied
							 * @returns {string} - modified jquery selector
							 */
							function modify_selector_edit_mode( selector ) {
								var selector_array = selector.split( ',' );
								for ( var i = 0; i < selector_array.length; i ++ ) {
									selector_array[i] = selector_array[i].replace( /^\s*|\s*$/g, '' );
									selector_array[i] = ".edit_mode " + selector_array[i];
								}
								return selector_array.join( "," );
							}
							
							/**
							 * global string replacement
							 * @param find
							 * @param replace
							 * @param str
							 * @returns {*|XML|replace|string|void}
							 */
							function replaceAll( find, replace, str ) {
								return str.replace( new RegExp( escapeRegExp( find ), 'g' ), replace );
							}
							
							/**
							 * Escapes characters that throw off the Reg Ex string
							 * @param str - String to escape
							 * @returns {*|XML|replace|string|void} - escaped string
							 */
							function escapeRegExp( str ) {
								return str.replace( /[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&" );
							}
							
							// returns the element held within the edit_mode wrapper used to add and remove classes for styling
							function get_element_from_wrapper( element, element_type ) {
								switch ( element_type ) {
									case "button" :
										return jQuery( element ).find( ".tve_btn" );
									case "contentbox" :
										return jQuery( element ).find( "> .tve_cb" );
									case "guarantee" :
										return jQuery( element ).find( ".tve_fg" );
									case "calltoaction" :
										return jQuery( element ).find( ".tve_ca, .tve_btn" );
									case "testimonial" :
										return jQuery( element ).find( ".tve_ts" );
									case "bullets" :
										return jQuery( element ).find( ".tve_ul" );
									case "tabs" :
										return jQuery( element ).find( "> .tve_scT" );
									case "pricingtable" :
										return element;
									case 'table' :
										return element.find( '> table.tve_table' ); // avoid nesting tables cascading styles
									case 'content_container':
										return element.find( '> .tve_content_inner' );
									case 'lightbox':
										return element.parents( '.tve_p_lb_content' ).first();
									case 'icon':
										return element.find( 'span.tve_sc_icon' );
								}
							
								// default : return the actual element
								return element;
							}
							
							// determines the type of shortcode by looking at the DOM
							function get_shortcode_type_from_edit_mode( element ) {
								if ( element.hasClass( "thrv_button_shortcode" ) || element.hasClass( 'tve_btn' ) ) {
									return "button";
								} else if ( element.hasClass( "thrv_contentbox_shortcode" ) ) {
									return "contentbox";
								} else if ( element.hasClass( "thrv_contents_table" ) ) {
									return "contents_table";
								} else if ( element.hasClass( "thrv_guarantee_shortcode" ) ) {
									return "guarantee";
								} else if ( element.hasClass( "thrv_calltoaction_shortcode" ) ) {
									return "calltoaction";
								} else if ( element.hasClass( "thrv_testimonial_shortcode" ) ) {
									return "testimonial";
								} else if ( element.hasClass( "thrv_bullets_shortcode" ) ) {
									return "bullets";
								} else if ( element.hasClass( "thrv_tabs_shortcode" ) ) {
									return "tabs";
								} else if ( element.hasClass( "thrv_toggle_shortcode" ) ) {
									return "toggle";
								} else if ( element.hasClass( "tve_prt" ) ) {
									return "pricingtable";
								} else if ( element.hasClass( 'thrv_content_container_shortcode' ) ) {
									return 'content_container';
								} else if ( element.hasClass( 'thrv_table' ) ) {
									return 'table';
								} else if ( element.hasClass( 'tve_table_cell' ) ) {
									return 'table_cell';
								} else if ( element.hasClass( 'tve_image' ) ) {
									return 'image';
								} else if ( element.hasClass( 'thrv_icon' ) || element.hasClass( 'tve_sc_icon' ) ) {
									return 'icon';
								} else if ( element.is( text_elements ) ) {
									return "text";
								} else if ( element.hasClass( 'thrv_star_rating' ) ) {
									return 'rating';
								} else if ( element.hasClass( 'thrv_tw_qs' ) ) {
									return 'tw_qs';
								} else if ( element.hasClass( 'thrv_lead_generation' ) ) {
									return 'lead_generation';
								} else if ( element.hasClass( 'tve_lg_input' ) ) {
									return 'lead_generation_input';
								} else if ( element.hasClass( 'tve_lg_image_submit' ) ) {
									return 'lead_generation_image_submit';
								} else if ( element.hasClass( 'tve_lg_submit' ) ) {
									return 'lead_generation_submit';
								} else if ( element.hasClass( 'tve_lg_checkbox' ) ) {
									return 'lead_generation_checkbox';
								} else if ( element.hasClass( 'tve_lg_dropdown' ) ) {
									return 'lead_generation_dropdown';
								} else if ( element.hasClass( 'tve_lg_radio' ) ) {
									return 'lead_generation_radio';
								} else if ( element.hasClass( 'tve_lg_textarea' ) ) {
									return 'lead_generation_textarea';
								} else if ( element.hasClass( 'thrv_widget' ) ) {
									return 'widget';
								} else if ( element.hasClass( 'tve_p_lb_control' ) ) {
									return 'lightbox';
								} else if ( element.hasClass( 'thrv_widget_menu' ) ) {
									return 'widget_menu';
								} else if ( element.hasClass( 'thrv_post_grid' ) ) {
									return 'post_grid';
								} else if ( element.hasClass( 'tve_wp_shortcode' ) ) {
									return 'shortcode';
								} else if ( element.hasClass( 'tve_image' ) || element.hasClass( 'tve_image_caption' ) ) {
									return 'img';
								} else if ( element.hasClass( 'thrv_cc_icons' ) ) {
									return 'cc_icons';
								} else if ( element.hasClass( 'thrv_custom_html_shortcode' ) ) {
									return 'custom_html';
								} else if ( element.children( '.tve_sep' ).length ) {
									return 'default';
								} else if ( element.hasClass( 'thrv_progress_bar' ) ) {
									return 'progress_bar';
								} else if ( element.hasClass( 'thrv_fill_counter' ) ) {
									return 'fill_counter';
								} else if ( element.hasClass( 'thrv_number_counter' ) ) {
									return 'number_counter';
								} else if ( element.hasClass( 'thrv_countdown_timer' ) ) {
									return 'countdown_timer';
								} else if ( element.hasClass( 'thrv_responsive_video' ) ) {
									return 'responsive_video';
								} else if ( element.hasClass( 'thrv_page_section' ) ) {
									return 'page_section';
								} else if ( element.hasClass( 'tcb-flex-row' ) ) {
									return 'columns';
								}
							}
							
							function tve_wrap_element_tags( element, open_tag, close_tag ) {
								var content = jQuery( open_tag + element.html() + close_tag );
								element.replaceWith( content );
							
								TVE.drag.bind_draggable( content );
							}
							
							/**
							 * Start a interval that makes ajax requests until a valid nonce is received in response
							 * (an user with edit_posts right is logged in)
							 */
							function tve_update_nonce( intervalID ) {
							
								clearInterval( intervalID );
							
								var intID = setInterval( function () {
									var data = {
										action: "tve_logged_user_nonce"
									};
									jQuery.post( tve_path_params.ajax_url, data, function ( response ) {
										if ( typeof response == 'object' && response.nonce ) {
											clearInterval( intID );
											tve_path_params.tve_ajax_nonce = response.nonce;
										}
									}, 'json' );
								}, 2000 );
							
								return intID;
							}
							
							// function to send ajax request to server in order change the style family of the current page
							function tve_change_style_family( style_family ) {
							
								TVE.Editor_Page.save( false );
							
								var data = {
									action: 'tve_change_style_family',
									style_family: style_family,
									post_id: tve_path_params.post_id,
									security: tve_path_params.tve_ajax_nonce
								};
								var current = jQuery( '#tve_editor' ).parent();
								jQuery( "#tve_style_family_" + current.attr( 'id' ) + "-css" ).attr( "href", tve_path_params.style_families[style_family] );
							
								tve_path_params.tve_loaded_stylesheet = style_family;
								current.removeClass( 'tve_flt tve_clsy tve_min' ).addClass( tve_path_params.style_classes[style_family] );
								jQuery.post( tve_path_params.ajax_url, data, function ( response ) {
								} );
							}
							
							// this loads the existing values into the input fields when the secondary menu is triggered
							function load_button_values( element, type ) {
							
								var $menu = jQuery( '#' + type + '_menu' );
								switch ( type ) {
									case 'thrive_ultimatum_shortcode':
										var config = element.tve_thrive_ultimatum_shortcode().config(),
											href = '/?post_type=tve_ult_campaign&p=' + config.tve_ult_campaign + '&tve=true&tud_id=' + config.tve_ult_shortcode + '&r=57729869e0249';
										$menu.find( '#tve_ult_edit_shortcode' ).attr( 'href', href );
										break;
									case 'typefocus':
										$menu.find( "#tve_typefocus_speed" ).val( element.attr( 'data-speed' ) );
										$menu.find( "#tve_typefocus_cursor" ).prop( "checked", element.hasClass( "tve_typefocus_cursor" ) );
										$menu.find( "#tve_typefocus_highlight" ).prop( "checked", element.attr( "data-highlight" ) === "1" );
										break;
									case "button" :
										handle_custom_classes( element );
										handle_custom_fonts( element.find( 'a.tve_btnLink' ), $menu );
										jQuery( "#button_cc_icons" ).prop( "checked", element.find( ".thrv_cc_icons" ).length != 0 );
							
										var _temp_value = tve_handle_integer_or_float( element.find( 'a.tve_btnLink' ).css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
							
										if ( ! element.is( '.tve_btn' ) ) {
											element = get_element_from_wrapper( element, type );
										}
							
										jQuery( "#buttonText" ).val( jQuery.trim( element.first().find( "a" ).text() ) );
										jQuery( "#buttonLink" ).val( element.find( "a" ).attr( "href" ) );
										if ( element.find( ".tve_btnLink" ).attr( "target" ) == "_blank" ) {
											jQuery( "#btn_link_new_window" ).prop( "checked", true );
										} else {
											jQuery( "#btn_link_new_window" ).prop( "checked", false );
										}
										if ( element.find( ".tve_btnLink" ).attr( "rel" ) == "nofollow" ) {
											jQuery( "#btn_nofollow" ).prop( "checked", true );
										} else {
											jQuery( "#btn_nofollow" ).prop( "checked", false );
										}
										for ( var i = 1; i <= 8; i ++ ) {
											if ( element.hasClass( 'tve_btn' + i ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#tve_btn' + i ) );
												break;
											}
										}
										jQuery.each( "tve_smallBtn tve_normalBtn tve_bigBtn tve_hugeBtn".split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
							
										jQuery( "#tve_icon_button_font_size" ).val( parseInt( element.find( 'i' ).first().css( 'font-size' ) ) );
										jQuery( "#tve_icon_button_font_size_slider" ).slider( "value", parseInt( element.find( 'i' ).first().css( 'font-size' ) ) );
							
										jQuery( "#tve_image_button_size_input" ).val( parseInt( element.find( 'i' ).first().css( 'width' ) ) );
										jQuery( "#tve_button_image_size_slider" ).slider( "value", parseInt( element.find( 'i' ).first().css( 'width' ) ) );
										break;
									case "calltoaction" :
										// call to action button location
										jQuery( "#call_to_action_url" ).val( element.find( "a.tve_btnLink" ).attr( "href" ) );
										// open in new window checkbox?
										if ( element.find( "a.tve_btnLink" ).attr( "target" ) == "_blank" ) {
											jQuery( "#cta_link_new_window" ).prop( "checked", true );
										} else {
											jQuery( "#cta_link_new_window" ).prop( "checked", false );
										}
							
										if ( element.find( "a.tve_btnLink" ).attr( "rel" ) == "nofollow" ) {
											jQuery( "#cta_nofollow" ).prop( "checked", true );
										} else {
											jQuery( "#cta_nofollow" ).prop( "checked", false );
										}
										break;
							
									case "img" :
										element = element.find( 'img' );
										if ( jQuery( element ).parent().is( "a" ) ) {
											$menu.find( ".tve_quick_link_input" ).val( jQuery( element ).parent().attr( "href" ) );
											$menu.find( ".lb_quick_link_target" ).prop( "checked", (jQuery( element ).parent().attr( "target" ) == "_blank") ? true : false );
											$menu.find( ".lb_quick_link_no_follow" ).prop( "checked", (jQuery( element ).parent().attr( "rel" ) == "nofollow") ? true : false );
										} else {
											$menu.find( ".tve_quick_link_input" ).val( "" );
											$menu.find( ".quick_link_content_table" ).html( "" );
											$menu.find( ".lb_quick_link_target" ).prop( "checked", tve_path_params.lb_ql_link_target );
											$menu.find( ".lb_quick_link_no_follow" ).prop( "checked", tve_path_params.lb_ql_no_follow );
										}
							
										var $control = element.tve_image();
										var width = element.width(),
											height = element.height(),
											_value = parseInt( element.css( 'borderLeftWidth' ) );
							
										if ( width ) {
											var max = element.closest( '.thrv_wrapper' ).parent().width(),
												ml = parseInt( $control.e.css( 'margin-left' ) ),
												mr = parseInt( $control.e.css( 'margin-right' ) );
											max = ! isNaN( ml ) ? max - ml : max;
											max = ! isNaN( mr ) ? max - mr : max;
							
											if ( width > max ) {
												width = max;
											}
											jQuery( "#image_width_input" ).val( width );
											jQuery( "#tve_img_size_slider" ).slider( 'option', 'max', max ).slider( "value", parseInt( width ) );
										}
										// Removed so it won't overwrite tcb 2.0 values
							//			element.attr( 'width', parseInt( width ) );
										element.attr( 'height', parseInt( height ) );
							
										jQuery( '#image_border_width' ).val( isNaN( _value ) ? '0' : _value );
										jQuery( "#img_alt_att" ).val( element.attr( "alt" ) );
										jQuery( "#img_title_att" ).val( element.attr( "title" ) );
										handle_custom_classes( element );
										handle_custom_classes( element.closest( '.tve_image_caption' ), $menu, '.tve_capt_cls' );
							
										jQuery.each( img_styles.split( ' ' ), function ( i, v ) {
											if ( $control.hasStyle( v ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( $control.hasStyle( '__none__' ) ) {
											tve_set_selected_dropdown( $menu.find( 'li.img_style' ).last() );
										}
										break;
									case 'text_inline_only':
										var _temp_value = tve_handle_integer_or_float( element.css( 'font-size' ) )
										$menu.find( '.tve_font_size' ).val( _temp_value );
										jQuery( ".element_id" ).val( element.attr( "id" ) );
										handle_custom_fonts( element, $menu )
										break;
									case "text" :
										var active_link = jQuery( ".tve_active_hyperlink" );
										if ( active_link ) {
											$menu.find( ".tve_quick_link_input" ).val( jQuery( active_link ).attr( "href" ) );
											var $target = $menu.find( ".lb_quick_link_target" ),
												$follow = $menu.find( ".lb_quick_link_no_follow" );
											if ( jQuery( active_link ).attr( "target" ) == "_blank" ) {
												$target.addClass( 'filled-in' ).prop( "checked", true );
											}
											if ( jQuery( active_link ).attr( "target" ) == "_blank" ) {
												$follow.addClass( 'filled-in' ).prop( "checked", true );
											}
										} else {
											$menu.find( ".tve_quick_link_input" ).val( "" );
											$menu.find( ".quick_link_content_table" ).html( "" );
											$menu.find( ".lb_quick_link_target" ).prop( "checked", tve_path_params.lb_ql_link_target );
											$menu.find( ".lb_quick_link_no_follow" ).prop( "checked", tve_path_params.lb_ql_no_follow );
										}
										var f_size = element.css( 'font-size' );
										/**
										 * this covers the following case: the font size has been set by selecting the whole node contents and applied a font size on that selection
										 *
										 */
										if ( element.find( 'span.tve_custom_font_size' ) && jQuery.trim( element.text() ) == jQuery.trim( element.find( 'span.tve_custom_font_size' ).text() ) ) {
											f_size = element.find( 'span.tve_custom_font_size' ).css( 'font-size' );
										}
							
										var _temp_value = tve_handle_integer_or_float( f_size );
										$menu.find( '.tve_font_size' ).val( _temp_value );
										$menu.find( ".element_id" ).val( element.attr( "id" ) );
										jQuery.each( "p address pre blockquote h1 h2 h3 h4 h5 h6".split( ' ' ), function ( i, v ) {
											if ( element.is( v ) ) {
												tve_set_selected_dropdown( $menu.find( 'li.tve_block_change[data-tag="' + v + '"]' ) );
												return false;
											}
										} );
										handle_custom_classes( element );
										handle_custom_fonts( element, $menu );
										break;
									case "cc_icons" :
										jQuery( ".cc_checkbox" ).prop( "checked", false );
										element.find( ".tve_cc_logo:visible" ).each( function () {
											cc_type = jQuery( this ).attr( "class" );
											cc_type_array = cc_type.split( " " );
											for ( i = 0; i < cc_type_array.length; i ++ ) {
												if ( cc_type_array[i] != "tve_cc_logo" && cc_type_array[i] != "tve_no_edit" ) {
													card_type = cc_type_array[i].substring( 4 );
													jQuery( "#" + card_type ).prop( "checked", true );
												}
											}
										} );
										break;
									case "pricing_table" :
										handle_custom_classes( element );
										TVE_Content_Builder.controls.pricing_table.highlight_btn( $menu.find( '.tve_btn_highlight' ), element );
										break;
									case 'table' :
										element = get_element_from_wrapper( element, 'table' );
										var _value = parseInt( element.css( 'borderLeftWidth' ) ),
											_cellpadding = parseInt( element.find( 'td,th' ).first().css( 'paddingTop' ) ),
											_rowHeight = parseInt( element.find( 'td,th' ).first().height() ),
											_brdrFound = false;
							
										jQuery( '#table_border_width' ).val( isNaN( _value ) ? '0' : _value );
										jQuery( '#table_cell_padding' ).val( isNaN( _cellpadding ) ? '5' : _cellpadding );
										jQuery( '#table_outer_border' ).prop( 'checked', (element.hasClass( 'tve_no_border' ) ? false : true) );
										jQuery( '#table_inner_border' ).prop( 'checked', (element.hasClass( 'tve_no_inner_border' ) ? false : true) );
										var has_merged = false;
										element.find( 'th,td' ).each( function () {
											var $this = jQuery( this );
							
											if ( $this.tve_rowspan() > 1 || $this.tve_colspan() > 1 ) {
												has_merged = true;
												return false;
											}
										} );
							
										jQuery( '#table_make_sortable' ).prop( 'checked', ! has_merged && element.hasClass( 'tve_make_sortable' ) ).prop( 'disabled', has_merged );
							
										jQuery( '#table_row_height' ).val( isNaN( _rowHeight ) ? 0 : _rowHeight );
							
										jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												_brdrFound = true;
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( ! _brdrFound ) {
											tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
										}
										break;
									case 'table_cell':
										var _value = parseInt( element.css( 'borderLeftWidth' ) ),
											_width = element.width(),
											_height = element.height();
										jQuery( '#table_cell_border_width' ).val( isNaN( _value ) ? '0' : _value );
										jQuery( '#table_cell_width' ).val( _width );
										jQuery( '#table_cell_height' ).val( _height );
										break;
									case 'page_section':
										jQuery( '#tve_page_section_bg_fixed' ).prop( 'checked', element.find( '> .out.pswr > .in.pdwbg' ).length ? true : false );
										jQuery( '#tve_page_section_auto_height' ).prop( 'checked', element.find( '> .out.pswr > .in.pdfbg' ).length ? true : false );
										jQuery( '#tve_page_section_tmg' ).prop( 'checked', element.find( '> .out.tmg' ).length ? true : false );
										jQuery( '#tve_page_section_bmg' ).prop( 'checked', element.find( '> .out.bmg' ).length ? true : false );
										$menu.find( '.element_id' ).val( element.attr( 'id' ) );
										break;
									case 'thrive_leads_shortcode':
										var ctrl = element.tve_thrive_leads_shortcode();
										tve_set_selected_dropdown( $menu.find( 'li.tve-o-leads-shortcode[data-value="' + ctrl.config().id + '"]' ) );
										break;
									case 'thrive_optin':
										var ctrl = element.tve_thrive_optin();
										jQuery( '#tve_thrive_optin_text' ).val( ctrl.config().text );
										tve_set_selected_dropdown( $menu.find( 'li.tve-o-optin[data-value="' + ctrl.config().optin + '"]' ) );
										tve_set_selected_dropdown( $menu.find( 'li.tve-o-layout[data-value="' + ctrl.config().layout + '"]' ) );
										tve_set_selected_dropdown( $menu.find( 'li.tve-o-color[data-value="' + ctrl.config().color + '"]' ) );
										tve_set_selected_dropdown( $menu.find( 'li.tve-o-size[data-value="' + ctrl.config().size + '"]' ) );
										break;
									case 'content_container':
										handle_custom_classes( element, $menu );
										$menu.find( '.element_id' ).val( element.attr( 'id' ) );
										if ( ! element.is( '.tve_content_inner' ) ) {
											element = get_element_from_wrapper( element, type );
										}
										var width = parseInt( element.css( 'width' ) );
										if ( ! isNaN( width ) ) {
											$menu.find( '#content_container_width_input' ).val( width ).trigger( 'change' );
										}
										break;
									case 'content_reveal':
										var _value = parseInt( element.attr( 'data-after' ) ),
											$inputs = jQuery( '#content_reveal_menu .content_reveal_after' );
										$inputs.filter( '.seconds' ).val( _value % 60 );
										$inputs.filter( '.minutes' ).val( Math.floor( _value / 60 ) ).trigger( 'change' );
										jQuery( "#content_reveal_redirect_url" ).val( element.attr( 'data-redirect-url' ) );
										jQuery( "#content_reveal_scroll" ).prop( 'checked', element.attr( 'data-scroll' ) ? true : false );
										break;
									case 'bullets':
										element = get_element_from_wrapper( element, type );
										for ( var i = 1; i <= 6; i ++ ) {
											if ( element.hasClass( 'tve_ul' + i ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#tve_ul' + i ) );
												break;
											}
										}
										break;
									case 'feature_grid':
										for ( var i = 1; i <= 3; i ++ ) {
											if ( element.hasClass( 'tve_gr' + i ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#tve_gr' + i ) );
												break;
											}
										}
										break;
									case 'countdown_timer_evergreen':
										var $timer = element.tve_countdown_timer_evergreen(),
											norestarttimer = element.attr( 'data-norestart' );
										$menu.find( '#ct_day' ).val( $timer.get( 'day' ) );
										$menu.find( '#ct_hour' ).val( $timer.get( 'hour' ) );
										$menu.find( '#ct_min' ).val( $timer.get( 'min' ) );
										$menu.find( '#ct_sec' ).val( $timer.get( 'sec' ) );
										$menu.find( '#ct_text' ).val( $timer.get( 'text' ) );
										$menu.find( '#ct_expday' ).val( $timer.get( 'expday' ) );
										$menu.find( '#ct_exphour' ).val( $timer.get( 'exphour' ) );
										if ( norestarttimer == 0 || norestarttimer == null ) {
											$menu.find( '#ct_no_restart' ).prop( 'checked', false );
											$menu.find( '.tve_countdown_time' ).show( 0 );
										} else {
											$menu.find( '#ct_no_restart' ).prop( 'checked', true );
											$menu.find( '.tve_countdown_time' ).hide( 0 );
										}
										$menu.find( ".tve_input_translatable" ).each( function () {
											var $this = jQuery( this ),
												_value = element.first().find( $this.data( 'args' ) ).text(); // added first() to handle multiple-selection edits
											$this.val( _value );
										} );
										break;
									case 'countdown_timer':
										var $timer = element.tve_countdown_timer();
										$menu.find( '#ct_date' ).val( $timer.get( 'date' ) );
										$menu.find( '#ct_hour' ).val( $timer.get( 'hour' ) );
										$menu.find( '#ct_min' ).val( $timer.get( 'min' ) );
										$menu.find( '#ct_text' ).val( $timer.get( 'text' ) );
										$menu.find( ".tve_input_translatable" ).each( function () {
											var $this = jQuery( this ),
												_value = element.find( $this.data( 'args' ) ).text();
											$this.val( _value );
										} );
							
										var $selected_style = $menu.find( '#tve_countdown_1' );
										for ( var i = 1; i <= 3; i ++ ) {
											$selected_style = element.hasClass( 'tve_countdown_' + i ) ? $menu.find( '#tve_countdown_' + i ) : $selected_style;
										}
										tve_set_selected_dropdown( $selected_style );
										break;
									case 'thrive_posts_list':
										var $shortcode = element.tve_thrive_posts_list();
										$menu.find( '#posts_list_no_posts' ).val( $shortcode.config().no_posts );
										$menu.find( '#posts_list_filter' ).val( $shortcode.config().filter );
										$menu.find( '#posts_list_category' ).val( $shortcode.config().category );
										$menu.find( '#posts_list_thumbnails' ).prop( 'checked', $shortcode.config().thumbnails != 'off' );
										break;
									case 'thrive_custom_phone':
										var $shortcode = element.tve_thrive_custom_phone();
										$menu.find( '#custom_phone_color' ).val( $shortcode.config().color );
										$menu.find( '#custom_phone_no' ).val( $shortcode.config().phone_no );
										$menu.find( '#custom_phone_text' ).val( $shortcode.config().phone_text );
										$menu.find( '#custom_mobile_phone_text' ).val( $shortcode.config().mobile_phone_text );
										break;
									case 'thrive_custommenu':
										var $shortcode = element.tve_thrive_custom_menus();
										$menu.find( '#custom_menu_menu' ).val( $shortcode.config().menu );
										$menu.find( '#custom_menu_thumbnails' ).prop( 'checked', $shortcode.config().thumbnails != 'off' );
										break;
									case 'responsive_video':
										var video = element.tve_responsive_video(),
											url = video.config( 'url' ),
											type = video.config( 'type' ),
											overlay = video.config( 'overlay' ),
											embed_type = video.config( 'embed_type' ),
											_w = video.config( 'video-width' ),
											_h = video.config( 'video-height' );
							
										if ( typeof video.config( 'overlay' ) === 'undefined' ) {
											overlay = 0;
											video.set( overlay, 'overlay' );
										}
							
										if ( typeof video.config( 'type' ) === 'undefined' ) {
											type = 'youtube';
											video.set( type, 'type' );
										}
							
										if ( typeof video.config( 'embed_type' ) === 'undefined' ) {
											embed_type = 'inline';
											video.set( embed_type, 'embed_type' );
										}
										jQuery.each( rv_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										var _f = false;
										jQuery.each( rv_play_buttons.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												_f = true;
												return false;
											}
										} );
										if ( ! _f ) {
											tve_set_selected_dropdown( $menu.find( '#tve_add_play_button li' ).last() );
										}
							
										/* Display the correct fields for each video type */
										$menu.find( '.responsive_video_option' ).each( function () {
											var $this = jQuery( this );
											if ( $this.attr( 'data-apply-to' ).indexOf( type ) !== - 1 ) {
												$this.css( 'display', 'block' );
											} else {
												$this.css( 'display', 'none' );
											}
										} );
							
										if ( embed_type == 'popover' ) {
											$menu.find( "#tve_thumbnail_size_options" ).show();
										} else {
											$menu.find( "#tve_thumbnail_size_options" ).hide();
										}
										if ( parseInt( overlay ) !== 0 ) {
											$menu.find( "#tve_video_overlay" ).text( 'Modify Video Thumbnail' ).next().show().next().show();
											$menu.find( "#rv_option_autoplay" ).attr( "disabled", true ).after( '<span class="tve_tooltip tve_tooltip_over" data-title="Disabled when video thumbnail is active">' );
										} else if ( parseInt( video.config( 'autoplay' ) ) === 1 ) {
											$menu.find( "#tve_video_overlay" ).removeClass( 'tve_click' ).addClass( 'tve_btn_disabled' ).append( '<span class="tve_tooltip tve_tooltip_over" data-title="Disabled when video autoplay option is active">' ).next().hide().next().hide();
										} else {
											$menu.find( "#tve_video_overlay" ).text( 'Add Video Thumbnail' ).next().hide().next().hide();
										}
							
										$menu.find( "#responsive_video_type" ).val( type );
										$menu.find( "#responsive_video_embed_type" ).val( embed_type );
										$menu.find( "#responsive_video_url" ).val( url );
										$menu.find( '#responsive_video_start_min_time' ).val( typeof video.config( 'start-time' ) === 'undefined' ? 0 : parseInt( video.config( 'start-time' ) / 60 ) );
										$menu.find( '#responsive_video_start_sec_time' ).val( typeof video.config( 'start-time' ) === 'undefined' ? 0 : video.config( 'start-time' ) % 60 );
							
										$menu.find( '#rv_option_rel' ).prop( 'checked', typeof video.config( 'rel' ) === 'undefined' ? false : video.config( 'rel' ) === '0' );
										$menu.find( '#rv_option_modestbranding' ).prop( 'checked', typeof video.config( 'modestbranding' ) === 'undefined' ? false : video.config( 'modestbranding' ) === '1' );
										$menu.find( '#rv_option_controls' ).prop( 'checked', typeof video.config( 'controls' ) === 'undefined' ? false : video.config( 'controls' ) === '0' );
										$menu.find( '#rv_option_showinfo' ).prop( 'checked', typeof video.config( 'showinfo' ) === 'undefined' ? false : video.config( 'showinfo' ) === '0' );
										$menu.find( '#rv_option_autoplay' ).prop( 'checked', typeof video.config( 'autoplay' ) === 'undefined' ? false : video.config( 'autoplay' ) === '1' );
										$menu.find( '#rv_option_fs' ).prop( 'checked', typeof video.config( 'fs' ) === 'undefined' ? false : video.config( 'fs' ) === '0' );
										$menu.find( '#rv_option_play_bar' ).prop( 'checked', typeof video.config( 'play-bar' ) === 'undefined' ? true : video.config( 'play-bar' ) === '1' );
										$menu.find( '#rv_option_onload_controls' ).prop( 'checked', typeof video.config( 'onload-controls' ) === 'undefined' ? true : video.config( 'onload-controls' ) === '1' );
							
										$menu.find( '#rv_option_video_width' ).val( _w ? parseInt( _w ) : '' );
										$menu.find( '#rv_option_video_height' ).val( _h ? parseInt( _h ) : '' );
							
										break;
									case 'contents_table':
										var table = element.tve_contents_table();
										$menu.find( '.ct_heading' ).each( function () {
											var $this = jQuery( this );
											$this.prop( 'checked', table.config( 'headers' ).indexOf( $this.val() ) >= 0 );
										} );
										$menu.find( '#ct_columns' ).val( table.config( 'columns' ) );
							
										var minWidth = parseInt( element.css( 'min-width' ) );
										var maxWidth = element.css( 'max-width' );
										$menu.find( "#ct_min_width" ).val( minWidth );
										$menu.find( "#ct_max_width" ).val( maxWidth !== 'none' ? parseInt( maxWidth ) : maxWidth );
										break;
									case 'tabs':
										var $tabControl = element.tve_tabs().populateTabList();
										if ( $tabControl.isVertical() ) {
											var width = element.find( 'ul' ).width();
											jQuery( '#vtabs_width_input' ).val( width + 'px' );
											jQuery( '#s_vtabs_menu_width' ).slider( 'value', width );
										}
										var _selected = $menu.find( 'li.tve_selected_tab' ).eq( $tabControl.getDefaultSelected() );
										tve_set_selected_dropdown( _selected, _selected.length === 0 );
										break;
									case 'tw_qs':
										var tw_qs = element.tve_tw_qs(),
											has_custom_url = tw_qs.config( 'use_custom_url' );
										$menu.find( "#qs_tw_via" ).val( tw_qs.config( 'via' ) );
										$menu.find( '#qs_tw_use_custom' ).prop( 'checked', has_custom_url ? true : false ).trigger( 'change' );
										$menu.find( '#qs_tw_url' ).val( has_custom_url ? tw_qs.config( 'custom_url' ) : '' );
										break;
									case 'rating':
										var _rate = element.tve_rating();
										jQuery( '#rating_value' ).val( _rate.get( 'value' ) );
										jQuery( '#rating_max' ).val( _rate.get( 'max' ) );
										break;
									case 'lead_generation_checkbox':
										handle_custom_classes( element );
										//handle max width slider
										var width = parseInt( element.outerWidth() ),
											max_width = parseInt( element.parent().width() );
										$menu.find( "#tve_lg_input" ).val( width + 'px' );
										$menu.find( "#tve_lg_checkbox_slider" ).slider( "value", width ).slider( "option", "max", max_width );
										//load label font-size
										var _temp_value = tve_handle_integer_or_float( element.find( 'label' ).css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
										break;
									case 'lead_generation_textarea':
										handle_custom_classes( element, $menu );
										//set max width slider input
										var width = parseInt( element.css( 'width' ) ),
											max_width = parseInt( element.parents( '.thrv_lead_generation' ).first().css( 'width' ) );
										$menu.find( "#tve_lg_textarea" ).val( width );
										//set max width value for max-width slider
										$menu.find( "#tve_lg_textarea_slider" ).slider( "value", width ).slider( 'option', 'max', max_width );
										//set height slider input
										var height = parseInt( element.css( 'height' ) );
										$menu.find( "#tve_lg_textarea_height" ).val( height );
										//set height value for slider
										$menu.find( "#tve_lg_textarea_height_slider" ).slider( "value", height );
							
										//set font-size
										var _temp_value = tve_handle_integer_or_float( element.css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
							
										//manage border
										var _brdrFound = false;
										$menu.find( "#tl_textarea_border_width" ).val( parseInt( element.css( 'borderLeftWidth' ) ) );
										jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												_brdrFound = true;
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( ! _brdrFound ) {
											tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
										}
							
										break;
									case 'lead_generation_radio':
										//handle custom classe
										handle_custom_classes( element, $menu );
										//handle columns dropdown
										for ( var i = 1; i <= 10; i ++ ) {
											if ( element.hasClass( 'tve_lg_column' + i ) ) {
												tve_set_selected_dropdown( $menu.find( 'li[data-cls="tve_lg_column' + i + '"]' ) );
												break;
											}
										}
										//handle max width slider
										var width = parseInt( element.width() ),
											max_width = parseInt( element.parent().width() );
										$menu.find( "#tve_lg_input" ).val( width + 'px' );
										$menu.find( "#tve_lg_radio_slider" ).slider( "value", width ).slider( "option", "max", max_width );
							
										//set label font-size
										var _temp_value = tve_handle_integer_or_float( element.find( 'label' ).css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
										break;
									case 'lead_generation_dropdown':
										handle_custom_classes( element, $menu );
										//set max width slider input
										var width = parseInt( element.css( 'width' ) ),
											max_width = parseInt( element.parents( '.thrv_lead_generation' ).first().css( 'width' ) );
										$menu.find( "#tve_lg_dropdown" ).val( width );
										//set max width value for max-width slider
										$menu.find( "#tve_lg_dropdown_slider" ).slider( "value", width ).slider( 'option', 'max', max_width );
										//load font-size
										var _temp_value = tve_handle_integer_or_float( element.css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
							
										//manage border
										var _brdrFound = false;
										$menu.find( "#tl_dropdown_border_width" ).val( parseInt( element.css( 'borderLeftWidth' ) ) );
										jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												_brdrFound = true;
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( ! _brdrFound ) {
											tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
										}
										break;
									case 'lead_generation_input':
										handle_custom_classes( element, $menu );
										//set max width slider input
										var width = parseInt( element.css( 'width' ) ),
											max_width = parseInt( element.parents( '.thrv_lead_generation' ).first().css( 'width' ) );
										$menu.find( "#tve_lg_input" ).val( width );
										//set max width value for max-width slider
										$menu.find( "#tve_lg_input_slider" ).slider( "value", width ).slider( 'option', 'max', max_width );
							
										//manage border
										var _brdrFound = false;
										$menu.find( "#tl_input_border_width" ).val( parseInt( element.css( 'borderLeftWidth' ) ) );
										jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												_brdrFound = true;
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( ! _brdrFound ) {
											tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
										}
										var _temp_value = tve_handle_integer_or_float( element.css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
							
										break;
									case 'lead_generation_submit':
										handle_custom_classes( element, $menu );
										handle_custom_fonts( element, $menu );
							
										//manage border
										var _brdrFound = false;
										$menu.find( "#tl_button_border_width" ).val( parseInt( element.css( 'borderLeftWidth' ) ) );
										jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												_brdrFound = true;
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( ! _brdrFound ) {
											tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
										}
							
										//set font size
										var _temp_value = tve_handle_integer_or_float( element.css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
										//set button text
										$menu.find( '#lead_generation_button_text' ).val( element.text() );
							
										var width = parseInt( element.outerWidth() ),
											max_width = parseInt( element.parents( '.thrv_lead_generation' ).first().width() );
										$menu.find( "#tve_lg_submit_width_input" ).val( width );
										//set max width value for max-width slider
										$menu.find( "#tve_lg_submit_button_slider" ).slider( "value", width ).slider( 'option', 'max', max_width );
										break;
									case 'lead_generation_image_submit':
										handle_custom_classes( element, $menu );
										var image_width = parseInt( element.css( 'width' ) );
										$menu.find( "#tve_lg_image_submit_width_input" ).val( image_width );
										$menu.find( "#tve_lg_image_submit_width" ).slider( "value", image_width );
										break;
									case 'lead_generation':
										$menu.find( '.tve_lg_custom_menu' ).hide();
										var _temp_value = tve_handle_integer_or_float( element.find( 'input[type="text"]' ).css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
										tve_set_selected_dropdown( element.is( '.thrv_lead_generation_horizontal' ) ? $menu.find( '#thrv_lead_generation_horizontal' ) : $menu.find( '#thrv_lead_generation_vertical' ) );
							
										//check the target
										var $formTargetInput = $menu.find( '#lead_generation_form_target' );
										$formTargetInput.prop( 'checked', element.data( 'form-target' ) === $formTargetInput.val() );
										if ( element.attr( 'data-connection' ) === 'custom-html' ) {
											$formTargetInput.parents( 'li' ).first().tve_css( 'display', 'block', 'important' );
										} else {
											$formTargetInput.parents( 'li' ).first().tve_css( 'display', 'none', 'important' );
										}
										var width = element.css( "width" );
										if ( width ) {
											var max = element.closest( '.thrv_wrapper' ).parent().width();
											$menu.find( "#lead_generation_width_input" ).val( width );
											jQuery( "#tve_lead_generation_size_slider" ).slider( 'option', 'max', max ).slider( "value", parseInt( width ) );
										}
							
										var inputs_width = parseInt( element.find( '.tve_lg_2, .tve_lg_3, .tve_lg_input_container' ).outerWidth() );
										if ( inputs_width ) {
											$menu.find( "#lead_generation_widths_input" ).val( inputs_width );
											jQuery( "#tve_lead_generation_widths_slider" ).slider( "value", inputs_width );
										}
										/* removed input heights control, as it was causing problems for a lot of users
										 var height = element.find('input[type="text"]').first().css('height');
										 if (height) {
										 height = parseInt(height);
										 $menu.find("#lead_generation_height_input").val(height);
										 jQuery("#tve_lead_generation_height_slider").slider('value', height);
										 }*/
										var errors = {};
										if ( ! element.find( '.tve-lg-err-msg' ).length ) {
											errors = {
												"email": tve_path_params.translations.LeadGenerationEmail,
												"phone": tve_path_params.translations.LeadGenerationPhone,
												"required": tve_path_params.translations.LeadGenerationRequired
											};
											element.prepend( '<input type="hidden" class="tve-lg-err-msg" value="" />' );
											element.find( '.tve-lg-err-msg' ).val( JSON.stringify( errors ) );
										} else {
											errors = JSON.parse( element.find( '.tve-lg-err-msg' ).val() );
										}
							
										$menu.find( '#tve_lg_email_error' ).val( errors.email );
										$menu.find( '#tve_lg_phone_error' ).val( errors.phone );
										$menu.find( '#tve_lg_required_error' ).val( errors.required );
							
										break;
									case 'contentbox':
										handle_custom_classes( element );
										$menu.find( '.element_id' ).val( element.find( '.tve_cb' ).first().attr( 'id' ) );
										var radius = parseInt( element.find( '.tve_cb' ).css( 'border-top-left-radius' ) );
										radius = isNaN( radius ) ? 0 : radius;
										$menu.find( '#border_radius_input' ).val( radius );
										$menu.find( '#tve_border_radius_slider' ).slider( "value", radius );
										break;
									case 'lightbox':
										element = get_element_from_wrapper( element, type );
										var opacity = parseFloat( jQuery( '.tve_p_lb_overlay' ).css( 'opacity' ) ),
											_brdrFound = false,
											_value = parseInt( element.css( 'borderLeftWidth' ) ),
											_mw = parseInt( element.css( 'max-width' ) ),
											_mh = parseInt( element.find( '#tve-p-scroller' ).css( 'max-height' ) );
							
										opacity = isNaN( opacity ) ? 80 : opacity * 100;
										jQuery( "#lightbox_opacity_input" ).val( opacity ).trigger( 'change' );
										jQuery( '#lightbox_border_width' ).val( isNaN( _value ) ? '0' : _value );
										jQuery( '#lightbox_max_width' ).val( isNaN( _mw ) ? '0' : _mw );
										jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												_brdrFound = true;
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( ! _brdrFound ) {
											tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
										}
										break;
									case 'landing_page':
										jQuery( '#tve_lp_bg_fixed' ).prop( 'checked', jQuery( 'body' ).css( 'background-attachment' ) == 'fixed' );
										jQuery( '#tve_strip_css' ).prop( 'checked', TVE.CONST.tve_globals.do_not_strip_css == '1' ? true : false );
										break;
									case 'landing_page_content':
										jQuery( '#tve_lp_bg_fixed' ).prop( 'checked', element.css( 'background-attachment' ) == 'fixed' );
										jQuery( '#tve_lp_auto_height' ).prop( 'checked', element.hasClass( 'tve_fh' ) );
										if ( TVE_Content_Builder.landing_page && TVE_Content_Builder.landing_page.content_width_selector ) {
											var wElement = jQuery( TVE_Content_Builder.landing_page.content_width_selector() );
											var width = parseInt( wElement.css( 'max-width' ) );
											if ( ! isNaN( width ) ) {
												jQuery( '#lp_content_width' ).val( width ).trigger( 'change' );
											}
										}
										var radius = parseInt( element.css( 'border-top-left-radius' ) );
										radius = isNaN( radius ) ? 0 : radius;
										$menu.find( '#border_radius_input' ).val( radius );
										$menu.find( '#tve_border_radius_slider' ).slider( "value", radius );
										break;
									case 'post_grid':
										if ( ! element.data( 'bound' ) ) {
											element.on( 'editor.oncolorpickerchange', function ( e, unique_selector, config ) {
												element.tve_post_grid().config().update( unique_selector, config.save_key );
											} );
											element.data( 'bound', 1 );
										}
										var _temp_value = tve_handle_integer_or_float( element.find( '.tve-post-grid-title' ).css( 'font-size' ) );
										$menu.find( '.tve_font_size' ).val( _temp_value );
							
										var image_height = parseInt( element.find( '.tve_post_grid_image_wrapper' ).first().css( 'height' ) );
										$menu.find( '.tve_height' ).val( isNaN( image_height ) ? '' : image_height );
							
										var $post_grid = element.tve_post_grid();
										var read_more_text = $post_grid.config().get( 'read-more-text' );
										read_more_text = read_more_text.length ? read_more_text : element.find( '.tve_pg_more > a' ).first().text();
										$menu.find( '#tve-post-grid-read-more-text' ).val( read_more_text );
							
										break;
									case 'widget_menu':
										handle_custom_classes( element );
										var config = element.tve_widget_menu().config(),
											$target = element.find( '.tve_w_menu' ),
											font_size = tve_handle_integer_or_float( $target.css( 'font-size' ) );
										tve_set_selected_dropdown( $menu.find( '.tve_menu_selector li[data-id="' + config.menu_id + '"]' ) );
										handle_custom_fonts( $target, $menu );
										$menu.find( '.tve_font_size' ).val( isNaN( font_size ) ? '' : font_size );
										tve_set_selected_dropdown( $menu.find( '.tve_menu_dir li[data-type="' + config.dir + '"]' ) );
										$menu.find( '.tve_menu_title' ).val( config.title );
										var _link = $menu.find( '.menu-edit-link' ).attr( 'href' ).replace( /&menu=(\d*)/, '&menu=' + config.menu_id );
										$menu.find( '.menu-edit-link' ).attr( 'href', _link );
										$menu.find( '#tve_menu_primary' ).prop( 'checked', config.primary ? true : false );
										break;
									case 'icon':
										element = get_element_from_wrapper( element, type );
										if ( jQuery( element ).parent().is( "a" ) ) {
											$menu.find( ".tve_quick_link_input" ).val( jQuery( element ).parent().attr( "href" ) );
											$menu.find( ".lb_quick_link_target" ).prop( "checked", (jQuery( element ).parent().attr( "target" ) == "_blank") ? true : false );
											$menu.find( ".lb_quick_link_no_follow" ).prop( "checked", (jQuery( element ).parent().attr( "rel" ) == "nofollow") ? true : false );
										} else {
											$menu.find( ".tve_quick_link_input" ).val( "" );
											$menu.find( ".quick_link_content_table" ).html( "" );
											$menu.find( ".lb_quick_link_target" ).prop( "checked", tve_path_params.lb_ql_link_target );
											$menu.find( ".lb_quick_link_no_follow" ).prop( "checked", tve_path_params.lb_ql_no_follow );
										}
										if ( element.hasClass( 'tve_sc_text' ) ) {
											jQuery( '#tve_icon_text' ).val( element.text() );
										}
										var font_size = tve_handle_integer_or_float( element.css( "font-size" ) ),
											_brdrFound = false,
											radius = parseInt( element.css( 'border-top-left-radius' ) ),
											_value = parseInt( element.css( 'borderLeftWidth' ) ),
											padding = parseInt( element.css( 'paddingTop' ) );
										padding = isNaN( padding ) ? 0 : padding;
										font_size = isNaN( font_size ) ? 0 : font_size;
										radius = isNaN( radius ) ? 0 : radius;
										_value = isNaN( _value ) ? 0 : _value;
							
										if ( _value && ! element.data( 'border-width' ) ) { // move the border to the parent wrapper
											element.parent().css( 'border-width', _value + 'px' );
											element.css( 'border-width', '' );
											element.data( 'border-width', true );
										}
										/* move the border-color to the parent */
										if ( element.tve_color_selector() && element.css( 'border-top-color' ) && ! element.data( 'border-color' ) && _value ) {
											element.parent().css( 'border-color', element.css( 'border-top-color' ) );
											tve_remove_css_rule( element.tve_color_selector(), 'border-color' );
											element.data( 'border-color', true );
										}
										if ( element.parent().css( 'borderLeftWidth' ) ) {
											_value = parseInt( element.parent().css( 'borderLeftWidth' ) );
										}
										if ( font_size ) {
											var max = element.closest( '.thrv_wrapper' ).parent().width();
											jQuery( "#icon_size_input" ).val( font_size );
											jQuery( "#tve_icon_size_slider" ).slider( 'option', 'max', max ).slider( "value", font_size );
											jQuery( "#icon_padding_input" ).val( padding ).trigger( 'change' );
											$menu.find( '#border_radius_input' ).val( radius ).trigger( 'change' );
										}
							
										/* move margin to the parent element */
										jQuery.each( [
											'margin-top',
											'margin-right',
											'margin-bottom',
											'margin-left'
										], function ( i, v ) {
											var _m = parseInt( element.css( v ) );
											if ( ! isNaN( _m ) && _m !== 0 ) {
												element.parent().css( v, _m + 'px' );
											}
											element.css( v, '' );
										} );
							
										jQuery( '#icon_border_width' ).val( isNaN( _value ) ? '0' : _value );
										handle_custom_classes( element.parents( '.thrv_icon' ).first() );
							
										jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												_brdrFound = true;
												element.removeClass( v );
												element.parent().addClass( v );
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
											if ( element.parent().hasClass( v ) ) {
												_brdrFound = true;
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										if ( ! _brdrFound ) {
											tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
										}
										break;
									case "progress_bar":
										_value = parseInt( element.css( 'borderLeftWidth' ) );
							
										handle_custom_classes( element );
										jQuery( '#tve_data_element_label_p' ).val( element.first().find( '.tve_data_element_label' ).text().trim() ); // added first() so that it will read in the correct text when multiple elements are selected
										jQuery( '#tve_data_element_percentage' ).val( element.find( '.tve_progress_bar_fill_wrapper' ).attr( 'data-fill' ) );
										var _temp_value_fz = tve_handle_integer_or_float( element.find( '.tve_progress_bar' ).css( 'font-size' ) ),
											_temp_value_lh = tve_handle_integer_or_float( element.find( '.tve_data_element_label' ).css( 'line-height' ) );
										jQuery( '#tve_data_element_font_size' ).val( _temp_value_fz );
										jQuery( '#tve_data_element_line_height' ).val( _temp_value_lh );
										$menu.find( '.element_id' ).val( element.attr( 'id' ) );
										jQuery( '#progress_bar_border_width' ).val( isNaN( _value ) ? '0' : _value );
										break;
									case "fill_counter":
										_value = parseInt( element.css( 'borderLeftWidth' ) );
							
										handle_custom_classes( element );
										jQuery( '#tve_data_element_value_f' ).val( element.find( '.tve_fill_text' ).text().trim() );
										jQuery( '#tve_data_element_label_f' ).val( element.find( '.tve_data_element_label' ).text().trim() );
										jQuery( '#tve_data_element_unit_b_f' ).val( element.find( '.tve_fill_text_before' ).text().trim() );
										jQuery( '#tve_data_element_unit_a_f' ).val( element.find( '.tve_fill_text_after' ).text().trim() );
										jQuery( '#tve_data_element_percentage_f' ).val( element.find( '.tve_fill_counter_n' ).attr( 'data-fill' ) );
										var _temp_value_fz1 = tve_handle_integer_or_float( element.find( '.tve_data_element_label' ).css( 'font-size' ) ),
											_temp_value_fz2 = tve_handle_integer_or_float( element.find( '.tve_fill_text_before' ).css( 'font-size' ) ),
											_temp_value_fz3 = tve_handle_integer_or_float( element.find( '.tve_fill_text' ).css( 'font-size' ) );
										jQuery( '#tve_data_element_font_size_f' ).val( _temp_value_fz1 );
										jQuery( '#tve_data_unit_font_size_f' ).val( _temp_value_fz2 );
										jQuery( '#tve_data_value_font_size_f' ).val( _temp_value_fz3 );
										$menu.find( '.element_id' ).val( element.attr( 'id' ) );
										jQuery( '#fill_counter_border_width' ).val( isNaN( _value ) ? '0' : _value );
										jQuery.each( "tve_smallfc tve_normalfc tve_bigfc".split( ' ' ), function ( i, v ) {
											if ( element.hasClass( v ) ) {
												tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
												return false;
											}
										} );
										break;
									case "number_counter":
										handle_custom_classes( element );
										var counter_start = element.find( '.tve_numberc_text' ).attr( 'data-counter-start' );
										jQuery( '#tve_data_element_value_start' ).val( counter_start ? counter_start : '0' );
										jQuery( '#tve_data_element_value_n' ).val( element.find( '.tve_numberc_text' ).text().trim() );
										jQuery( '#tve_data_element_label_n' ).val( element.find( '.tve_data_element_label' ).text().trim() );
										jQuery( '#tve_data_element_unit_b_n' ).val( element.find( '.tve_numberc_before' ).text().trim() );
										jQuery( '#tve_data_element_unit_a_n' ).val( element.find( '.tve_numberc_after' ).text().trim() );
										var _temp_value_fz1 = tve_handle_integer_or_float( element.find( '.tve_numberc_before' ).css( 'font-size' ) ),
											_temp_value_fz2 = tve_handle_integer_or_float( element.find( '.tve_data_element_label' ).css( 'font-size' ) ),
											_temp_value_fz3 = tve_handle_integer_or_float( element.find( '.tve_numberc_text' ).css( 'font-size' ) );
										jQuery( '#tve_data_unit_font_size_n' ).val( _temp_value_fz1 );
										jQuery( '#tve_data_element_font_size_n' ).val( _temp_value_fz2 );
										jQuery( '#tve_data_value_font_size_n' ).val( _temp_value_fz3 );
										$menu.find( '.element_id' ).val( element.attr( 'id' ) );
										break;
									case 'columns_flex':
										var wrap = element.css( 'flex-wrap' ),
											basis = element.children( '.tcb-flex-col' ).eq( 0 ).css( 'flex-basis' );
										if ( wrap && wrap == 'wrap' ) {
											$menu.find( '#flex_wrap' ).prop( 'checked', true );
											$menu.find( '#tve_flex_min_width' ).show();
										} else {
											$menu.find( '#flex_wrap' ).prop( 'checked', false );
											$menu.find( '#tve_flex_min_width' ).hide();
										}
							
										$menu.find( '#min_width' ).val( parseInt( basis ) );
										$menu.find( '#flex-reverse' ).prop( 'checked', element.hasClass( 'tcb-reverse' ) );
							
										break;
								}
								/* and some general control options, e.g. margins - which have the same behaviour for every element */
								if ( element.is( '.edit_mode' ) ) {
									element = get_element_from_wrapper( element, type );
								}
								var _brdFound = false;
								jQuery.each( border_styles.split( ' ' ), function ( i, v ) {
									if ( element.hasClass( v ) ) {
										_brdFound = true;
										tve_set_selected_dropdown( $menu.find( 'li#' + v ) );
										return false;
									}
								} );
								if ( ! _brdFound ) {
									tve_set_selected_dropdown( $menu.find( 'li#tve_brdr_none' ), true );
								}
							
								$menu.find( 'input.margin-control' ).each( function () {
									var $input = jQuery( this ),
										_value, target = element,
										_selector = $input.parents( '.tve_option_separator' ).first().find( '.css-selector' ).val(); // allow r/w properties from sub-elements
									/* allow also selectors going to the parents of the element */
									if ( _selector && _selector.indexOf( '_parent::' ) === 0 ) {
										target = element.parents( _selector.replace( '_parent::', '' ) ).first();
									} else if ( _selector ) {
										target = element.find( _selector );
										target = target.length === 0 ? element : target;
									}
							
									_value = parseInt( target.css( $input.attr( 'data-target' ) ) );
									isNaN( _value ) && (_value = 0);
							
									this.value = _value;
								} );
							
								$menu.find( 'input.padding-control' ).each( function () {
									var $input = jQuery( this ),
										_value, target = element,
										_selector = $input.parents( '.tve_option_separator' ).find( '.css-padding-selector' ).val(); // allow r/w properties from sub-elements
							
									/* allow also selectors going to the parents of the element */
									if ( _selector && _selector.indexOf( '_parent::' ) === 0 ) {
										target = element.parents( _selector.replace( '_parent::', '' ) ).first();
									} else if ( _selector ) {
										target = element.find( _selector );
										target = target.length === 0 ? element : target;
									}
									_value = parseInt( target.css( $input.attr( 'data-target' ) ) );
									isNaN( _value ) && (_value = 0);
							
									this.value = _value;
								} );
							
								/* line height control */
								if ( $menu.find( '#tve_line_height' ).length ) {
									var $lh_target = element;
									if ( type === 'post_grid' ) {
										$lh_target = element.find( '.tve-post-grid-title' ).first();
									}
									var css_line_height = $lh_target.css( 'line-height' ) ? $lh_target.css( 'line-height' ) : '',
										em_or_px = css_line_height.indexOf( 'px' ) === - 1 ? 'em' : 'px',
										lh_unit = $lh_target.attr( 'data-unit' ),
										absolute_value;
							
									if ( lh_unit === undefined ) {
										lh_unit = em_or_px;
									}
							
									if ( lh_unit === 'px' ) {
										absolute_value = parseFloat( css_line_height );
									} else if ( lh_unit === 'em' ) {
										absolute_value = parseFloat( css_line_height ) / parseFloat( $lh_target.css( 'font-size' ) );
									}
							
									if ( isNaN( absolute_value ) ) {
										absolute_value = 20;
									}
							
									absolute_value = tve_handle_integer_or_float( absolute_value );
							
									$menu.find( '#tve_line_height' ).val( absolute_value );
									tve_set_selected_dropdown( $menu.find( 'li#tve_line_height_' + lh_unit ) );
								}
								/* Element shadows controls */
								if ( $menu.find( '.tve_shadow_control' ) ) {
									TVE_Content_Builder.controls.shadow.on_menu_show( $menu, element );
								}
							
								TVE.apply_filters( 'load_button_values', type, element, $menu );
								jQuery( TVE_Content_Builder ).trigger( 'menu_show_' + type, [element, $menu] );
							}
							
							//function to determine if value used is integer or float
							function tve_handle_integer_or_float( value ) {
								if ( parseFloat( value ) % 1 !== 0 ) {
									value = parseFloat( value ).toFixed( 2 );
								} else {
									value = parseInt( value );
								}
							
								return value;
							}
							// function to populate editor input field with custom classes (excluding those that are reserved for the editor)
							function handle_custom_classes( element, $menu, elem_selector ) {
								if ( ! element.length ) {
									return;
								}
								elem_selector = elem_selector ? elem_selector : '.element_class';
								var class_list = element.attr( 'class' );
								if ( ! class_list ) {
									return;
								}
								var search = new RegExp( '(' + thrv_custom_classes.join( '|' ) + '|thrv_([^ "\']+)|tve_([^ "\']+)|ttfm([^ "\']+))', 'g' );
								class_list = jQuery.trim( class_list.replace( search, '' ) );
							
								if ( $menu ) {
									$menu.find( elem_selector ).val( class_list );
									return;
								}
								jQuery( elem_selector ).val( class_list );
							}
							
							/**
							 * select the corresponding custom font dropdown item
							 *
							 * @param element
							 * @param $menu
							 */
							function handle_custom_fonts( element, $menu ) {
								var found = false;
								if ( custom_font_classes ) {
									jQuery.each( (custom_font_classes + ' ' + extra_font_classes).split( ' ' ), function ( i, v ) {
										if ( v.length && element.hasClass( v ) ) {
											found = true;
											tve_set_selected_dropdown( $menu.find( 'li.tve_font_selector[data-cls="' + v + '"]' ) );
										}
									} );
								}
								if ( found === false && element.attr( 'data-web-font' ) ) {
									tve_set_selected_dropdown( $menu.find( 'li.tve_web_safe_font[data-web-font="' + element.attr( 'data-web-font' ) + '"]' ) );
									found = true;
								}
								if ( found === false ) {
									tve_set_selected_dropdown( $menu.find( 'li.tve_font_selector' ).first(), true );
								}
							}
							
							/**
							 *
							 * @param file
							 * @param small
							 * @param $clickedElement
							 */
							function tve_open_lightbox( $clickedElement ) {
								var file = $clickedElement.attr( 'data-lb' ) ? $clickedElement.attr( 'data-lb' ) : $clickedElement.attr( 'id' ),
									small = $clickedElement.hasClass( 'tve_lb_small' ),
									_data = jQuery.param( {} ),
									$edit = jQuery( '.edit_mode' ),
									lb_config = {},
									additional = $clickedElement.data(),
									url = additional.url ? additional.url : (tve_path_params.cpanel_dir + '/' + file + '.php');
							
								if ( typeof $clickedElement !== 'undefined' && $clickedElement ) {
									_data = $clickedElement.find( 'input' ).serialize();
									$clickedElement.find( 'input' ).each( function () {
										lb_config[jQuery( this ).attr( 'name' )] = this.value;
									} );
								}
								if ( file == 'lb_post_grid' && ! $clickedElement.parent().is( '.active_delete' ) && ! jQuery( '.edit_mode' ).is( '.thrv_post_grid' ) ) {
									/* when other element is in edit_mode and user tries to add a post grid */
									return;
								}
								TVE.main.trigger( 'lb_opening' );
								if ( file == 'tve_event_manager' ) {
									TVE_Content_Builder.event_manager.default_data = _data;
									return TVE_Content_Builder.event_manager.open( jQuery( '.edit_mode' ), lb_config.scope ? lb_config.scope : '' );
								}
								additional.post_id = tve_path_params.post_id;
								if ( file == 'lb_icon' ) {
									if ( $edit.length ) {
										var $target = $edit.find( '.tve_sc_icon' );
										additional.current_icon = $target.length ? $target.attr( 'data-tve-icon' ) : '';
									}
								}
								if ( file == 'lb_custom_css' || file == 'lb_custom_html' || file == "lb_full_html" || file == 'lb_global_scripts'
								     || file == 'lb_google_map' || file == 'lb_image_link' || file == 'lb_landing_pages'
								     || file == 'lb_table' || file == 'lb_text_link' || file == 'lb_text_link_settings' || file == 'lb_ultimatum_shortcode' ) {
									url = tve_path_params.ajax_url;
									additional.action = 'tve_ajax_load';
									additional.ajax_load = file;
								}
							
								if ( file == 'lb_ultimatum_shortcode' ) {
									jQuery.extend( additional, $edit.tve_thrive_ultimatum_shortcode().config() );
								}
							
								_data += (_data ? '&' : '') + jQuery.param( additional );
								if ( tve_path_params.custom_post_data ) {
									_data += (_data ? '&' : '') + jQuery.param( tve_path_params.custom_post_data );
								}
							
								if ( additional.wpapi ) { // go through the admin-ajax wp api
									url = tve_path_params.ajax_url;
									_data += (_data ? '&' : '') + jQuery.param( {
											action: 'tve_ajax_load',
											ajax_load: additional.wpapi
										} );
								}
								if ( file == 'lb_post_grid' && jQuery( '.tve_active_lightbox' ).find( '.thrive-shortcode-config' ).length ) {
									_data = jQuery( '.tve_active_lightbox' ).tve_post_grid().getConfig();
									if ( additional.wpapi ) { // go through the admin-ajax wp api
										url = tve_path_params.ajax_url;
										_data.ajax_load = additional.wpapi;
										_data.action = 'tve_ajax_load';
									}
								}
								if ( additional.load ) {
									TVE.main.overlay();
								}
							
								if ( file == 'lb_lead_generation_code' ) {
									return TVE_Content_Builder.auto_responder.init().dashboard();
								}
							
								function onResponse( response ) {
									load_lightbox_content( response, small );
									tve_populate_lightbox( file );
									var $frame = jQuery( '.tve_lightbox_frame' );
									$frame.find( '.tve_lightbox_buttons' ).hide();
							
									if ( file === 'lb_widgets' ) {
										var wrapper = jQuery( '.thrv_widget.tve_active_lightbox' );
										jQuery( '<div>' + response + '</div>' ).tve_widgets( {wrapper: wrapper} );
									}
									if ( additional.btnHide ) {
										$frame.find( '.tve_lightbox_buttons' ).hide();
									}
									if ( file !== 'lb_landing_pages' && file !== 'lb_lead_generation_code' && ! additional.btnHide ) {
										$frame.find( '.tve_lightbox_buttons' ).show();
									}
							
									if ( additional.btntext ) {
										$frame.find( '.tve_save_lightbox' ).val( additional.btntext );
									} else {
										$frame.find( '.tve_save_lightbox' ).val( 'Save' );
									}
									if ( file == 'lb_icon' ) {
										$frame.find( '.tve_lightbox_buttons' )[$frame.find( '.icomoon-icon-list' ).length ? 'show' : 'hide']();
									}
									show_lightbox();
									TVE.main.overlay( true );
								}
							
								/* check if there already is a static lightbox content in the page */
								var $static = jQuery( '.tve-static-lb #' + file );
								if ( $static.length ) {
									onResponse( $static.html() );
								} else {
									jQuery.post( url, _data, onResponse );
								}
							
							}
							
							function load_lightbox_content( content, small ) {
								jQuery( "#tve_lightbox_content" ).html( content );
								// if small lightbox, then apply relevant class
								if ( small ) {
									jQuery( "#tve_lightbox_frame, #tve_lightbox_overlay" ).addClass( "tve_link_lightbox" );
								} else {
									jQuery( "#tve_lightbox_frame, #tve_lightbox_overlay" ).removeClass( "tve_link_lightbox" );
								}
							}
							
							function show_lightbox() {
								jQuery( ".tve_lightbox_overlay" ).show( 0 );
								jQuery( ".tve_lightbox_frame" ).show( 0 ).find( 'input,select,textarea' ).filter( ':visible' ).first().focus();
								jQuery( 'body, html' ).addClass( 'tve-hide-overflow' );
							}
							
							// function to get all the options that the user has entered into the lightbox
							function tve_get_lightbox_options() {
								var user_options = {};
							
								jQuery( ".tve_lightbox_frame .tve_lightbox_content input, .tve_lightbox_frame .tve_lightbox_content select, .tve_lightbox_frame .tve_lightbox_content textarea" ).each( function () {
							
									var $this = jQuery( this );
									if ( $this.attr( 'name' ) === undefined ) {
										return;
									}
									if ( $this.attr( "type" ) == "checkbox" ) {
										user_options[$this.attr( "name" )] = $this.is( ':checked' );
									} else {
										user_options[$this.attr( "name" )] = $this.val();
									}
								} );
							
								return user_options;
							}
							
							
							function tve_populate_lightbox( lightbox ) {
								switch ( lightbox ) {
									case "lb_revision_manager":
										jQuery( '#tve_lightbox_frame' ).addClass( 'revision_mananger_lightbox' );
										break;
									case "lb_full_html" :
										page_content = TVE.Editor_Page.content_manager.get_clean_content( {keep_wp_shortcodes: true} );
										jQuery( "textarea[name='tve_full_html']" ).val( tve_revert_script_tags( page_content ) );
										break;
									case "lb_image_link" :
										element = jQuery( ".edit_mode" );
										if ( element.hasClass( 'thrv_icon' ) ) {
											element = element.find( 'span.tve_sc_icon' ).first();
										}
										if ( jQuery( element ).parent().is( "a" ) ) {
											jQuery( "#lb_link_location" ).val( jQuery( element ).parent().attr( "href" ) );
											if ( jQuery( element ).parent().attr( "target" ) == "_blank" ) {
												jQuery( "#lb_link_target" ).prop( "checked", true );
											}
											if ( jQuery( element ).parent().attr( "rel" ) == "nofollow" ) {
												jQuery( "#lb_no_follow" ).prop( "checked", true );
											}
										}
										break;
									case "lb_custom_html" :
										element = jQuery( ".edit_mode" );
										if ( element.length == 0 ) {
											// case: user has clicked on "Insert Custom HTML" button, we still need to take the contents,
											// there might be some hidden stuff there: scripts, placeholders etc
											element = jQuery( '.tve_active_lightbox' );
										}
										element.addClass( "tve_active_lightbox" );
										element.find( '.tve_iframe_cover' ).remove();
										jQuery( "#tve_custom_html" ).val( tve_revert_script_tags( element.html() ) );
										break;
									case "lb_google_map" :
										element = jQuery( ".edit_mode" );
										if ( element.length == 0 ) {
											// case: user has clicked on "Insert Google Map" button, we still need to take the contents,
											// there might be some hidden stuff there: scripts, placeholders etc
											element = jQuery( '.tve_active_lightbox' );
										}
										element.addClass( "tve_active_lightbox" );
										jQuery( "#tve_google_map" ).val( tve_revert_script_tags( element.html() ) );
										break;
									case 'lb_custom_css':
										jQuery( 'textarea[name=tve_custom_css]' ).val( TVE.Editor_Page.get_custom_css( true ) );
										break;
									case 'lb_global_scripts':
										jQuery( '#tve_global_scripts_head' ).val( tve_path_params.tve_global_scripts.head ? tve_path_params.tve_global_scripts.head : '' );
										jQuery( '#tve_global_scripts_footer' ).val( tve_path_params.tve_global_scripts.footer ? tve_path_params.tve_global_scripts.footer : '' );
										jQuery( '#tve_global_scripts_body' ).val( tve_path_params.tve_global_scripts.body ? tve_path_params.tve_global_scripts.body : '' );
										break;
									case 'lb_post_grid':
										jQuery( '.tve_post_grid_tabs_container' ).tve_post_grid().sortable().autocomplete();
										break;
									case 'lb_ultimatum_shortcode':
										jQuery( '#tve_thrive_ultimatum_shortcode_lightbox' ).tve_thrive_ultimatum_shortcode().lightbox();
										break;
								}
							}
							
							/**
							 * handle lightbox options depending on form that was displayed
							 *
							 * if there is some validation criteria that is not met, return false
							 *
							 * if this returns true, the lightbox will close and the options saved
							 */
							function tve_handle_lightbox_options( user_options ) {
								switch ( user_options.tve_lb_type ) {
									case "text_link_settings":
							
										user_options.action = 'tve_update_link_settings';
							
										jQuery.post( tve_path_params.ajax_url, user_options, function ( response ) {
										} );
							
										break;
									case "custom_html":
										var target = jQuery( ".tve_active_lightbox" );
										/* check if anything is visible inside the custom HTML box, and, if not, add the default placeholder to it */
										var contents = tve_convert_script_tags( user_options.tve_custom_html );
										target.html( contents ).removeClass( custom_html_placeholder_class + " code_placeholder" ).addClass( "thrv_custom_html_shortcode" );
										if ( target.height() === 0 && target.find( 'img' ).length === 0 ) { // images will have a delay until loaded
											target.append( custom_html_default_html );
										} else {
											target.find( '.' + custom_html_placeholder_class ).remove();
											/* iframes cannot be clicked, dragged etc */
											if ( target.find( 'iframe' ).length ) {
												target.append( jQuery( '<div class="tve_iframe_cover"></div>' ) );
											}
										}
										break;
									case 'tve_post_grid':
										var sorted = jQuery( '.tve_sortable_layout' ).sortable( "toArray", {attribute: 'data-layout'} );
										user_options.layout = sorted;
										jQuery( '.tve_active_lightbox, .edit_mode' ).tve_post_grid( user_options ).display();
										break;
									case "tve_full_html":
										var target = TVE.Editor_Page.editor.children( '.tve_content_save' ).length ? TVE.Editor_Page.editor.children( '.tve_content_save' ) : TVE.Editor_Page.editor;
										target.html( tve_convert_script_tags( user_options.tve_full_html ) );
										TVE.drag.refresh();
										break;
									case "tve_google_map":
										google_map_code = user_options.tve_embed_code;
										jQuery( ".tve_active_lightbox" ).replaceWith( "<div class='tve-flexible-container thrv_wrapper'>" + user_options.tve_embed_code + "</div>" );
										break;
									case "text_link":
										//TODO: hope we won't use this again
							//			tve_add_hyperlink( user_options.lb_link, user_options.lb_link_target, user_options.lb_link_name, user_options.lb_no_follow );
										break;
									case "image_link" :
										tve_add_image_hyperlink( user_options.lb_link, user_options.lb_link_target, user_options.lb_no_follow );
										break;
									case 'tve_custom_css':
										tve_add_custom_css( user_options.tve_custom_css );
										break;
									case 'tve_table':
										var _rows = parseInt( user_options.tve_table_rows ),
											_cols = parseInt( user_options.tve_table_cols );
										jQuery( '#tve_table_rows_number,#tve_table_cols_number' ).removeClass( 'tve_field_error' );
										if ( isNaN( _rows ) || _rows <= 0 || _rows > 15 ) {
											jQuery( '#tve_table_rows_number' ).addClass( 'tve_field_error' );
											return false;
										}
										if ( isNaN( _cols ) || _cols <= 0 || _cols > 15 ) {
											jQuery( '#tve_table_cols_number' ).addClass( 'tve_field_error' );
											return false;
										}
										user_options.tve_table_rows = _rows;
										user_options.tve_table_cols = _cols;
										TVE.drag.insert( tve_build_table( user_options ), jQuery( '.tve_active_lightbox' ).removeClass( 'table_placeholder' ), true );
										break;
									case 'sc_icon':
										var selected = jQuery( '.icomoon-icon.tve_selected' ),
											active_lightbox = jQuery( '.tve_active_lightbox' ),
											element = jQuery( '.edit_mode' );
										if ( selected.length == 0 ) {
											TVE.page_message( 'You have to select an icon', true );
											return false;
										}
										if ( element.length ) {
											if ( element.hasClass( 'thrv_button_shortcode' ) ) {
												element = element.find( '.tve_left i' ).addClass( 'tve_sc_icon' ).css( 'width', '' ).css( 'background-image', 'none' );
											} else {
												element = element.find( 'span.tve_sc_icon' );
											}
											element.removeClass( element.attr( 'data-tve-icon' ) ).addClass( selected.attr( 'data-cls' ) );
											element.attr( 'data-tve-icon', selected.attr( 'data-cls' ) );
											return true;
										}
										user_options.icon_class = selected.attr( 'data-cls' );
										user_options.ajax_load = 'sc_icon';
										user_options.action = 'tve_ajax_load';
										jQuery.post( tve_path_params.ajax_url, user_options, function ( response ) {
											TVE.drag.insert( response, active_lightbox, false, true );
										} );
										break;
									case 'global_scripts':
										tve_path_params.tve_global_scripts = {};
										tve_path_params.tve_global_scripts.head = user_options.head;
										tve_path_params.tve_global_scripts.footer = user_options.footer;
										tve_path_params.tve_global_scripts.body = user_options.body;
										break;
									case 'tve_ultimatum_shortcode':
										jQuery( '.tve_active_lightbox, .edit_mode' ).tve_thrive_ultimatum_shortcode( user_options ).fetch();
										break;
									case 'landing_page_export':
										if ( ! user_options.lp_name ) {
											TVE.page_message( tve_path_params.translations.ExportFileNameRequired, true, 5000 );
											return false;
										}
										TVE.main.overlay();
									function export_it() {
										jQuery.post( tve_path_params.ajax_url, {
											action: 'tve_lp_export',
											post_id: tve_path_params.post_id,
											template_name: user_options.lp_name,
											thumb_id: user_options.lp_thumb
										}, function ( response ) {
											TVE.main.overlay( true );
											if ( ! response.success ) {
												TVE.page_message( response.message, true, 8000 );
												return;
											}
											TVE_Content_Builder.controls.lb_close();
											var fn = window.onbeforeunload;
											window.onbeforeunload = null;
											location.href = response.url;
											if ( typeof fn === 'function' ) {
												setTimeout( function () {
													window.onbeforeunload = fn; // re-set the old onbeforeunload function
												} );
											}
											TVE.page_message( response.message, false, 8000 );
										}, 'json' ).fail( function ( r ) {
											TVE.main.overlay( true );
											TVE.page_message( tve_path_params.translations.UnknownError + r.responseText, true, 10000 );
										} );
									}
							
										TVE.Editor_Page.save( true, export_it );
										return false;
										break;
								}
							
								return true;
							}
							
							// adds / modifies hyperlinks on images
							function tve_add_image_hyperlink( link, target, nofollow ) {
							
								// get image
								var element = jQuery( ".edit_mode" ),
									link_target = target ? '_blank' : '_self',
									$link;
								if ( element.hasClass( 'thrv_icon' ) ) {
									element = element.find( 'span.tve_sc_icon' ).first();
								}
								$link = element.parent();
							
								if ( ! $link.is( 'a' ) ) {
									element.wrapAll( jQuery( '<a href="' + link + '"></a>' ) );
									$link = element.parent();
								}
								$link.attr( {
									href: link,
									target: link_target,
									rel: nofollow ? 'nofollow' : ''
								} );
								jQuery( ".tve_link_btns" ).show();
							}
							
							/**
							 * function to see if the image that is currently selected contains a caption or not
							 * @param element - the selected image
							 * @returns {boolean}
							 */
							function check_image_caption( element ) {
								if ( jQuery( element ).parents( ".tve_image_caption" ).length != 0 ) {
									return true;
								} else {
									return false;
								}
							}
							
							/**
							 * saves control panel display configuration so that the UI is remember after each page load
							 * @param attribute - the attribute to save.  E.g "position"
							 * @param value - value of the attribute   E.g "left"
							 */
							function tve_save_cp_config( attribute, value ) {
								var data = {
									action: 'tve_editor_display_config',
									attribute: attribute,
									value: value,
									security: tve_path_params.tve_ajax_nonce
								}
							
								jQuery.post( tve_path_params.ajax_url, data, function ( response ) {
								} );
							}
							
							/**
							 * Convert RGB to hex
							 * @param c
							 * @returns {string}
							 */
							function rgbToHex( color ) {
								if ( color.substr( 0, 1 ) === "#" ) {
									return color;
								}
								var nums = /(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec( color ),
									r = parseInt( nums[2], 10 ).toString( 16 ),
									g = parseInt( nums[3], 10 ).toString( 16 ),
									b = parseInt( nums[4], 10 ).toString( 16 );
								return "#" + (
								       (r.length == 1 ? "0" + r : r) +
								       (g.length == 1 ? "0" + g : g) +
								       (b.length == 1 ? "0" + b : b)
									);
							}
							
							
							/**
							 * convert all script tags inside html to shortcodes that will be converted on display
							 * @param string html
							 */
							//TODO: This was moved to content.js. Delete this.
							function tve_convert_script_tags( html ) {
								html = html.replace( '<\\/script', '<\\\\/script' );
								var $html = jQuery( '<div class="tve_escaped_js">' + html + '</div>' );
							
								if ( $html.find( 'script' ).length === 0 && $html.find( "noscript" ) === 0 ) {
									return $html.html();
								}
								$html.find( 'script' ).each( function () {
									var $script = jQuery( this ),
										_text = '[tcb-script';
									var $replacement = jQuery( '<code class="tve_js_placeholder"></code>' );
									jQuery.each( this.attributes, function () {
										_text += ' ' + this.name + '="' + this.value + '"';
									} );
									_text += ']' + $script.text() + '[/tcb-script]';
							
									$replacement.text( _text );
									$script.replaceWith( $replacement );
								} );
								$html.find( 'noscript' ).each( function () {
									var $script = jQuery( this ),
										_text = '[tcb-noscript';
									var $replacement = jQuery( '<code class="tve_js_placeholder tve_noscript"></code>' );
									jQuery.each( this.attributes, function () {
										_text += ' ' + this.name + '="' + this.value + '"';
									} );
									_text += ']' + $script.text() + '[/tcb-noscript]';
									$replacement.html( _text );
									$script.replaceWith( $replacement );
								} );
								return $html.html();
							}
							
							/**
							 * convert all <code>[tcb-script] tags back to <script>
							 * @param html
							 */
							//TODO: this was moved to content.js
							function tve_revert_script_tags( html ) {
							
								if ( ! jQuery.trim( html ) ) {
									return '';
								}
								var $html = jQuery( '<div class="tve_escaped_js">' + html + '</div>' );
							
								// remove all custom html placeholders
								$html.find( '.tve_custom_html_placeholder,.tve_click' ).remove();
								$html.find( '.tve_shortcode_overlay' ).remove();
								if ( $html.find( 'code.tve_js_placeholder' ).length === 0 ) {
									return jQuery.trim( $html.html() );
								}
							
								$html.find( 'code.tve_js_placeholder' ).each( function () {
									var $script = jQuery( this ),
										shortcodeRegexp = new RegExp( '^\\[tcb-script([^\\]]*?)\\]([\\s\\S]*?)\\[\/tcb-script\\]$', 'g' ), _text; // jeez
							
									_text = $script[$script.hasClass( 'tve_noscript' ) ? 'html' : 'text']().replace( shortcodeRegexp, '<script$1>$2</script>' );
							
									var shortcodeNoscriptRegex = new RegExp( '^\\[tcb-noscript([^\\]]*?)\\]([\\s\\S]*?)\\[\/tcb-noscript\\]$', 'g' ); // jeez
									_text = _text.replace( shortcodeNoscriptRegex, '<noscript$1>$2</noscript>' );
									if ( $script.hasClass( 'tve_noscript' ) ) { // <noscript> tag does not allow innerHTML manipulation
										_text = jQuery( '<textarea>' ).html( _text ).text();
									}
									var $replacement = jQuery( _text );
									$replacement.removeAttr( 'class className' );
									$script.replaceWith( $replacement );
								} );
								return jQuery.trim( $html.html() );
							}
							
							/**
							 * get html for a table row
							 *
							 * @param int row_index current row index being generated
							 * @param int cols number of columns in the table
							 */
							function tve_build_table_row( row_index, cols ) {
								var html = '<tr class="tve_table_row">',
									_cell = row_index == 1 ? 'th' : 'td',
									_text = row_index == 1 ? 'Header' : 'Cell';
								if ( row_index > 1 ) {
									row_index --;
								}
								for ( var j = 1; j <= cols; j ++ ) {
									html += '<' + _cell + ' class="tve_table_cell"><div class="thrv_wrapper thrv_text_element"><p> ' + _text + ' ' + row_index + ' / ' + j + '</p></div></' + _cell + '>';
								}
								html += '</tr>';
								return html;
							}
							
							/**
							 * build a new table with _style style, rows x cols
							 *
							 * @param Object user_options
							 */
							function tve_build_table( user_options ) {
								var table = '<table data-rows="' + user_options.tve_table_rows + '" data-cols="' + user_options.tve_table_cols + '" class="tve_table tve_no_inner_border tve_no_border tve_table_' + user_options.tve_table_style + '">';
								/* table head */
								table += '<thead>' + tve_build_table_row( 1, user_options.tve_table_cols ) + '</thead>';
							
								/* table body */
								table += '<tbody>';
								for ( var i = 2; i <= user_options.tve_table_rows; i ++ ) {
									table += tve_build_table_row( i, user_options.tve_table_cols );
								}
								table += '</tbody></table>';
								return table;
							}
							
							/**
							 * set the value displayed in a dropdown menu accordingly to the $dropdownElement
							 *
							 * @param $dropdownElement
							 */
							function tve_set_selected_dropdown( $dropdownElement, use_default_text ) {
								if ( typeof use_default_text === 'undefined' ) {
									use_default_text = false;
								}
								if ( ! $dropdownElement.length ) {
									return;
								}
							
								var $target = $dropdownElement.parents( '.tve_option_separator' ).find( 'span' ).first();
								$target.html( use_default_text ? $target.attr( 'data-default' ) : $dropdownElement.text() );
							}
							
							/**
							 * mark this post as a landing page constructed using the <code>template</code> template style
							 *
							 * @param template
							 */
							function tve_landing_page_select( template ) {
								if ( jQuery.type( template ) !== 'string' && template.jquery && typeof template.data === 'function' ) {
									// this means template is a jquery object (a button that was clicked) - the template name is in the data-template attribute
									template = template.data( 'template' );
								}
								//first step: save the current post, to not lose any content
								TVE.Editor_Page.save( false, function () {
									//second step: save the new chosen template
									TVE.Editor_Page.save_extra( 'landing_page', {tve_landing_page: template}, function () {
										window.onbeforeunload = null;
										window.parent.location.reload();
									} );
								} );
							}
							
							/**
							 * fetch the user-saved landing page templates from the server
							 */
							function tve_landing_pages_load( filter ) {
								if ( typeof filter === 'undefined' ) {
									filter = {};
								}
								filter.action = 'tve_landing_pages_load';
								filter.security = tve_path_params.tve_ajax_nonce;
							
								TVE.main.overlay();
								jQuery.post( tve_path_params.ajax_url, filter, function ( response ) {
									jQuery( '#tve_user_landing_pages' ).html( response );
									TVE.main.overlay( 'close' );
								} );
								jQuery( '#tve_landing_page_select' ).show();
							}
							
							/**
							 * on-page (js) filter for the default landing pages
							 */
							function tve_landing_pages_filter( $input ) {
								var _selector = '';
								jQuery( '.tve_landing_page_filters:visible input.tve_change:checked' ).each( function () {
									_selector += (_selector ? ',.' : '.') + this.value;
								} );
							
								if ( $input.attr( 'id' ) == 'tag-downloaded-template' && $input.is( ':checked' ) ) {
									/* click the templates tab, only if not active */
									var $cloudTab = jQuery( '#tve_cloud_templates' );
									if ( ! $cloudTab.hasClass( 'tve_tS' ) ) {
										$cloudTab.find( 'span' ).click();
										return;
									}
								}
								var $list = jQuery( '#tve_default_landing_pages .tve_grid_cell,#tve_user_landing_pages .tve_grid_cell,#tve_cloud_template_list .tve_cloud_tpl_item' );
								if ( ! _selector ) {
									$list.show();
									return;
								}
								$list.hide().filter( _selector ).show();
							}
							
							/**
							 * delete a user-saved template, and reload the templates
							 *
							 * @param template_index
							 */
							function tve_landing_page_delete( template_index ) {
								TVE.Editor_Page.save_extra( 'landing_page_delete', {tve_landing_page: template_index}, function ( response ) {
									jQuery( '#tve_user_landing_pages' ).html( response );
									TVE.main.overlay( 'close' );
								} );
							}
							
							/**
							 * fetch the thrive Landing Page templates stored in the cloud
							 * @param current_template currently selected template
							 */
							function tve_fetch_cloud_templates( current_template, event ) {
								TVE.main.overlay();
								var event = event || {},
									data = TVE.apply_filters( 'tcb_fetch_cloud_templates', {
										action: 'tve_cloud_templates',
										current_template: current_template,
										task: 'get_all',
										event: event
									} );
								delete data.event;
								jQuery.post( tve_path_params.ajax_url, data, function ( response ) {
									jQuery( '#tve_cloud_template_list' ).html( response );
									TVE.main.overlay( 'close' );
									jQuery( 'input#tag-downloaded-template' ).trigger( 'change' );
								} ).fail( function ( r ) {
									TVE.main.overlay( true );
									TVE.page_message( tve_path_params.translations.UnknownError + r.responseText, true, 10000 );
								} );
								jQuery( '#tve_landing_page_select' ).hide();
							}
							
							/**
							 * download a landing page template from the API (this will start an ajax call that will download and extract the actual zip file containing the landing page files)
							 */
							function tve_cloud_template_download( $btn, element, event ) {
								var template = $btn.data( 'template' ),
									is_update = $btn.hasClass( 'tve-tpl-update' ),
									$container2 = $btn.closest( 'span' ),
									$container = $btn.parent().html( tve_path_params.translations.Downloading ),
									data = TVE.apply_filters( 'tcb_cloud_template_download', {
										action: 'tve_cloud_templates',
										task: 'download',
										is_update: is_update ? '1' : '0',
										template: template,
										event: event
									} );
							
								delete data.event;
								TVE.main.overlay();
								jQuery.post( tve_path_params.ajax_url, data, function ( response ) {
									TVE.main.overlay( 'close' );
									if ( is_update ) {
										$container.html( tve_path_params.translations.Template_updated );
										setTimeout( function () {
											$container.slideUp();
											$container2.first().append( response );
										}, 1000 );
									} else {
										$container.html( response );
									}
								} ).fail( function ( r ) {
									TVE.page_message( tve_path_params.translations.UnknownError + r.responseText, true, 10000 );
									$container.html( tve_path_params.translations.UnknownError + r.responseText );
								} );
							}
							
							/**
							 * parses a string such as "landing_page.click.clear_shadow" into a function which can be called
							 * the base object of the function is the global TVE_Content_Builder object
							 * strFuncName can also be a simple string, in which case it will return the function from the global (window) context
							 *
							 * @param  string strFuncName
							 * @param bool optional return_obj whether or not to return also the object as the first position
							 * @returns {TVE_Content_Builder|*|{}}
							 */
							function tve_parse_ctrl_string( strFuncName, return_obj ) {
								if ( ! TVE_Content_Builder.global_func_cache ) {
									TVE_Content_Builder.global_func_cache = {};
								}
								if ( typeof TVE_Content_Builder.global_func_cache[strFuncName] !== 'undefined' ) {
									return typeof return_obj === 'undefined' ? TVE_Content_Builder.global_func_cache[strFuncName][1] : TVE_Content_Builder.global_func_cache[strFuncName];
								}
								strFuncName = strFuncName.replace( 'function:', '' );
								var parts = strFuncName.split( '.' ),
									handler = parts.shift(), real_handler = TVE_Content_Builder,
									handler_obj = window;
								if ( ! parts.length ) {
									real_handler = window[handler];
								} else {
									handler_obj = real_handler;
									real_handler = typeof real_handler[handler] !== 'undefined' ? real_handler[handler] : null;
									while ( parts.length && real_handler ) {
										// if there are more parts, then it's a TVE_Content_Builder member
										handler = parts.shift();
										handler_obj = real_handler;
										real_handler = typeof real_handler[handler] !== 'undefined' ? real_handler[handler] : null;
									}
								}
								if ( real_handler === null ) {
									return false;
								}
							
								TVE_Content_Builder.global_func_cache[strFuncName] = [handler_obj, real_handler];
								return typeof return_obj === 'undefined' ? real_handler : [handler_obj, real_handler];
							}
							
							/**
							 * perform upgrades on elements that have changed their html structure during the development of the plugin
							 * @param type
							 */
							function tve_upgrade_element( type ) {
								var $element = get_element_from_wrapper( jQuery( '.edit_mode' ), type );
								switch ( type ) {
									case 'button':
										if ( ! $element.hasClass( 'tve_nb' ) ) {
											$element.addClass( 'tve_nb' );
											if ( $element.find( 'div.tve_left' ).length ) {
												var _html = $element.find( 'div.tve_left' ).html() + '<span class="tve_btn_divider"></span>',
													text = jQuery.trim( $element.find( 'a' ).text() );
												$element.find( 'div.tve_left' ).replaceWith( jQuery( '<span class="tve_left tve_btn_im"></span>' ).html( _html ) );
												$element.find( 'a' ).contents().filter( function () {
													return this.nodeType === 3;
												} ).remove();
												$element.find( 'a' ).append( '<span class="tve_btn_txt">' + text + '</span>' );
											}
										}
										break;
									case 'fill_counter':
										$element.each( function () {
											var $elem = jQuery( this ),
												fillCounter = $elem.find( '.tve_fill_counter' );
											if ( fillCounter.length !== 0 ) {
												var fillValue = fillCounter.attr( 'data-fill' ) / 1.8,
													fillCounterValue, svgHeight, svgRadius;
												if ( $elem.hasClass( 'tve_normalfc' ) ) {
													fillCounterValue = fillValue * 6.35 + ' 635';
													svgHeight = 202;
													svgRadius = 101;
												} else if ( $elem.hasClass( 'tve_smallfc' ) ) {
													fillCounterValue = fillValue * 3.21 + ' 321';
													svgHeight = 102;
													svgRadius = 51;
												} else if ( $elem.hasClass( 'tve_bigfc' ) ) {
													fillCounterValue = fillValue * 7.92 + ' 792';
													svgHeight = 252;
													svgRadius = 126;
												}
												fillCounter.find( '.tve_fill_circle' ).remove();
												fillCounter.prepend( '<svg viewBox="0 0 ' + svgHeight + ' ' + svgHeight + ' " class="tve_fill_counter_circle" shape-rendering="optimizeSpeed"><circle r="' + svgRadius + '" cx="' + svgRadius + '" cy="' + svgRadius + '"></circle></svg>' );
												fillCounter.removeClass( 'tve_fill_counter' ).addClass( 'tve_fill_counter_n' ).attr( 'style', 'stroke-dasharray:' + fillCounterValue ).attr( 'data-fill', fillValue );
											}
										} );
										break;
								}
							}
							/**
							 * return the sign of a number
							 * -1 => negative
							 * +1 => positive
							 * 0 => zero
							 *
							 * @param x
							 */
							function tve_signum( x ) {
								return typeof x === 'number' ? (x ? x < 0 ? - 1 : 1 : x === x ? 0 : NaN) : NaN;
							}
							
							/* extra jquery pseudo- selectors */
							jQuery.expr[":"].contains = jQuery.expr.createPseudo( function ( arg ) {
								return function ( elem ) {
									return jQuery( elem ).text().toUpperCase().indexOf( arg.toUpperCase() ) >= 0;
								};
							} );
							
							/* utility methods that are callable directly on a jquery- selected element */
							jQuery.fn.extend( {
								tve_color_selector: function ( setIt ) {
									if ( typeof setIt !== 'undefined' ) {
										if ( setIt ) {
											return this.attr( 'data-tve-custom-colour', setIt );
										}
										return this.removeAttr( 'data-tve-custom-colour' );
									}
									return this.attr( 'data-tve-custom-colour' );
								},
								tve_remove_hover: function () {
									for ( var i = 0; i < 10; i ++ ) {
										this.removeAttr( 'data-hover-' + i );
									}
								},
								/**
								 * set a CSS property by adding an optional !important priority
								 * used first to overwrite some of the styles imposed by the themes having !important rules in CSS
								 *
								 * @param cssProp
								 * @param cssValue
								 * @param priority
								 * @returns {*}
								 */
								tve_css: function ( cssProp, cssValue, priority ) {
									if ( (cssValue.length && ! priority) || ! this[0] || ! this[0].style.setProperty || ! this[0].style.removeProperty ) {
										return this.css( cssProp, cssValue );
									}
									var propMap = {
										'margin': ['margin-left', 'margin-right', 'margin-top', 'margin-bottom'],
										'padding': ['padding-left', 'padding-right', 'padding-top', 'padding-bottom']
									};
									return this.each( function () {
										var elem = this;
										if ( cssValue.length ) {
											this.style.setProperty( cssProp, cssValue, priority );
										} else {
											/**
											 * Chrome does not remove margin and padding style if supplied directly
											 */
											if ( propMap[cssProp] ) {
												jQuery.each( propMap[cssProp], function ( index, item ) {
													elem.style.removeProperty( item );
												} );
											} else {
												this.style.removeProperty( cssProp );
											}
										}
									} );
								},
								/**
								 *  return utility functions for page_section elements
								 *
								 *  this is the .thrv_wrapper element
								 */
								tve_page_section: function () {
									var $element = this,
										$out = this.find( '> .out' ),
										$in = $out.find( '> .in' );
							
									return {
										/**
										 * make sure we have a .cck div inside $wrapper, to be compliant with the themes
										 */
										ensureCompliant: function () {
											if ( ! $in.find( '> .cck' ).length ) {
												$in.children().wrapAll( '<div class="cck clearfix"></div>' );
											}
											return $element;
										},
										setBgPattern: function ( patternUrl ) {
											this.clearBgImage().clearBgColor();
											$out.css( {
												'background-image': "url('" + patternUrl + "')",
												'background-repeat': 'repeat'
											} );
										},
										setBgImage: function ( wpAttachment ) {
											this.clearBgImage();
											$in.addClass( 'pddbg' ).css( {
												'box-sizing': 'border-box',
												'background-image': "url('" + wpAttachment.url + "')",
												'background-repeat': '',
												'max-width': TVE.Editor_Page.winWidth + 'px'
											} );
											$out.addClass( 'pswr' );
											this.transferShadow();
											$in.attr( {
												'data-width': wpAttachment.width,
												'data-height': wpAttachment.height
											} );
										},
										/* remove the user-background image, pattern bg image etc and all related classes */
										clearBgImage: function () {
											$in.removeClass( 'pddbg' ).css( {
												'background-image': '',
												'background-repeat': '',
												'max-width': '',
												'-moz-box-shadow': '',
												'-webkit-box-shadow': '',
												'box-shadow': '',
												'box-sizing': ''
											} );
											$out.removeClass( 'pswr' );
											return this;
										},
										clearShadow: function () {
											tve_remove_css_rule( $out.tve_color_selector(), 'box-shadow -moz-box-shadow -webkit-box-shadow' );
											$out.add( $in ).css( {
												'-moz-box-shadow': '',
												'-webkit-box-shadow': '',
												'box-shadow': ''
											} );
											return this;
										},
										clearBgPattern: function () {
											$out.removeClass( 'pattern1 pattern2 pattern3' ); // legacy support for old page section colors
											$out.css( {
												'background-image': '',
												'background-repeat': ''
											} );
											return this;
										},
										clearBgColor: function () {
											if ( $out.tve_color_selector() ) {
												tve_remove_css_rule( $out.tve_color_selector(), 'background-color' );
											}
											$out.css( 'background-color', '' );
											return this;
										},
										/* transfer box-shadow to the .in element, if any is applied to .out element */
										transferShadow: function () {
											var has_bg_image = $element.find( '.out.pswr > .in' );
											if ( has_bg_image.length ) {
												has_bg_image.css( {
													'-moz-box-shadow': $out.css( '-moz-box-shadow' ),
													'-webkit-box-shadow': $out.css( '-webkit-box-shadow' ),
													'box-shadow': $out.css( 'box-shadow' )
												} );
											} else {
												$in.css( {
													'-moz-box-shadow': '',
													'-webkit-box-shadow': '',
													'box-shadow': ''
												} );
											}
										},
										bgAttachment: function ( isFixed ) {
											$in.removeClass( 'pdwbg' );
											if ( isFixed ) {
												var has_bg_image = $element.find( '.out.pswr > .in' );
												if ( has_bg_image.length ) {
													$in.addClass( 'pdwbg' );
												}
											}
										},
										bgAutoHeight: function ( autoHeight ) {
											$in.removeClass( 'pdfbg' ).css( {
												'box-sizing': '',
												'height': '',
												'min-height': '',
												'width': ''
											} );
											if ( autoHeight ) {
												var imgWidth = parseInt( $in.attr( 'data-width' ) ),
													imgHeight = parseInt( $in.attr( 'data-height' ) );
							
												if ( isNaN( imgWidth ) || isNaN( imgHeight ) ) {
													return;
												}
							
												var _parentWidth = $in.parent().width(),
													ratio = (_parentWidth * imgHeight) / imgWidth;
												if ( _parentWidth <= imgWidth ) {
													$in.css( 'min-height', ratio + 'px' );
												} else {
													$in.css( {
														'min-height': imgHeight + 'px'
													} );
												}
							
												$in.addClass( 'pdfbg' ).css( {
													'box-sizing': 'border-box'
												} );
											}
										},
										position: function ( _value ) {
											_value = _value === 'bot' ? 'bottom' : _value;
											$out.removeClass( 'top bot bottom' );
											if ( _value != 'default' ) {
												$out.addClass( _value );
											}
										}
									};
								},
								tve_thrive_ultimatum_shortcode: function ( options ) {
							
									options = options || {};
							
									var $element = this,
										config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( '.thrive-shortcode-config' ), 'ultimatum_shortcode' );
							
									return {
										fetch: function () {
											try {
												var _data = config.get();
											} catch ( Exception ) {
												var _data = {};
											}
							
											jQuery.extend( _data, options );
							
											_data.action = 'tve_ajax_load';
											_data.ajax_load = 'sc_thrive_ultimatum_shortcode';
							
											TVE.main.overlay();
											jQuery.post( tve_path_params.ajax_url, _data, function ( response ) {
												$element.replaceWith( response );
												TVE.main.overlay( 'close' );
											} );
										},
										on_menu_open: function ( $menu ) {
											var $list = $menu.find( '#tve_ultimatum_shortcode_list' ).empty(),
												designs = tve_path_params.tu_shortcode_campaigns[this.config().id].designs;
											jQuery.each( designs, function ( design_id, design_title ) {
												var $li = jQuery( '<li data-value="' + design_id + '" class="tve_click tve-o-ultimatum-shortcode" data-ctrl="controls.thrive_ultimatum_shortcode.option" data-fn="fetch">' + design_title + '</li>' );
												$list.append( $li );
											} );
											tve_set_selected_dropdown( $list.find( 'li[data-value="' + this.config().design + '"]' ) );
										},
										/**
										 * get the config object assigned to this shortcode (already filled in with this element's configurable properties)
										 *
										 * @returns {*}
										 */
										config: function () {
											try {
												return config.get();
											} catch ( Exception ) {
												return {}
											}
										},
										lightbox: function () {
											var $campaign = $element.find( '#tve_ult_campaign' ),
												$shortcode = $element.find( '#tve_ult_shortcode' );
											$campaign.change( function () {
												$shortcode.html( '' );
												try {
													jQuery.each( tve_path_params.tu_shortcode_campaigns[this.value].designs, function ( id, name ) {
														var $option = jQuery( '<option/>' ).text( name ).val( id );
														$shortcode.append( $option );
													} );
													if ( $shortcode.find( 'option[value="' + $shortcode.attr( 'data-selected' ) + '"]' ).length ) {
														$shortcode.val( $shortcode.attr( 'data-selected' ) );
													}
												} catch ( Exception ) {
							
												}
											} );
											$campaign.trigger( 'change' );
										}
									};
								},
								/**
								 * handle Thrive Leads Shortcode
								 * @returns {{fetch: Function}}
								 */
								tve_thrive_leads_shortcode: function () {
									var $element = this,
										config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( '.thrive-shortcode-config' ), 'leads_shortcode' );
							
									return {
										/**
										 * reload the whole opt-in shortcode from the server
										 *
										 * @param id
										 */
										fetch: function ( id ) {
											try {
												var _data = config.get();
											} catch ( Exception ) {
												var _data = {};
											}
											_data.thrive_leads_shortcode_id = id;
											_data.nowrap = 1;
											_data.action = 'tve_ajax_load';
											_data.ajax_load = 'sc_thrive_leads_shortcode';
											TVE.main.overlay();
											jQuery.post( tve_path_params.ajax_url, _data, function ( response ) {
												$element.html( response );
												TVE.main.overlay( 'close' );
											} );
										},
										/**
										 * get the config object assigned to this shortcode (already filled in with this element's configurable properties)
										 *
										 * @returns {*}
										 */
										config: function () {
											try {
												return config.get();
											} catch ( Exception ) {
												return {}
											}
										}
									}
								},
								/**
								 * handle Thrive Opt-In specific functions
								 * @returns {{fetch: Function}}
								 */
								tve_thrive_optin: function () {
									var $element = this,
										config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( '.thrive-shortcode-config' ), 'optin' ),
										$container = $element.find( '> .thrive-shortcode-html > .scon' ),
										field_count = $element.find( 'input[type=text],select' ).length,
										$button = $element.find( '.btn' );
							
									return {
										/**
										 * reload the whole opt-in shortcode from the server
										 *
										 * @param Number id
										 */
										fetch: function ( optin_id ) {
											var _data = config.get();
											_data.optin = optin_id;
											_data.nowrap = 1;
											_data.action = 'tve_ajax_load';
											_data.ajax_load = 'sc_thrive_optin';
											TVE.main.overlay();
											jQuery.post( tve_path_params.ajax_url, _data, function ( response ) {
												$element.html( response );
												TVE.main.overlay( 'close' );
											} );
										},
										color: function ( color ) {
											jQuery.each( tve_path_params.thrive_optin_colors, function ( key ) {
												$button.removeClass( key );
											} );
											$button.addClass( color );
											config.update( color, 'color' );
										},
										size: function ( size ) {
											$button.removeClass( 'small medium big' ).addClass( size );
											config.update( size, 'size' );
										},
										layout: function ( value ) {
											$container.removeClass( 'wide otit o1 o2 o3' );
											if ( value == 'horizontal' ) {
												$container.addClass( 'wide o' + field_count );
												if ( field_count >= 3 ) {
													$container.addClass( 'otit' );
												}
											}
											config.update( value, 'layout' );
										},
										text: function ( value ) {
											$button.find( 'input' ).val( value );
											config.update( value, 'text' );
										},
										/**
										 * get the config object assigned to this shortcode (already filled in with this element's configurable properties)
										 *
										 * @returns {*}
										 */
										config: function () {
											return config.get();
										}
									};
								},
								tve_countdown_timer: function () {
									var $element = this,
										setValues = function ( container, value ) {
											container.empty();
											if ( value <= 99 ) {
												container.prepend( '<span class="part-1">' + value % 10 + '</span>' );
												container.prepend( '<span class="part-2">' + Math.floor( value / 10 ) + '</span>' );
											} else {
												var index = 0;
												while ( value ) {
													index ++;
													container.prepend( '<span class="part-' + index + '">' + (value % 10) + '</span>' );
													value = Math.floor( value / 10 );
												}
											}
										};
									return {
										set: function ( what, value ) {
											$element.attr( 'data-' + what, value );
											this.update();
										},
										get: function ( what ) {
											if ( what == '_all' ) {
												return this.get( 'date' ) + 'T' + this.get( 'hour' ) + ':' + this.get( 'min' ) + ':00' + this.get( 'timezone' );
											}
											return $element.attr( 'data-' + what );
										},
										update: function () {
											var now = new Date(),
												event_date = new Date( this.get( '_all' ) );
							
											$element.find( '.tve_t_text' ).hide().html( this.get( 'text' ) );
											$element.find( '.tve_t_part' ).show();
							
											var sec = 0, min = 0, hour = 0, day = 0, day_digits;
							
											if ( now < event_date ) {
												sec = Math.floor( (event_date.getTime() - now.getTime()) / 1000 );
												min = Math.floor( sec / 60 );
												hour = Math.floor( min / 60 );
												day = Math.floor( hour / 24 );
												day_digits = 2;
												sec = sec % 60;
												min = min % 60;
												hour = hour % 24;
												if ( day > 99 ) {
													day_digits = day.toString().length;
												}
							
											}
											setValues( $element.find( '.tve_t_sec .t-digits' ), sec );
											setValues( $element.find( '.tve_t_min .t-digits' ), min );
											setValues( $element.find( '.tve_t_hour .t-digits' ), hour );
											setValues( $element.find( '.tve_t_day .t-digits' ), day );
							
											if ( now < event_date && ! $element.data( 'dd' ) ) {
												$element.find( '.tve_t_day .t-digits' ).css( 'min-width', (day_digits * $element.find( '.tve_t_sec .t-digits > span' ).first().outerWidth()) + 'px' );
											} else {
												$element.find( '.tve_t_day .t-digits' ).css( 'min-width', '' );
											}
										},
										align: function ( align ) {
											var $container = $element.children( '.sc_timer_content' );
											/**
											 * Set up the margin as they are because alignment classes define specific margins
											 */
											$container.css( 'margin-top', $container.css( 'margin-top' ) );
											$container.css( 'margin-bottom', $container.css( 'margin-bottom' ) );
											switch ( align ) {
												case 'left':
													$container.removeClass( "alignleft alignright aligncenter" ).addClass( "alignleft" );
													break;
												case 'center':
													$container.removeClass( 'alignleft alignright' ).addClass( 'tve_block_center' );
													break;
												case 'right':
													$container.removeClass( "alignleft alignright aligncenter" ).addClass( "alignright" );
													break;
												case 'none':
													$container.removeClass( "alignleft alignright aligncenter" ).css( 'width', 'auto' );
													break;
											}
										}
									};
								},
							
								tve_countdown_timer_evergreen: function () {
									var $element = jQuery( this ),
										timer = $element.tve_countdown_timer();
							
									//this function is only a copy of setValues() from tve_countdown_timer() plugin
									setValues = function ( container, value ) {
										container.empty();
										if ( value <= 99 ) {
											container.prepend( '<span class="part-1">' + value % 10 + '</span>' );
											container.prepend( '<span class="part-2">' + Math.floor( value / 10 ) + '</span>' );
										} else {
											var index = 0;
											while ( value ) {
												index ++;
												container.prepend( '<span class="part-' + index + '">' + (value % 10) + '</span>' );
												value = Math.floor( value / 10 );
											}
										}
									};
							
									/**
									 * only a copy from its parent with few changes: event_date has new logic
									 * @returns {timer}
									 */
									timer.update = function () {
										var now = new Date(),
											event_date = new Date();
							
										event_date.setTime( now.getTime() + (parseInt( this.get( 'day' ) ) * 24 * 3600 * 1000) + (parseInt( this.get( 'hour' ) ) * 3600 * 1000) + (parseInt( this.get( 'min' ) ) * 60 * 1000) + (parseInt( this.get( 'sec' ) ) * 1000) );
							
										$element.find( '.tve_t_text' ).hide().html( this.get( 'text' ) );
										$element.find( '.tve_t_part' ).show();
							
										//based on this id we set the cookie name; any changes on this evergreen we set up a new cookie to be ready for clients
										$element.attr( 'data-id', typeof _ !== 'undefined' ? _.uniqueId( 'evergreen_' ) : ('evergreen_' + parseInt( Math.random() * 10000 )) );
							
										var sec = 0, min = 0, hour = 0, day = 0, day_digits;
							
										if ( now < event_date ) {
											sec = Math.floor( (event_date.getTime() - now.getTime()) / 1000 );
											min = Math.floor( sec / 60 );
											hour = Math.floor( min / 60 );
											day = Math.floor( hour / 24 );
											day_digits = 2;
											sec = sec % 60;
											min = min % 60;
											hour = hour % 24;
											if ( day > 99 ) {
												day_digits = day.toString().length;
											}
										}
										setValues( $element.find( '.tve_t_sec .t-digits' ), sec );
										setValues( $element.find( '.tve_t_min .t-digits' ), min );
										setValues( $element.find( '.tve_t_hour .t-digits' ), hour );
										setValues( $element.find( '.tve_t_day .t-digits' ), day );
							
										if ( now < event_date ) {
											$element.find( '.tve_t_day .t-digits' ).css( 'min-width', (day_digits * $element.find( '.tve_t_sec .t-digits > span' ).first().outerWidth()) + 'px' );
										} else {
											$element.find( '.tve_t_day .t-digits' ).css( 'min-width', '' );
										}
							
										return this;
									};
							
									return timer;
								},
							
								/**
								 * handle Thrive PostsList schortcode specific functions
								 *
								 * @returns object
								 */
								tve_thrive_posts_list: function () {
									var $element = this,
										config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( '.thrive-shortcode-config' ), 'posts_list' );
							
									return {
										/**
										 * reload the whole PostsList shortcode from the server
										 *
										 */
										fetch: function () {
											var _data = config.get();
											_data.nowrap = 1;
											_data.action = 'tve_ajax_load';
											_data.ajax_load = 'sc_thrive_posts_list';
											TVE.main.overlay();
											jQuery.post( tve_path_params.ajax_url, _data, function ( response ) {
												$element.html( response );
												TVE.main.overlay( 'close' );
											} );
										},
										set: function ( value, what ) {
											config.update( value, what );
											this.fetch();
										},
										/**
										 * get the config object assigned to this shortcode (already filled in with this element's configurable properties)
										 *
										 * @returns {*}
										 */
										config: function () {
											return config.get();
										}
									};
								},
							
								tve_thrive_custom_phone: function () {
									var $element = this,
										config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( '.thrive-shortcode-config' ), 'custom_phone' );
									return {
										fetch: function () {
											var _data = config.get();
											_data.nowrap = 1;
											_data.action = 'tve_ajax_load';
											_data.ajax_load = 'sc_thrive_custom_phone';
											TVE.main.overlay();
											jQuery.post( tve_path_params.ajax_url, _data, function ( response ) {
												$element.html( response );
												TVE.main.overlay( 'close' );
											} );
										},
										set: function ( value, what ) {
											config.update( value, what );
											this.fetch();
										},
										config: function () {
											return config.get();
										}
									};
								},
							
								/**
								 * handle Thrive Cumstom menu
								 * @returns object
								 */
								tve_thrive_custom_menus: function () {
									var $element = this,
										config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( ".thrive-shortcode-config" ), 'custom_menu' );
									return {
										fetch: function () {
											var _data = config.get();
											_data.nowrap = 1;
											_data.action = 'tve_ajax_load';
											_data.ajax_load = 'sc_thrive_custom_menu';
											TVE.main.overlay();
											jQuery.post( tve_path_params.ajax_url, _data, function ( response ) {
												$element.html( response );
												TVE.main.overlay( 'close' );
											} );
										},
										set: function ( value, what ) {
											config.update( value, what );
											this.fetch();
										},
										config: function () {
											return config.get();
										}
									};
								},
							
								tve_tw_qs: function () {
									var $element = this;
									return {
										config: function ( what, value ) {
											if ( typeof what === 'undefined' || what.length === 0 ) {
												throw "Invalid option";
											}
											if ( typeof value === 'undefined' ) {
												return this.get( what );
											}
											return this.set( what, value );
										},
										set: function ( what, value ) {
											$element.attr( 'data-' + what, value );
											return this;
										},
										get: function ( what ) {
											return $element.attr( 'data-' + what );
										}
									}
								},
							
								tve_contents_table: function () {
									var $element = this;
									var table = {
										options: new Array(),
										$container: null,
										init: function () {
											this.config( 'columns', $element.attr( 'data-columns' ) );
											this.initHeaders();
											this.$container = $element.find( '.tve_contents_table' );
											return this;
										},
										set: function ( what, value ) {
											this.options[what] = value;
											this.saveConfig( what, value );
											return this;
										},
										get: function ( what ) {
											return this.options[what];
										},
										saveConfig: function ( what, value ) {
											$element.attr( 'data-' + what, value );
										},
										updateHeaders: function ( header ) {
											for ( var i = 0; i < this.options['headers'].length; i ++ ) {
												if ( this.options['headers'][i] === header ) {
													this.options['headers'].splice( i, 1 );
													this.config( 'headers', this.options['headers'].sort() );
													return this;
												}
											}
											this.options['headers'].push( header );
											this.config( 'headers', this.options['headers'].sort() );
											return this;
										},
										initHeaders: function () {
											if ( typeof $element.data( 'headers' ) === 'undefined' ) {
												this.config( 'headers', ['h1', 'h2', 'h3'] );
											} else {
												if ( $element.attr( 'data-headers' ).length === 0 ) {
													this.config( 'headers', [] );
												} else {
													this.config( 'headers', $element.attr( 'data-headers' ).split( "," ) );
												}
											}
											return this;
										},
										config: function ( what, value ) {
											if ( typeof what === 'undefined' || what.length === 0 ) {
												throw "Invalid option";
											}
											if ( typeof value === 'undefined' ) {
												return this.get( what );
											}
											return this.set( what, value );
										},
										update: function () {
											var self = this;
											this.$container.find( 'a' ).remove();
											if ( ! this.options['headers'].length ) {
												return;
											}
											$element.find( '.tve_ct_content' ).html( '' );
											jQuery( "#tve_editor, #tve_editor .tve_editor_main_content" ).find( this.config( 'headers' ).join( ',' ) ).each( function () {
												var $this = jQuery( this ),
													clean_id = $this.attr( 'id' ) ? $this.attr( 'id' ) : self.generateNewID(),
													$item = jQuery( '<div class="' + self.getCssClass( $this ) + '" ><a href="#' + clean_id + '">' + $this.text() + '</a></div>' );
												/**
												 * append element to the list only if it's visible on the page
												 *
												 * e.g. having headings in WP Content element
												 */
												if ( $this.is( ':visible' ) ) {
													$element.find( '.tve_ct_content' ).append( $item );
												}
												$this.attr( 'id', clean_id );
											} );
											$element.find( '.tve_ct_title' ).text( this.config( 'title' ) );
											this.splitInColumns();
										},
										generateNewID: function () {
											var i = 1,
												ID = 'tab-con-' + i;
											while ( jQuery( '#' + ID ).length > 0 ) {
												ID = 'tab-con-' + (++ i);
											}
											return ID;
										},
										getCssClass: function ( $header ) {
											return "tve_ct_level" + this.config( 'headers' ).indexOf( $header[0].nodeName.toLowerCase() );
										},
										splitInColumns: function () {
											$element.find( '.tve_ct_content' ).children( '.leftCol, .rightCol' ).remove();
											var totalTopLevels = $element.find( '.tve_ct_content .tve_ct_level0' ).length,
												topLevelToColumns = 0,
												columns = new Array(),
												self = this
											;
							
											for ( var i = 0; i < this.config( 'columns' ); i ++ ) {
												var column = jQuery( '<div class="ct_column sep"></div>' );
												columns.push( column );
											}
											//remove the sep class for the last column
											columns.push( columns.pop().removeClass( 'sep' ) );
							
											//remove the columns for the case where there are only one link as top level
											$element.find( '.tve_ct_content .ct_column' ).remove();
							
											if ( totalTopLevels <= 1 ) {
												return;
											}
							
											var columnIndex = 0;
											$element.find( '.tve_ct_content' ).children( '.tve_ct_level0, .tve_ct_level1, .tve_ct_level2' ).each( function ( i ) {
												var $this = jQuery( this );
							
												if ( $this.is( '.tve_ct_level0' ) ) {
													columnIndex = Math.floor( topLevelToColumns * columns.length / totalTopLevels );
												}
							
												columns[columnIndex].append( function () {
													return $this;
												} );
							
												if ( $this.is( '.tve_ct_level0' ) ) {
													topLevelToColumns ++;
												}
											} );
							
											//append columns to element
											$element.find( '.tve_ct_content' ).html( '' );
											for ( var i = 0, column; column = columns[i ++]; ) {
												column.css( 'width', 100 / columns.length + '%' );
												$element.find( '.tve_ct_content' ).append( column );
											}
							
											//set up max height for all columns if there are more than one
											var maxHeightOfColumns = 0;
											$element.find( '.ct_column' ).each( function () {
												var $this = jQuery( this );
												if ( $this.height() > maxHeightOfColumns ) {
													maxHeightOfColumns = $this.height();
												}
											} );
											$element.find( '.ct_column' ).css( 'min-height', maxHeightOfColumns + 'px' );
										}
									};
									return table.init();
								},
							
								tve_responsive_video: function () {
									var $element = this;
									return {
										fetch: function () {
											var videoUrl = this.config( 'url' );
											if ( videoUrl ) {
												//if it's not wistia popover set 100% size
												if ( ! (this.config( 'embed_type' ) == 'popover' && this.config( 'type' ) == 'wistia') ) {
													if ( $element.find( '.tve_wistia_container' ).length ) {
														$element.find( '.tve_wistia_container' ).remove();
														$element.find( '.tve_responsive_video_container' ).removeClass( 'tve_with_wistia_popover' );
														$element.find( '.wistia_responsive_padding' ).remove();
													}
													$element.css( {
														'width': '',
														'height': ''
													} );
												}
							
												if ( this.config( 'type' ) === 'self' ) {
													$element.find( 'iframe' ).remove();
													$element.find( '.tve-video' ).remove();
													$element.find( '.tve_responsive_video_container' ).append( '<video style="background:#000000;" class="tve-video" src="" controls="controls" preload="auto"><source src="" ></source><a href=""></a></video>' );
													var _ext = this.config( 'embeded-url' ).split( "." ).pop();
							
													$element.find( '.tve-video source' ).attr( {
														src: this.config( 'embeded-url' ),
														type: "video/" + _ext
													} );
							
													$element.find( '.tve-video' ).attr( {
														src: this.config( 'embeded-url' ),
														type: "video/" + _ext
													} );
							
													if ( this.config( 'controls' ) === '0' ) {
														$element.find( '.tve-video' ).removeAttr( 'controls' );
													}
													$element.find( 'a' ).attr( 'href', this.config( 'embeded-url' ) ).text( this.config( 'embeded-url' ) );
												} else if ( this.config( 'embed_type' ) == 'popover' && this.config( 'type' ) == 'wistia' ) {
													if ( $element.find( '.tve_wistia_container' ).length === 0 ) {
														$element.find( '.tve_responsive_video_container' ).append( '<div class="wistia_responsive_padding"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;"><div class="tve_wistia_container"><div class="tve_wistia_loader"></div></div></div></div>' );
													}
													if ( $element.find( 'iframe' ).length != 0 ) {
														$element.find( 'iframe' ).remove();
													}
													var overlay = this.config( 'overlay' );
													var widthPx = (typeof this.config( 'video-width' ) !== 'undefined' && this.config( 'video-width' ) != '0') ? this.config( 'video-width' ) + "px" : "100%";
													var heightPx = (typeof this.config( 'video-height' ) !== 'undefined' && this.config( 'video-height' ) != '0') ? this.config( 'video-height' ) + "px" : "572px";
							
													$element.find( '.tve_wistia_container' ).attr( 'data-start-time', this.config( 'start-time' ) );
													$element.find( '.tve_wistia_container' ).attr( 'data-type', this.config( 'type' ) );
													$element.find( '.tve_wistia_container' ).attr( 'data-video-id', videoUrl.split( "/" ).pop() );
													$element.find( '.tve_responsive_video_container' ).addClass( "tve_with_wistia_popover" );
													$element.css( {
														'height': heightPx,
														'width': widthPx
													} );
							
													var qString = this.queryString( this.config( 'type' ) );
													qString = qString.replace( "?", "" );
													var wistia_url_class = "wistia_async_" + videoUrl.split( "/" ).pop();
													$element.find( '.tve_wistia_container' ).removeAttr( 'class' ).addClass( "tve_wistia_container tve_wistia_popover wistia_embed " + wistia_url_class + " " + qString );
													$element.find( '.tve_green_button' ).remove();
													$element.removeClass( 'responsive_video_placeholder' );
													$element.find( '.no-video' ).remove();
												} else {
													$element.find( 'iframe' ).css( 'display', 'block' );
													var _src = this.config( 'embeded-url' ) + this.queryString( this.config( 'type' ) );
													$element.find( '.tve-video' ).remove();
													if ( $element.find( 'iframe' ).length === 0 ) {
														$element.find( '.tve_responsive_video_container' ).append( '<iframe src="" frameborder="0" allowfullscreen></iframe>' );
													}
													$element.find( 'iframe' ).attr( 'src', _src ).attr( 'data-src', _src );
							
												}
							
												$element.find( '.tve_responsive_video_container' ).css( 'display', 'block' );
												$element.find( '.tve_green_button' ).remove();
												$element.removeClass( 'responsive_video_placeholder' );
												$element.find( '.no-video' ).remove();
											} else {
												$element.find( 'iframe' ).attr( 'src', '' ).css( 'display', 'none' );
												$element.find( 'div.tve_wistia_container' ).css( 'display', 'none' );
												$element.find( '.video_overlay' ).html( '<h3 class="no-video" style="text-align: center">Insert a video URL</h3>' );
											}
											return this;
										},
										set: function ( value, what ) {
											if ( what === 'url' ) {
												$element.attr( 'data-url', value );
												$element.attr( 'data-embeded-url', this.embededUrl( value ) );
												return this.fetch();
											} else if ( what === 'overlay' ) {
												$element.attr( 'data-overlay', value );
												return this.fetch();
											}
											$element.attr( 'data-' + what, value );
											return this.fetch();
										},
										rgb2hex: function ( rgb ) {
											rgb = rgb.match( /^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i );
											return (rgb && rgb.length === 4) ?
												("0" + parseInt( rgb[1], 10 ).toString( 16 )).slice( - 2 ) +
												("0" + parseInt( rgb[2], 10 ).toString( 16 )).slice( - 2 ) +
												("0" + parseInt( rgb[3], 10 ).toString( 16 )).slice( - 2 ) : rgb;
										},
										embededUrl: function ( videoUrl ) {
											var embedUrl = '';
											switch ( this.config( 'type' ) ) {
												case 'youtube':
													if ( videoUrl.indexOf( "embed" ) !== - 1 ) {
														return videoUrl;
													}
													embedUrl = 'https://www.youtube.com/embed/';
													var videoId = videoUrl.split( "?" ).pop().split( "&" ).shift().split( "=" )[1];
							
													//if videourl is a shortened url
													if ( videoUrl.indexOf( 'youtu.be' ) !== - 1 ) {
														videoId = videoUrl.split( '/' ).pop();
														videoId = videoId.indexOf( "?" ) !== - 1 ? videoId.split( "?" ).shift() : videoId;
													}
													embedUrl += videoId;
													break;
												case 'vimeo':
													embedUrl = 'https://player.vimeo.com/video/' + videoUrl.split( "/" ).pop();
													break;
												case 'wistia':
													embedUrl = '//fast.wistia.net/embed/iframe/' + videoUrl.split( "/" ).pop();
													break;
												case 'self':
													var _ext = videoUrl.split( "." ).pop(),
														_ext_validate = false;
													jQuery.each( rv_accepted_extensions.split( ' ' ), function ( i, v ) {
														if ( _ext === v ) {
															_ext_validate = true;
														}
													} );
							
													if ( _ext_validate === true ) {
														embedUrl = videoUrl;
													} else {
														embedUrl = '';
													}
							
													break;
											}
											return embedUrl;
										},
										queryString: function ( type ) {
											var queryString = '?',
												options;
											switch ( type ) {
												case 'youtube':
													options = new Array(
														'rel=' + (typeof this.config( 'rel' ) === 'undefined' ? '1' : this.config( 'rel' )),
														'modestbranding=' + (typeof this.config( 'modestbranding' ) === 'undefined' ? '0' : this.config( 'modestbranding' )),
														'controls=' + (typeof this.config( 'controls' ) === 'undefined' ? '1' : this.config( 'controls' )),
														'showinfo=' + (typeof this.config( 'showinfo' ) === 'undefined' ? '1' : this.config( 'showinfo' )),
														// 'autoplay=' + (typeof this.config('autoplay') === 'undefined' ? '0' : this.config('autoplay')),
														'fs=' + (typeof this.config( 'fs' ) === 'undefined' ? '1' : this.config( 'fs' )),
														'wmode=transparent'
													);
													if ( typeof this.config( 'start-time' ) !== 'undefined' && this.config( 'start-time' ) != '0' ) {
														options.push( 'start=' + this.config( 'start-time' ) );
													}
													queryString += options.join( '&' );
													break;
							
												case 'wistia':
													options = new Array(
														'chromeless=' + (typeof this.config( 'controls' ) === 'undefined' ? 'false' : this.config( 'controls' ) === '0'),
														'controlsVisibleOnLoad=' + (typeof this.config( 'onload-controls' ) === 'undefined' ? 'true' : this.config( 'onload-controls' ) === '1'),
														'playbar=' + (typeof this.config( 'play-bar' ) === 'undefined' ? 'true' : this.config( 'play-bar' ) === '1'),
														//'autoPlay=' + (typeof this.config('autoplay') === 'undefined' ? 'false' : this.config('autoplay') === '1'),
														'fullscreenButton=' + (typeof this.config( 'fs' ) === 'undefined' ? 'true' : this.config( 'fs' ) === '1'),
														'playerColor=' + (typeof this.config( 'video-color' ) === 'undefined' ? 'ff0000' : this.rgb2hex( this.config( 'video-color' ) )),
														'videoFoam=true'
													);
													var embed_type = this.config( 'embed_type' );
													if ( typeof this.config( 'start-time' ) !== 'undefined' && this.config( 'start-time' ) != '0' && embed_type != 'popover' ) {
														options.push( 'time=' + this.config( 'start-time' ) );
													}
													if ( embed_type == 'popover' ) {
														options.push( 'popover=true popoverAnimateThumbnail=true' );
														queryString += options.join( ' ' );
													} else {
														queryString += options.join( '&' );
													}
													break;
												case 'vimeo':
													options = new Array(
														//'autoplay=' + (typeof this.config('autoplay') === 'undefined' ? '0' : this.config('autoplay')),
														'badge=' + (typeof this.config( 'modestbranding' ) === 'undefined' ? '1' : this.config( 'modestbranding' )),
														'title=' + (typeof this.config( 'showinfo' ) === 'undefined' ? '0' : this.config( 'showinfo' )),
														'color=' + (typeof this.config( 'video-color' ) === 'undefined' ? 'ff0000' : this.rgb2hex( this.config( 'video-color' ) ))
													);
													queryString += options.join( '&' );
													break;
												//case 'self':
												//    break;
												default:
													queryString = '';
											}
							
											return queryString;
										},
										config: function ( what ) {
											return $element.attr( 'data-' + what );
										}
									}
								},
								tve_tabs: function () {
									var $element = this,
										$container = $element.find( '> .tve_scT' ),
										_tabTarget = function ( $tab ) {
											return $container.find( '> .tve_scTC' ).eq( $tab.index() );
										};
							
									return {
										isVertical: function () {
											return $container.hasClass( 'tve_vtabs' );
										},
										show: function ( _index ) {
											$container.find( '> ul li' ).eq( _index ).click();
										},
										addTab: function () {
											var new_tab_index = $container.find( "> ul li" ).length + 1,
												tab_header_custom_colour = $container.find( "> ul li:not(.tve_tS)" ).first().attr( "data-tve-custom-colour" ),
												new_tab_header_html = '<li data-tve-custom-colour="' + tab_header_custom_colour + '"><span>New Tab</span></li>',
												tab_content_custom_colour = $container.find( "> div" ).first().attr( "data-tve-custom-colour" ),
												new_tab_content_html = jQuery( '<div class="tve_scTC" style="display: none;" data-tve-custom-colour="' + tab_content_custom_colour + '"><div class="thrv_wrapper thrv_text_element"><p>Tab ' + new_tab_index + '</p></div></div>' );
							
											$container.find( "> ul" ).append( new_tab_header_html );
											$container.append( new_tab_content_html );
											TVE.drag.bind_draggable( new_tab_content_html );
											if ( this.isVertical() ) {
												this.resize();
											}
										},
										removeTab: function ( $tab ) {
											_tabTarget( $tab ).remove();
											$tab.remove();
											if ( $element.find( 'li' ).length === 0 ) {
												//no more tabs, nothing to do
												return;
											}
											this.setDefaultSelected();
											if ( this.isVertical() ) {
												this.resize();
											}
											this.populateTabList();
											var _index = parseInt( this.getDefaultSelected() );
											if ( _index >= $container.find( '> ul li' ).length ) {
												this.setDefaultSelected( _index - 1 );
											}
										},
										resize: function () {
											// setup the containers so that they always have a minimum height; this way the menu does not flow out of the container
											$container.find( '.tve_scTC' ).css( 'min-height', ($container.find( '> ul' ).outerHeight() + 40) + 'px' );
										},
										populateTabList: function () {
											var $list = jQuery( 'ul#tve_tabs_selected' ).empty();
											$container.find( '> ul li' ).each( function () {
												$list.append( jQuery( '<li class="tve_btn_text tve_click tve_selected_tab" id="default_tab">' + jQuery( this ).text() + '</li>' ) );
											} );
											return this;
										},
										getDefaultSelected: function () {
											var _index = $container.attr( 'data-selected' );
											if ( ! _index ) {
												_index = 0;
												this.setDefaultSelected( 0 );
											}
											return _index;
										},
										setDefaultSelected: function ( _index ) {
											if ( typeof _index === 'undefined' ) {
												_index = this.getDefaultSelected();
											}
											$container.attr( 'data-selected', _index );
											this.show( _index );
										}
									};
								},
							
								tve_rating: function () {
									var $element = this,
										$outer = $element.children( '.tve_rating_stars' ),
										$inner = $outer.children( 'span' ),
										star_width = 24;
							
									return {
										set: function ( k, v ) {
											$outer.attr( 'data-' + k, v );
											this.draw();
										},
										get: function ( k ) {
											return $outer.attr( 'data-' + k );
										},
										draw: function () {
											var _value = parseFloat( this.get( 'value' ) ),
												_max = parseInt( this.get( 'max' ) );
											if ( isNaN( _value ) ) {
												_value = 0;
											}
											if ( isNaN( _max ) ) {
												_max = 5;
											}
											if ( _value > _max ) {
												_value = _max;
												this.set( 'value', _value );
											}
											$outer.css( 'width', _max * star_width + 'px' );
											$inner.css( 'width', _value * star_width + 'px' );
											$outer.attr( 'title', _value + ' / ' + _max );
										}
									};
								},
							
								/**
								 * handles controls for the image element
								 */
								tve_image: function () {
							
									var control = {
										e: null, //wrapper
										i: null, //image
										init: function ( element ) {
											/* backwards compat fix for editable images */
											if ( element.hasClass( 'tve_image_caption' ) ) {
												element = element.find( 'img' );
											}
											this.e = element;
											this.i = element;
											if ( this.i.parents( '.thrv_feature_grid .tve_gri' ).length ) {
												//return this;
											}
											return this.ensureCompliant();
										},
										/**
										 * make sure that the html for the image element is structured like this:
										 * div.tve_image_caption[.wp-caption]
										 *      span.tve_image_frame
										 *          [a] (optional)
										 *              img.tve_image
										 *          [/a]
										 *      /span
										 * /div
										 */
										ensureCompliant: function () {
											return this;
											var elem = this.e,
												align_classes = ['alignleft', 'aligncenter', 'alignright'],
												margins = [
													'margin',
													'margin-top',
													'margin-left',
													'margin-right',
													'margin-bottom'
												];
											if ( elem.parent().is( 'a' ) ) {
												elem = elem.parent();
											}
							
											if ( ! elem.parent().is( '.tve_image_frame' ) ) {
												elem.wrapAll( '<span class="tve_image_frame"></span>' );
											}
											elem = elem.parent();
											if ( ! elem.parent().is( '.tve_image_caption' ) ) {
												elem.wrapAll( '<div class="tve_image_caption thrv_wrapper"></div>' );
											}
											this.e = elem.parent();
											var _parent = this.e.parent();
							
											for ( var i = 0, cls; cls = align_classes[i ++]; ) {
												if ( this.i.hasClass( cls ) ) {
													this.i.removeClass( cls );
													this.e.addClass( cls );
													if ( _parent.is( '.tve_gri' ) ) {
														_parent.addClass( cls );
													}
												}
											}
											for ( i = 0; cls = margins[i ++]; ) {
												if ( this.i.css( cls ) && ! this.e.parent().is( '.tve_gri' ) && this.i.css( cls ) != '0px' ) {
													this.e.css( cls, this.i.css( cls ) );
													this.i.css( cls, '' );
												}
											}
											this.checkCaption();
							
											return this;
										},
										hasStyle: function ( style ) {
											if ( style !== '__none__' ) {
												return this.e.hasClass( style );
											}
							
											var self = this,
												style_found = false;
							
											/* style = __none__ => check if image has no TCB style applied */
											jQuery.each( img_styles.split( ' ' ), function ( i, v ) {
												if ( self.e.hasClass( v ) ) {
													style_found = true;
												}
											} );
							
											return ! style_found;
										},
										align: function ( align ) {
											this.e.removeClass( 'alignleft aligncenter alignright' ).addClass( align.replace( 'alignno', '' ) );
											if ( align == 'aligncenter' ) {
												this.e.css( {
													'margin-left': '',
													'margin-right': ''
												} );
											}
											var _parent = this.e.parent();
											if ( _parent.is( '.tve_gri' ) ) {
												_parent.removeClass( 'alignleft aligncenter alignright' ).addClass( align.replace( 'alignno', '' ) );
											}
										},
										style: function ( _style ) {
											this.e.removeClass( img_styles ).addClass( _style )
											this.checkCaption();
										},
										/**
										 * replace the image src, alt, title with the selected ones
										 * this happens when the user changes an image using the control panel button
										 * @param attachment
										 */
										attach: function ( attachment ) {
											console.log( attachment );
											if ( attachment.alt ) {
												this.i.attr( 'alt', attachment.alt );
											}
											if ( ! attachment.caption ) {
												this.e.find( '.wp-caption-text' ).remove();
											} else {
												if ( this.e.find( '.wp-caption-text' ).length === 0 ) {
													this.e.append( '<p class="wp-caption-text"></p>' );
												}
												this.e.find( '.wp-caption-text' ).html( attachment.caption );
											}
											if ( ! this.i.css( 'width' ) ) {
												this.i.css( 'width', attachment.width + 'px' );
												this.e.css( 'width', attachment.width + 'px' );
											}
							
											this.i.attr( 'src', attachment.url ).removeClass( "tve_active_image" );
											this.checkCaption();
										},
										checkCaption: function () {
											if ( ! this.hasCaption() || ! this.hasStyle( '__none__' ) ) {
												this.e.removeClass( 'wp-caption' );
											} else {
												this.e.addClass( 'wp-caption' );
											}
										},
										hasCaption: function () {
											return this.e.find( '.wp-caption-text' ).length && this.e.find( '.wp-caption-text' ).text().length;
										}
									};
							
									return control.init( this );
								},
							
								/**
								 *  return utility functions for thrive_lightbox settings
								 *
								 *  this is the .thrv_wrapper element
								 */
								tve_lightbox: function () {
									var $element = this.is( '.tve_p_lb_content' ) ? this : this.parents( '.tve_p_lb_content' ).first();
							
									return {
										setBgPattern: function ( patternUrl ) {
											this.clearBgImage().clearBgColor().set_option( 'l_cpat', patternUrl ); // content pattern
											$element.css( {
												'background-image': "url('" + patternUrl + "')",
												'background-repeat': 'repeat'
											} );
										},
										setBgImage: function ( wpAttachment ) {
											this.clearBgImage().set_option( 'l_cimg', wpAttachment.url ); // content background image
											$element.css( {
												'background-image': "url('" + wpAttachment.url + "')",
												'background-repeat': '',
												'background-size': 'cover'
											} );
										},
										/* remove the user-background image, pattern bg image etc and all related classes */
										clearBgImage: function () {
											this.set_option( 'l_cimg', '' );
											$element.css( {
												'background-image': '',
												'background-repeat': '',
												'background-size': ''
											} );
											return this;
										},
										clearBgPattern: function () {
											this.set_option( 'l_ccls', '' ).set_option( 'l_cpat', '' );
							
											$element.css( {
												'background-image': '',
												'background-repeat': '',
												'background-size': ''
											} );
											return this;
										},
										clearBgColor: function () {
											this.set_option( 'l_ccls', '' );
											if ( $element.tve_color_selector() ) {
												tve_remove_css_rule( $element.tve_color_selector(), 'background-color' );
											}
											$element.css( 'background-color', '' );
											return this;
										},
										set_option: function ( k, v ) {
											TVE.CONST.tve_globals[k] = v;
											return this;
										}
									};
								},
								/**
								 *  return utility functions for Landing Pages controls
								 */
								tve_lp: function () {
									var $element = this;
									if ( this.hasClass( 'tve_wrap_all' ) ) {
										$element = this.parents( 'body' );
									}
							
									return {
										setBgPattern: function ( patternUrl ) {
											this.clearBgImage().clearBgColor().set_option( 'lp_bgp', patternUrl );
											$element.css( {
												'background-image': "url('" + patternUrl + "')",
												'background-repeat': 'repeat',
												'background-size': 'auto',
												'height': ''
											} );
										},
										setBgImage: function ( wpAttachment ) {
											this.clearBgPattern();
											this.set_option( 'lp_bgi', wpAttachment.url );
											$element.css( {
												'background-image': "url('" + wpAttachment.url + "')",
												'background-repeat': 'no-repeat',
												'background-size': 'cover',
												'background-position': 'center'
											} ).attr( {
												'data-width': wpAttachment.width,
												'data-height': wpAttachment.height
											} );
											if ( $element.hasClass( 'tve_fh' ) ) {
												this.bgCover( true );
											}
										},
										/* remove the user-background image, pattern bg image etc and all related classes */
										clearBgImage: function () {
											this.set_option( 'lp_bgi', 'none' );
											$element.css( {
												'background-image': 'none',
												'background-repeat': '',
												'height': ''
											} ).removeClass( 'tve-lp-fixed' );
											return this;
										},
										clearBgPattern: function () {
											this.set_option( 'lp_bgp', '' );
											this.set_option( 'lp_bgi', 'none' );
							
											$element.css( {
												'background-image': 'none',
												'background-repeat': ''
											} );
											return this;
										},
										clearBgColor: function () {
											this.set_option( 'lp_bg', '#ffffff' );
							
											if ( $element.tve_color_selector() ) {
												tve_remove_css_rule( $element.tve_color_selector(), 'background-color' );
											}
											$element.css( 'background-color', '#ffffff' );
											return this;
										},
										bgAttachment: function ( isFixed ) {
											$element.css( 'background-attachment', isFixed ? 'fixed' : 'scroll' );
											this.set_option( 'lp_bga', isFixed ? 'fixed' : 'scroll' );
											if ( isFixed ) {
												$element.addClass( 'tve-lp-fixed' );
											} else {
												$element.removeClass( 'tve-lp-fixed' );
											}
										},
										bgCover: function ( autoHeight ) {
											$element.css( 'height', '' ).removeClass( 'tve_fh' );
											if ( $element.hasClass( 'tve_lp_content' ) && autoHeight ) {
												var imgWidth = parseInt( $element.attr( 'data-width' ) ),
													imgHeight = parseInt( $element.attr( 'data-height' ) ),
													_width = $element.outerWidth(), _height = '';
												if ( isNaN( imgWidth ) || isNaN( imgHeight ) ) {
													return;
												}
												if ( _width < imgWidth ) {
													var ratio = imgWidth / imgHeight;
													_height = parseInt( _width / ratio );
												} else {
													_height = imgHeight;
												}
												$element.css( {
													'height': _height + 'px'
												} ).addClass( 'tve_fh' );
											}
										},
										set_option: function ( k, v ) {
											if ( $element.is( 'body' ) ) {
												TVE.CONST.tve_globals[k] = v;
											}
											return this;
										}
									};
								},
								tve_post_grid: function ( options ) {
							
									var settings = jQuery.extend( {}, options );
							
									var $element = this;
							
									if ( $element.find( ".thrive-shortcode-config" ).length ) {
										var config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( ".thrive-shortcode-config" ), 'post_grid' );
									}
							
									return {
										sortable: function () {
											$element.find( '.tve_sortable_layout' ).sortable();
											return this;
										},
										autocomplete: function () {
											var data = {
												security: tve_path_params.tve_ajax_nonce
											};
							
											function split( val ) {
												return val.split( /,\s*/ );
											}
							
											function extractLast( term ) {
												return split( term ).pop();
											}
							
											$element.find( '.tve_post_grid_autocomplete' ).autocomplete( {
												source: function ( request, response ) {
													data.term = extractLast( request.term );
													jQuery.ajax( {
														url: tve_path_params.ajax_url,
														dataType: 'json',
														type: 'post',
														data: data,
														success: function ( data ) {
															response( data );
														},
														error: function () {
							
														}
													} );
												},
												focus: function () {
													return false;
												},
												search: function ( event, ui ) {
													data.action = jQuery( this ).data( 'action' );
												},
												select: function ( event, ui ) {
													var terms = split( this.value );
													terms.pop();
													terms.push( ui.item.value );
													terms.push( "" );
													this.value = terms.join( "," );
													return false;
												}
											} );
											return this;
										},
										display: function () {
											var _data = settings,
												_this = this;
							
											if ( config ) {
												_data.currentConfig = this.getConfig();
											} else {
												_data.wrap = 1;
											}
							
											_data.security = tve_path_params.tve_ajax_nonce;
											_data.action = 'tve_do_post_grid_shortcode';
											_data.exclude = tve_path_params.post_id;
							
											TVE.main.overlay();
											jQuery.ajax( {
												url: tve_path_params.ajax_url,
												type: 'post',
												data: _data,
												success: function ( response ) {
													$element.removeClass( 'image_placeholder' );
													TVE.main.overlay( 'close' );
													if ( ! config ) {
														var $newElement = TVE.drag.insert( response, $element, false, true );
													} else {
														var $newElement = $element.empty().append( response );
													}
													TVE.Editor_Page.blur( {forceExit: 1} );
													hide_control_panel_menu();
													$newElement.tve_post_grid().after_render().masonry();
												}
											} );
											return this;
										},
										after_render: function () {
											if ( $element.find( '.tve_post_grid_masonry' ).length ) {
												this.masonry();
												return this;
											}
											$element.find( '.tve_pg_row' ).css( 'height', '' );
											$element.find( '.tve_pg_row' ).each( function () {
												var _maxHeight = 0,
													$row = jQuery( this );
							
												$row.find( '.tve_post' ).each( function () {
													var _this = jQuery( this ),
														_elHeight = parseInt( _this.outerHeight() );
													if ( _elHeight > _maxHeight ) {
														_maxHeight = _elHeight;
													}
													_this.css( 'height', '100%' );
												} );
												$row.css( 'height', (_maxHeight - 1) + 'px' );
											} );
							
											return this;
										},
										masonry: function () {
											if ( $element.find( '.tve_post_grid_masonry' ).length ) {
												$element.find( '.tve_post_grid_masonry' ).masonry();
											}
											return this;
										},
										config: function () {
											return config;
										},
										getConfig: function () {
											return config.get();
										}
									}
								},
								tve_widget_menu: function () {
									var $element = this.is( '.tve_w_menu' ) ? this.parents( '.thrv_widget_menu' ) : this,
										$target = $element.find( '.tve_w_menu' ),
										config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( ".thrive-shortcode-config" ), 'widget_menu' );
									/* we need to read the title every time, the user can edit that also directly */
									config.update( $element.find( '.tve_menu_title' ).text(), 'title' );
									if ( ! $element.data( 'colorpicker-bound' ) ) {
										$element.on( 'editor.oncolorpickerchange', function ( event, selector, color_config ) {
											config = TVE.Editor_Page.thriveShrtcodeConfig( $element.find( ".thrive-shortcode-config" ), 'widget_menu' );
											config.update( selector, color_config.save_key );
										} );
										$element.data( 'colorpicker-bound', true );
									}
									return {
										fetch: function () {
											var _link = jQuery( '#widget_menu_menu' ).find( '.menu-edit-link' ).attr( 'href' ).replace( /&menu=(\d*)/, '&menu=' + config.get().menu_id );
											jQuery( '#widget_menu_menu' ).find( '.menu-edit-link' ).attr( 'href', _link );
											var _data = config.get();
											_data.nowrap = 1;
											_data.action = 'tve_ajax_load';
											_data.ajax_load = 'sc_widget_menu';
											TVE.main.overlay();
											jQuery.post( tve_path_params.ajax_url, _data, function ( response ) {
												var $title = $element.find( '.tve_menu_title' ).clone();
												$element.html( response );
												$element.prepend( $title );
												$target = $element.find( '.tve_w_menu' );
												TVE.main.overlay( 'close' );
											} );
										},
										color_class: function ( color ) {
											for ( var i = 0, col; col = tve_path_params.shortcode_colours[i ++]; ) {
												$target.removeClass( 'tve_' + col );
											}
											$target.addClass( color );
											this.set( color, 'color' );
										},
										font: function ( font ) {
											$target.add( $target.find( 'li' ) ).removeClass( custom_font_classes ).removeClass( extra_font_classes ).addClass( font );
											$target.find( 'li > a' ).css( 'font-family', '' );
											this.set( font, 'font_class' ).set( '', 'font_family' );
										},
										direction: function ( dir ) {
											$target.removeClass( 'tve_horizontal tve_vertical' ).addClass( dir );
											$element.attr( 'data-tve-style', dir );
											TVE_Content_Builder.colors.refresh( true );
											var $secondLevel = $target.find( 'li li a' ),
												$firstLevel = $target.find( '> li > a' );
											if ( dir === 'tve_vertical' ) {
												$target.find( 'ul' ).css( {
													display: '',
													opacity: ''
												} );
												if ( $firstLevel.tve_color_selector() ) {
													$secondLevel.tve_color_selector( $firstLevel.tve_color_selector() );
												}
											} else if ( dir === 'tve_horizontal' ) {
												$secondLevel.tve_color_selector( '' );
											}
											this.set( dir, 'dir' );
										},
										clear_font: function () {
											$target.add( $target.find( 'li' ) ).removeClass( custom_font_classes ).removeClass( extra_font_classes );
											$target.find( 'li > a' ).css( 'font-family', '' );
											this.set( '', 'font_class' ).set( '', 'font_family' );
										},
										font_size: function ( _size, rClass ) {
											$target.css( 'font-size', _size + "px" ).removeClass( 'rft rfs' ).addClass( rClass );
											this.set( _size + 'px', 'font_size' );
											this.set( rClass, 'custom_class' );
										},
										title: function ( title ) {
											title = jQuery.trim( title );
											$element.find( '.tve_menu_title' ).text( title );
											this.set( title, 'title' );
										},
										primary: function ( is_primary ) {
											this.set( is_primary, 'primary', true );
										},
										set: function ( value, what, fetch ) {
											config.update( value, what );
											if ( typeof fetch !== 'undefined' ) {
												this.fetch();
											}
											return this;
										},
										config: function () {
											return config.get();
										}
									};
								}
							} );
						},
						"util": {
							"content.js": function (exports, module, require) {
								/**
								 * Created on 2/18/2017.
								 */
								(function ( $ ) {
									module.exports = {

										TCB_CLS_PAT: ['thrv_', 'tve-', 'tve_', 'tcb_', 'tcb-', 'thrv-', 'img_style_', 'mce-', 'fr-'],

										/**
										 * Cleanup content in preparation for save
										 * @param options
										 * @param $root
										 */
										get_clean_content: function ( options, $root ) {
											if ( typeof options === 'undefined' ) {
												options = {};
											}
											$root = $root || TVE.Editor_Page.editor;
											var $filter = $( '#pre-save-filter' );
											if ( ! $filter.length ) {
												$filter = $( '<div style="display:none" id="pre-save-filter"></div>' ).appendTo( 'body' );
											}
											$filter.empty();

											var $target = $root.children( '.tve_content_save' ).length ? $root.children( '.tve_content_save' ) : $root;
											$filter.html( $target.html() );
											if ( ! options.keep_wp_shortcodes ) {
												$filter.find( '.tve_shortcode_rendered' ).remove();
											}

											$filter.find( '.ui-resizable-handle, .ui-resize-left, .ui-resize-right, .thrive-shortcode-html,grammarly-btn,' +
											              '.tve_custom_html_placeholder,.tve_dropzone,.rangySelectionBoundary, .tve_shortcode_overlay,' +
											              '.tve_shortcode_rendered script, .tcb-remove-on-save, .tve_post_grid_wrapper,.tve_widget_container,' +
											              '.gr-textarea-btn_status,.gr-textarea-btn, .tve-remove-auxiliary-content' ).remove()
												.end().find( '.canvas-mode, .tve-element-overlay, .edit_mode, .tve_merge_cells, .tve_merge_selected, .tve_active_hyperlink, .active_highlight, .active_delete, .active_duplicate' ).removeClass( 'edit_mode tve_merge_cells tve_merge_selected, tve_active_hyperlink active_highlight active_delete active_duplicatecanvas-mode tve-element-overlay' )
												.end().find( '.tve_faqC' ).hide()
												.end().find( '.tve_oFaq' ).removeClass( 'tve_oFaq' )
												.end().find( '.ui-resizable,.init_done,.ui-sortable,.ui-sortable-handle,.tve-draggable,.tve-droppable' ).removeClass( 'ui-resizable init_done ui-sortable ui-sortable-handle tve-draggable tve_grabbed tve-droppable' )
												.end().find( '[contenteditable]' ).removeAttr( 'contenteditable' )
												.end().find( '[draggable]' ).removeAttr( 'draggable' )
												.end().find( '[data-gramm]' ).removeAttr( 'data-gramm data-gramm_id data-gramm_editor' ).filter( ':empty' ).remove().end()
												.end().find( '.tve-state-hover,.tve-state-active' ).removeClass( 'tve-state-hover' )
												.end().find( 'p' ).each( function () {
												//remove some attributes to let WP correctly do shortcode_unautop()
												if ( typeof this.className !== 'undefined' && this.className.toString().length === 0 ) {
													this.removeAttribute( 'class' );
												}
											} );
											$filter.find( '.tve-froala' ).each( function () {
												var $ed = $( this ),
													$element = $ed.find( '.fr-element' ).last();
												if ( $element.length ) {
													$ed.html( $element.html() ).removeClass( function ( i, className ) {
														return (className.match( /(^|\s)(fr-|tve-froal)\S+/g ) || []).join( ' ' );
													} );
												}
											} );
											$filter.find( '.tve_more_tag' ).replaceWith( '<!--tvemorestart--><p class="tve_more_tag"><span class="tve_no_edit">More...</span></p><!--tvemoreend-->' );

											var html = $filter.html();
											$filter.html( '' );

											return html.split( "\n" ).map( $.trim ).filter( function ( line ) {
												return line !== '';
											} ).join( "\n" );
										},
										/**
										 * function to extract the custom inline rules from the document
										 * @returns {string} - string of css to be saved in db
										 */
										get_stylesheet_rules: function () {
											var myrules = TVE.stylesheet.cssRules ? TVE.stylesheet.cssRules : TVE.stylesheet.rules;
											var inline_rules = '',
												selectors = [],
												selector_text,
												allow_save = ['tve_selected_typist'],
												media_subset = '',
												imported_fonts = [];

											function is_whitelist( selector ) {
												for ( var i = 0, item; item = allow_save[i ++]; ) {
													if ( selector.indexOf( item ) > - 1 ) {
														return true;
													}
												}
												return false;
											}

											function process_rule( rule, media ) {
												media = media || '';
												var text = '', css_text;
												/* :hover selector will not work from JS */
												selector_text = rule.selectorText.replace( /(:hover|:active)/g, '' );
												if ( selectors.indexOf( media + rule.selectorText ) !== - 1 ) {
													return '';
												}

												if ( is_whitelist( selector_text ) || jQuery( selector_text ).length ) { // do not save extra CSS in the head
													css_text = jQuery.trim( rule.cssText.replace( rule.selectorText, '' ).replace( /\{(\s*)\}/g, '' ) );
													if ( ! css_text ) {
														return '';
													}
													text += rule.cssText;
													selectors.push( media + rule.selectorText );
												}

												return text;
											}

											for ( var i = 0, _rule; _rule = myrules[i ++]; ) {

												if ( _rule.type === CSSRule.IMPORT_RULE ) {
													/* Save only fonts that are used  */
													var font = TVE.FontManager.read_font_name( _rule.cssText );
													if ( TVE.FontManager.is_font_used( font ) && typeof imported_fonts[font] === 'undefined' ) {
														imported_fonts[font] = 1;
														inline_rules += _rule.cssText;
													}
													continue;
												}

												if ( _rule.type === CSSRule.MEDIA_RULE ) {
													// recurse into the contained rules
													media_subset = '';
													for ( var j = 0, _sub_rule; _sub_rule = _rule.cssRules[j ++]; ) {
														media_subset += process_rule( _sub_rule, _rule.media.item( 0 ) );
													}
													if ( media_subset ) {
														inline_rules += '@media ' + _rule.media.item( 0 ) + '{' + media_subset + '}';
													}
													continue;
												}
												inline_rules += process_rule( _rule );
											}
											return inline_rules;
										},
										/**
										 * Function that prepares the element to be saved as a user template
										 * Parses the element and strips specific classes out of it.
										 *
										 * @param $element
										 */
										prepare_content_template: function ( $element ) {
											var _remove_template_class = 'edit_mode mce-edit-focus active_delete active_duplicate';

											$element.add( $element.find( '.ui-resizable' ) ).removeClass( 'ui-resizable' );
											$element.find( '.ui-resizable-handle' ).remove();
											TVE.froala.disable( $element );
											TVE.froala.disable( $element.find( TVE.TEXT_ALL ) );

											return jQuery( '<div></div>' ).append( $element.removeClass( _remove_template_class ) ).html();
										},
										/**
										 * Parses an element class list and strips it of certain classes
										 * This function is used to fetch a clean class string for the Style and Template TCB Component
										 *
										 * @param {string} element_classes
										 * @returns {string}
										 */
										parse_element_classes: function ( element_classes ) {
											//TODO: custom_font_classes also exclude this from the list

											var pat = new RegExp( this.TCB_CLS_PAT.join( '([^ ]*)|' ) + '([^ ]*)|' + TVE.thrv_custom_classes.join( '|' ), 'g' );

											return element_classes ? $.trim( element_classes.replace( pat, '' ).replace( '/\S+/g', ' ' ) ) : '';
										},
										get_shotcode_tinymce_content: function () {
											if ( typeof tinymce === 'undefined' || ! tinymce || ! tinymce.activeEditor || tinymce.activeEditor.isHidden() ) {
												// no active editor, fallback to the textarea
												return jQuery( '#tve_tinymce_shortcode' ).val();
											}
											return tinymce.activeEditor.getContent();
										},
										set_shotcode_tinymce_content: function ( editor_content ) {
											if ( typeof tinymce === 'undefined' || ! tinymce || ! tinymce.activeEditor || tinymce.activeEditor.isHidden() ) {
												jQuery( '#tve_tinymce_shortcode' ).val( editor_content );
											} else {
												tinymce.activeEditor.setContent( editor_content );
											}
										},
										/**
										 * convert all script tags inside html to shortcodes that will be converted on display
										 * @param string html
										 */
										convert_script_tags: function ( html ) {
											html = html.replace( '<\\/script', '<\\\\/script' );
											var $html = jQuery( '<div class="tve_escaped_js">' + html + '</div>' );

											if ( $html.find( 'script' ).length === 0 && $html.find( "noscript" ) === 0 ) {
												return $html.html();
											}
											$html.find( 'script' ).each( function () {
												var $script = jQuery( this ),
													_text = '[tcb-script';
												var $replacement = jQuery( '<code class="tve_js_placeholder"></code>' );
												jQuery.each( this.attributes, function () {
													_text += ' ' + this.name + '="' + this.value + '"';
												} );
												_text += ']' + $script.text() + '[/tcb-script]';

												$replacement.text( _text );
												$script.replaceWith( $replacement );
											} );
											$html.find( 'noscript' ).each( function () {
												var $script = jQuery( this ),
													_text = '[tcb-noscript';
												var $replacement = jQuery( '<code class="tve_js_placeholder tve_noscript"></code>' );
												jQuery.each( this.attributes, function () {
													_text += ' ' + this.name + '="' + this.value + '"';
												} );
												_text += ']' + $script.text() + '[/tcb-noscript]';
												$replacement.html( _text );
												$script.replaceWith( $replacement );
											} );
											return $html.html();
										},
										/**
										 * convert all <code>[tcb-script] tags back to <script>
										 * @param html
										 */
										revert_script_tags: function ( html ) {
											if ( ! jQuery.trim( html ) ) {
												return '';
											}
											var $html = jQuery( '<div class="tve_escaped_js">' + html + '</div>' );

											// remove all custom html placeholders
											$html.find( '.tve_custom_html_placeholder,.tve_click' ).remove();
											$html.find( '.tve_shortcode_overlay' ).remove();
											if ( $html.find( 'code.tve_js_placeholder' ).length === 0 ) {
												return jQuery.trim( $html.html() );
											}

											$html.find( 'code.tve_js_placeholder' ).each( function () {
												var $script = jQuery( this ),
													shortcodeRegexp = new RegExp( '^\\[tcb-script([^\\]]*?)\\]([\\s\\S]*?)\\[\/tcb-script\\]$', 'g' ), _text; // jeez

												_text = $script[$script.hasClass( 'tve_noscript' ) ? 'html' : 'text']().replace( shortcodeRegexp, '<script$1>$2</script>' );

												var shortcodeNoscriptRegex = new RegExp( '^\\[tcb-noscript([^\\]]*?)\\]([\\s\\S]*?)\\[\/tcb-noscript\\]$', 'g' ); // jeez
												_text = _text.replace( shortcodeNoscriptRegex, '<noscript$1>$2</noscript>' );
												if ( $script.hasClass( 'tve_noscript' ) ) { // <noscript> tag does not allow innerHTML manipulation
													_text = jQuery( '<textarea>' ).html( _text ).text();
												}
												var $replacement = jQuery( _text );
												$replacement.removeAttr( 'class className' );
												$script.replaceWith( $replacement );
											} );
											return jQuery.trim( $html.html() );
										},
										/**
										 * Prepare the JSON data to be sent to the server on save
										 */
										prepare_save_data: function ( update, extra_data ) {
											var tve_content = this.get_clean_content( {}, this.editor ),
												custom_css_rules = this.get_stylesheet_rules(),
												data = {
													tve_content: tve_content,
													post_id: TVE.CONST.post_id,
													update: update,
													inline_rules: custom_css_rules,
													custom_colours: TVE.CONST.colors.favorites || [],
													tve_custom_css: TVE.Editor_Page.get_custom_css(),
													tve_landing_page: TVE.CONST.landing_page ? TVE.CONST.landing_page : '',
													custom_font_classes: [],
													tve_globals: {},
													tve_global_scripts: TVE.CONST.tve_global_scripts ? TVE.CONST.tve_global_scripts : {},
													has_icons: 0,
													page_events: TVE.CONST.page_events
												};

											data = TVE.apply_filters( 'tcb_save_post_data_before', data );

											if ( TVE.CONST.custom_post_data ) {
												$.each( TVE.CONST.custom_post_data, function ( _key, _value ) {
													data[_key] = _value;
												} );
											}

											TVE.CONST.tve_globals.js_sdk = [];
											TVE.Editor_Page.editor.find( '.thrv_social' ).each( function () {
												TVE.CONST.tve_globals.js_sdk = TVE.CONST.tve_globals.js_sdk.concat( $( this ).tve_social().getRequiredSDKs() );
											} );

											if ( TVE.CONST.social_fb_app_id ) {
												data.social_fb_app_id = TVE.CONST.social_fb_app_id;
											}

											/* Add facebook sdk for comments element */
											if ( TVE.Editor_Page.editor.find( '.tve-fb-comments' ).length > 0 ) {
												if ( TVE.CONST.tve_globals.js_sdk.indexOf( 'fb' ) === - 1 ) {
													TVE.CONST.tve_globals.js_sdk.push( 'fb' );
												}
											}

											/* include the tve_globals meta stuff */
											$.each( TVE.CONST.tve_globals, function ( k, v ) {
												if ( k ) {
													data.tve_globals[k] = v;
												}
											} );

											/* also save each of the custom fonts that are being used */
											if ( custom_font_classes ) {
												$.each( custom_font_classes.split( ' ' ), function ( i, v ) {
													if ( TVE.Editor_Page.editor.find( '.' + v ).length || (TVE.landing_fonts && TVE.landing_fonts.fontUsed( v )) ) {
														data.custom_font_classes.push( v );
													}
												} );
											}
											if ( data.tve_globals.extra_fonts ) {
												$.each( data.tve_globals.extra_fonts, function ( i, font ) {
													if ( TVE.Editor_Page.editor.find( '.' + font.font_class ).length || (TVE.landing_fonts && TVE.landing_fonts.fontUsed( font.font_class )) ) {
														font.ignore = 0;
													} else {
														font.ignore = 1;
													}
												} );
											}

											if ( typeof extra_data !== 'undefined' ) {
												$.each( extra_data, function ( k, v ) {
													data[k] = v;
												} );
											}
											var $all_icons = jQuery( '.tve_sc_icon:not(.tve_sc_text)' ),
												$custom_icons = jQuery();
											data.tve_globals.used_icon_packs = [];
											if ( $all_icons.length ) {
												/* check for custom icon_packs */
												var actually_used = [];
												if ( TVE.CONST.tve_globals.extra_icons ) {
													for ( var i = 0, icon_pack; icon_pack = TVE.CONST.tve_globals.extra_icons[i ++]; ) {
														if ( ! icon_pack.icons || ! icon_pack.icons.length ) {
															continue;
														}
														var $current_icons = $all_icons.filter( '.' + icon_pack.icons.join( ',.' ) );
														if ( $current_icons.length ) {
															data.tve_globals.used_icon_packs.push( icon_pack['font-family'] );
														}
														$custom_icons = $custom_icons.add( $current_icons );
														$current_icons.each( function () {
															actually_used.push( this.dataset.tveIcon );
														} );
														TVE.CONST.tve_globals.extra_icons[i - 1].icons = actually_used;
													}
												}
												/* has regular (main) icon pack only if not all icons from the page are custom icons */
												data.has_icons = $all_icons.length != $custom_icons.length ? 1 : 0;
											}

											var $fb_comments = $( '.tve-fb-comments:visible' );
											if ( $fb_comments.length > 0 ) {
												var $fb_admins = $fb_comments.attr( 'data-fb-moderator-ids' );
												if ( typeof $fb_admins !== 'undefined' && $fb_admins != '' ) {
													data.tve_globals.fb_comment_admins = JSON.stringify( $fb_admins.split( ';' ) );
												}
											}

											if ( $( '.tve_post_grid_masonry' ).length ) {
												data.tve_has_masonry = 1;
											}

											if ( $( '.tve_typefocus' ).length ) {
												data.tve_has_typefocus = 1;
											}

											if ( $( '.tve_wistia_popover:visible' ).length || $( '.tve_ea_thrive_wistia' ).length ) {
												data.tve_has_wistia_popover = 1;
											}

											data = TVE.apply_filters( 'tcb_save_post_data_after', data );

											return data;
										},
										/**
										 * Adds the required CSS to the current page when inserting previously saved templates.
										 * It will replace the [data-tve-custom-colour] with new unique values for each of the elements found in the
										 * $html content
										 * @param {string} css_text
										 * @param {jQuery} $html_content
										 * @param {object} [media_rules] CSS media query rules for the element
										 */
										process_saved_template: function ( css_text, $html_content, media_rules ) {
											$html_content.find( '.edit_mode' ).removeClass( 'edit_mode' );
											if ( $html_content.find( '.tve_sc_icon' ).length && ! jQuery( '#thrive_icon_pack' ).length && TVE.CONST.icon_pack_css ) {
												/* make sure we have the icomoon css file loaded */
												jQuery( '<link id="thrive_icon_pack" rel="stylesheet" type="text/css" href="' + TVE.CONST.icon_pack_css + '">' ).appendTo( 'head' );
											}
											if ( ! jQuery.trim( css_text ) && ! media_rules ) {
												return $html_content;
											}

											function compat_css_id( $elem ) {
												var rand_id = Math.floor( (Math.random() * 100000000) + 1 );
												$elem.attr( 'data-tve-custom-colour', rand_id );
												return rand_id;
											}

											var $container = $html_content.wrapAll( '<div></div>' ).parent();
											css_text = jQuery.trim( css_text );

											if ( css_text ) {
												var css_code = css_text.match( /[^{}]+(?=\})/g ),
													css_selectors = css_text.match( /\[(.*?)\]([^\{]*)/g ),
													existing_map = {},
													max = css_selectors ? css_selectors.length : 0;

												for ( var i = 0; i < max; i ++ ) {
													var _attrCode = css_selectors[i].match( /\[data-tve-custom-colour=([^0-9]{1,1})(\d+)('|")\]/ );
													if ( ! _attrCode || _attrCode.length < 3 ) {
														continue;
													}
													var new_identifier = typeof existing_map['code' + _attrCode[2]] !== 'undefined' ?
															existing_map['code' + _attrCode[2]] :
															compat_css_id( $container.find( '[data-tve-custom-colour="' + _attrCode[2] + '"]' ) ),
														new_selector = css_selectors[i].replace( _attrCode[2], new_identifier );

													TVE.compat.insert_css_rule( new_selector, css_code[i], 0 );
													existing_map['code' + _attrCode[2]] = new_identifier;
												}
											}

											/**
											 * CSS @media queries that need to be added to the page - replace every ID with new ones
											 */
											if ( media_rules ) {
												var id_map = {};
												jQuery.each( media_rules, function ( media, css_text ) {
													var rules = css_text.match( /[^{}]+(?=\})/g ),
														selectors = css_text.match( /\[(.*?)\]([^\{]*)/g );
													if ( ! rules || ! selectors || rules.length !== selectors.length ) {
														return true;
													}
													var media_rule = TVE.CSS_Rule_Cache.media_rule( media ),
														old_id;
													selectors = selectors.map( jQuery.trim );
													rules = rules.map( jQuery.trim );
													for ( var i = 0, current_selector; current_selector = selectors[i]; i ++ ) {
														if ( jQuery.trim( rules[i] ) && current_selector.match( /tve-u-(.[^"]*)/ ) ) {
															old_id = 'tve-u-' + RegExp.$1;
															id_map[old_id] = id_map[old_id] || TVE.CSS_Rule_Cache.generate_id();
															current_selector = current_selector.replace( new RegExp( '(' + old_id + ')', 'g' ), id_map[old_id] );
															media_rule.insertRule( jQuery.trim( current_selector ) + '{' + rules[i] + '}', media_rule.cssRules.length );
														}
													}
												} );
												jQuery.each( id_map, function ( old_selector, new_id ) {
													$container.find( '[data-css="' + old_selector + '"]' ).attr( 'data-css', new_id );
												} );
											}
											if ( $html_content.hasClass( 'thrv_widget_menu' ) ) {
												/**
												 * we need to update the custom colors in the JSON configuration object
												 */
												var _config = TVE.Editor_Page.thriveShrtcodeConfig( $html_content.find( '.thrive-shortcode-config' ), 'widget_menu' ),
													_data = _config.get();
												jQuery.each( [
													'ul_attr',
													'top_link_attr',
													'link_attr',
													'trigger_attr'
												], function ( i, _attr ) {
													if ( _data[_attr] && existing_map['code' + _data[_attr]] ) {
														_data[_attr] = existing_map['code' + _data[_attr]];
													}
												} );
												_config.save( _data );
											}

											TVE.compat.texts( $container );

											return $container.html();
										}
									};
								})( jQuery );
							},
							"froala.js": function (exports, module, require) {
								/**
								 * Initialize and configure the froala inline editor
								 *
								 * @var {TVE} TVE
								 */
								(function ( $ ) {
									TVE.TEXT_INLINE = '.tve_fg h1, .tve_fg h3, .tve_ca h3, .tve_ca h1, .tve_grt h3, .tve_ca .tve_btnLink span, .tve_ts span, .tve_ct_title,' +
									                  '.thrv_tw_quote p, .thrv_widget_menu .tve_menu_title, .wp-caption-text, .tve_btn_txt, .tve_btn_sec_txt, ' +
									                  '.tve_fg > .tve_line > h3, .thrv_bullets_shortcode > ul, .tve_scT > ul > li > span, .tve_faqB h4, .thrv-inline-text,' +
									                  '.tve_submit_container button span, .thrv_tw_qs_button_text';

									/**
									 * Special Selectors that includes all the inline toolbar elements + extra ones
									 */
									TVE.TEXT_WITH_LINK = '.tcb-styled-list-icon-text';

									TVE.TEXT_HEADINGS = '.thrv_heading';

									TVE.TEXT_BLOCK = '.thrv_text_element';

									var selectors = require( './selectors' );

									var BLOCK_ELEMENTS = 'h1,h2,h3,h4,h5,h6,p,address,blockquote,li';

									var API = {},
										_all = TVE.TEXT_ALL = TVE.TEXT_INLINE + ',' + TVE.TEXT_HEADINGS + ',' + TVE.TEXT_BLOCK,
										toolbars = {
											'default': ['bold', 'italic', 'underline', 'strikeThrough', 'formatUL', 'formatOL', 'align', 'paragraphFormat', 'tcbLink'],
											'inline': ['bold', 'italic', 'underline', 'strikeThrough'],
											'with_link': ['bold', 'italic', 'underline', 'strikeThrough', 'tcbLink'],
											'headings': ['bold', 'italic', 'underline', 'strikeThrough', 'align', 'paragraphFormat']
										},
										events = {};

									/**
									 * Froala focus event
									 *
									 * @param e
									 * @param editor
									 */
									events.focus = function ( e, editor ) {
										API.editor = editor;
										var $editable = editor.$oel.is( TVE.TEXT_BLOCK + ',.thrv-inline-text,' + TVE.TEXT_HEADINGS ) ? editor.$oel : editor.$oel.closest( selectors.editable );
										/**
										 * focus closest element
										 */
										setTimeout( function () {
											/**
											 * Leave it some time to breathe
											 */
											if ( ! $editable.hasClass( 'edit_mode' ) ) {
												TVE.Editor_Page.focus_element( editor.$oel );
											}
										} );

									};

									/**
									 * Called each time the toolbar is shown. Good place to read selection, css values, update side menu
									 *
									 * @param e
									 * @param editor
									 */
									events.toolbar_show = function ( e, editor ) {
										TVE.main.update_components( ['text', 'click-tweet'] );
										/* also show the main editing icons - clone, drag, delete */
										TVE.Editor_Page.$body.removeClass( 'tcb-distraction-free' );
									};

									events.toolbar_hide = function ( e, editor ) {
										if ( editor.core.hasFocus() ) {
											TVE.Editor_Page.$body.addClass( 'tcb-distraction-free' );
										}
									};

									events.blur = function () {
										TVE.Editor_Page.$body.removeClass( 'tcb-distraction-free' );
									};

									/**
									 * Triggered when an shapshot is saved
									 *
									 * @param e
									 * @param editor
									 */
									events.undo_save_step = function ( e, editor ) {
										TVE.UndoManager.add( {
											undo: function () {
												if ( editor && editor.undo_index > 1 ) {
													editor.events.focus();
													return editor.undo.run();
												}
												/* Execute the next undo operation if the editor is out of undo's */
												return '_EXECUTE_NEXT_';
											},
											redo: function () {
												if ( editor && editor.undo_index < editor.undo_stack.length ) {
													editor.events.focus();
													return editor.undo.redo();
												}
												/* Execute the next redo operation if the editor is out of undo's */
												return '_EXECUTE_NEXT_';
											}
										} );

									};

									/**
									 * Trigger when a key is down
									 *
									 * @param e
									 * @param editor
									 * @param keypressEvent
									 */
									events.keydown = function ( e, editor, keypressEvent ) {
										if ( keypressEvent.keyCode === 13 ) {
											if ( keypressEvent.ctrlKey ) {
												TVE.main.trigger( 'ctrl-enter-pressed', keypressEvent );
											} else {
												TVE.main.trigger( 'enter-pressed', keypressEvent );
											}
										}
									};

									function event( cb ) {
										return $.proxy( events[cb], events );
									}

									/**
									 * Should be called each time the page is loaded / refreshed (e.g. Thrive leads change template)
									 */
									API.init = function () {
										var editorCount = 1;

										TVE.Editor_Page.editor.off( 'mouseenter.froala-editor' ).on( 'mouseenter.froala-editor', _all, function ( e ) {
											var $elem = $( e.currentTarget );

											/**
											 * do not allow inline editing when hover state is selected
											 */
											if ( ! TVE.state_manager.is_default() ) {
												if ( $elem.data( 'froala.editor' ) ) {
													$elem.froalaEditor( 'destroy' );
												}
												return;
											}

											if ( $elem.data( 'froala.editor' ) ) {
												return $elem;
											}

											var inline = $elem.is( TVE.TEXT_INLINE ),
												heading = $elem.is( TVE.TEXT_HEADINGS ),
												with_link = $elem.is( TVE.TEXT_WITH_LINK ),
												toolbarButtons = with_link ? toolbars.with_link : inline ? toolbars.inline :
													heading ? toolbars.headings : toolbars.default,
												options = {
													enter: inline || heading ? null : $.FroalaEditor.ENTER_P,
													multiLine: ! inline && ! heading,
													keepFormatOnDelete: true,
													editorClass: 'tve-froala-' + (editorCount ++),
													placeholderText: '',
													initOnClick: true,
													toolbarInline: true,
													typingTimer: 800,
													htmlUntouched: true,
													htmlAllowedEmptyTags: ['i'],
													toolbarButtons: toolbarButtons,
													toolbarButtonsMD: toolbarButtons,
													toolbarButtonsSM: toolbarButtons,
													toolbarButtonsXS: toolbarButtons,
													toolbarVisibleWithoutSelection: true,
													paragraphFormat: {
														N: 'Paragraph',
														H1: 'Heading 1',
														H2: 'Heading 2',
														H3: 'Heading 3',
														H4: 'Heading 4',
														H5: 'Heading 5',
														H6: 'Heading 6'
													}
												};
											if ( heading ) {
												delete options.paragraphFormat.N;
												options.htmlAllowedEmptyTags = TVE.ELEM.headings.split( ',' ).concat( [
													'textarea',
													'a',
													'iframe',
													'object',
													'video',
													'style',
													'script',
													'.fa'
												] );
											}

											e.currentTarget.classList.add( 'tve-froala' );

											$elem.froalaEditor( options )
											     .on( 'froalaEditor.toolbar.show', event( 'toolbar_show' ) )
											     .on( 'froalaEditor.toolbar.hide', event( 'toolbar_hide' ) )
											     .on( 'froalaEditor.focus', event( 'focus' ) )
											     .on( 'froalaEditor.blur', event( 'blur' ) )
											     .on( 'froalaEditor.undo.saveStep', event( 'undo_save_step' ) )
											     .on( 'froalaEditor.keydown', event( 'keydown' ) );

											if ( $elem.is( TVE.TEXT_BLOCK ) || $elem.is( TVE.TEXT_HEADINGS ) ) {
												$elem.off( 'click.tcb' ).on( 'click.tcb', function ( e ) {
													e.stopPropagation();
												} );
											} else if ( $elem.is( TVE.TEXT_INLINE ) ) {
												/*Disable Drop Event For Inline Text Element*/
												$elem.on( 'froalaEditor.initialized', function ( e, editor ) {
													editor.events.on( 'drop', function () {
														return false;
													}, true );
												} );
											}
										} );
									};

									/**
									 * Disable the editor on an element ( or on a set of elements )
									 *
									 * @param $element
									 */
									API.disable = function ( $element ) {
										if ( $element.length > 1 ) {
											$element.each( function () {
												var $e = $( this );
												if ( $e.data( 'froala.editor' ) ) {
													$e.froalaEditor( 'destroy' );
												}
											} );
											return;
										}
										if ( $element.data( 'froala.editor' ) ) {
											$element.froalaEditor( 'destroy' );
										}
									};

									/**
									 * Calls a method on the current editor's instance
									 */
									API.exec = function () {
										if ( ! this.editor ) {
											return;
										}
										var parts = arguments[0].split( '.' ),
											fn = this.editor,
											obj = fn;

										while ( parts.length && fn[parts[0]] ) {
											fn = fn[parts.shift()];
											if ( parts.length > 1 ) {
												obj = fn;
											}
										}

										this.editor.events.focus();
										fn.apply( obj, Array.prototype.slice.call( arguments, 1 ) );
									};

									/**
									 * Get closest block element
									 *
									 * @return {jQuery} element
									 */
									API.get_block_element = function () {
										return $( this.editor.selection.element() ).closest( BLOCK_ELEMENTS );
									};

									/**
									 * Checks if the current active editor has a selection - if it has, return the element where the selection starts
									 *
									 * @returns {boolean}
									 */
									API.has_selection = function () {
										if ( ! this.editor || ! this.editor.selection.text() ) {
											return false;
										}

										return this.editor.selection.element();
									};

									/**
									 * CSS reader - reads in style for the current element / selection
									 */
									API.get_css = function ( props ) {
										var node = this.editor.selection.element();
										if ( typeof props === 'string' ) {
											return node.style[props] || TVE.getComputedStyle( node, props, true )
										}

										/* props should be an array at this point */
										var style = {};
										_.each( props, function ( prop ) {
											style[prop] = node.style[prop] || TVE.getComputedStyle( node, prop );
										} );

										return style;
									};

									/**
									 * Wraps the selection into a <tag_name> element
									 *
									 * @param {String} [tag_name] Node name. Defaults to span
									 * @param {Object} [attr] Node attributes. Defaults to an empty object
									 *
									 * @returns {Boolean|jQuery} false on failure, jQuery wrapper over the selection node
									 */
									API.wrap_selection = function ( tag_name, attr ) {
										if ( ! this.editor ) {
											return false;
										}
										attr = attr || {};
										if ( ! attr.class ) {
											/* generate unique css classes so that froala does not expand the selections */
											attr.class = TVE.CSS_Rule_Cache.generate_id();
										}

										this.editor.format.apply( tag_name || 'span', attr );

										return $( this.editor.selection.element() );
									};

									module.exports = API;

								})( jQuery );
							},
							"general.js": function (exports, module, require) {
								(function ( $ ) {
									/**
									 * Extends the TVE object with some general constants and functionality
									 * @type {{}}
									 */
									var extension = {

										ELEM: {
											headings: 'h1,h2,h3,h4,h5,h6',
											text: 'p:not(.tve_more_tag,.thrv-inline-text p),h1,h2,h3,h4,h5,h6,ol,ul:not(.tcb-styled-list),blockquote,address,pre'
										},

										FILTER_TYPES: {
											grayscale: 'grayscale',
											blur: 'blur',
											brightness: 'grayscale',
											contrast: 'grayscale',
											invert: 'grayscale',
											saturate: 'grayscale',
											sepia: 'grayscale'
										},

										/**
										 * default state
										 * @type {string}
										 */
										STATE_DEFAULT: 'default',
										/**
										 * A non-tinymce element is in edit mode
										 * @type {string}
										 */
										STATE_EDIT: 'edit',

										/**
										 * a text element is edited inline
										 *
										 * @type {string}
										 */
										STATE_TINYMCE: 'tinymce',

										/**
										 * user currently dragging an element
										 * @type {string}
										 */
										STATE_DRAG: 'drag',

										/**
										 * Getter / Setter for the current state
										 *
										 * Switch the editor state
										 *
										 * @param {String} [state]
										 * @returns {TVE|string}
										 */
										state: function ( state ) {
											if ( typeof state === 'undefined' ) {
												return this.CUR_STATE;
											}

											if ( state !== this.CUR_STATE ) {
												/**
												 * TODO: not sure if this is needed.
												 */
												TVE.main.trigger( 'exitstate_' + this.CUR_STATE, state );
												TVE.main.trigger( 'enterstate_' + state, this.CUR_STATE );

												$( 'body' ).toggleClass( 'tcb-edit-mode', state === this.STATE_EDIT );

												this.CUR_STATE = state;
											}

											return this;
										},

										/**
										 * Whether or not the user should be allowed to drag elements
										 *
										 * @returns {boolean}
										 */
										allow_drag: function () {
											/* we leave this true and we wait to see if we have any issues */
											return true;
											this.CUR_STATE === this.STATE_DEFAULT;
										},

										/**
										 * Whether or not the user can open a tinymce text element
										 *
										 * @returns {boolean}
										 */
										allow_tinymce: function () {
											return this.CUR_STATE === this.STATE_DEFAULT || this.CUR_STATE === this.STATE_TINYMCE;
										},

										/**
										 * Whether or not the user can start editing an element (non-tinymce)
										 */
										allow_edit: function () {
											return this.CUR_STATE === this.STATE_DEFAULT || this.CUR_STATE === this.STATE_EDIT || this.CUR_STATE === this.STATE_TINYMCE;
										}
									};

									extension.CUR_STATE = extension.STATE_DEFAULT;


									/**
									 * ################################### HEAD CSS FUNCTIONALITY ###################################
									 */

									/**
									 * Builds a CSS selector text based on css_id and suffix. Suffix can be an array
									 *
									 * @param {String} css_id
									 * @param {Array|String} suffix
									 * @param {String} prefix
									 */
									function build_selector( css_id, suffix, prefix ) {
										var base = prefix + '[data-css="' + css_id + '"]',
											rule = '';

										if ( ! suffix ) {
											return base;
										}

										if ( ! $.isArray( suffix ) ) {
											suffix = [suffix];
										}
										$.each( suffix, function ( index ) {
											rule += ( index ? ', ' : '' ) + base + this;
										} );

										return rule;
									}

									$.fn.extend( {
										/**
										 * Read or write from head css
										 *
										 * @param rules if rules is a string or an array, act as a getter for a rule ( same as jQuery.css() )
										 * @param media
										 * @param suffix
										 * @param forceCSS
										 * @param {string} prefix prefix for the rule
										 * @returns {*}
										 */
										head_css: function ( rules, media, suffix, forceCSS, prefix ) {
											if ( typeof suffix === 'undefined' ) {
												suffix = '';
											}
											if ( typeof prefix === 'undefined' ) {
												prefix = '';
											}

											var is_array = $.isArray( rules ),
												$element = this,
												is_getter = ( typeof rules === 'string' || is_array );

											if ( is_getter ) {

												if ( ! this.length ) {
													return '';
												}

												function element_css( $element, prop ) {
													if ( ! suffix ) {
														return $element.css( prop );
													}

													return $element.find( $.isArray( suffix ) ? suffix[0] : suffix ).css( prop );
												}

												/**
												 *
												 * @param {CSSStyleDeclaration} style
												 * @param {Array|String} rules
												 * @param {Boolean} is_array
												 */
												function read_from_style( style, rules, is_array ) {
													if ( is_array ) {
														var obj = {};
														rules.forEach( function ( prop ) {
															obj[prop] = read_from_style( style, prop, false );
														} );

														return obj;
													}
													/**
													 * string - read in one value
													 */
													var value = style.getPropertyValue( rules );
													if ( ! value && forceCSS ) {
														value = element_css( $element, rules );
													}
													return value;
												}

												/**
												 * return the property value ( or values )
												 */
												var elem = this[0],
													css_id = elem.getAttribute( 'data-css' ),
													css_value = false,
													media_rule,
													style;

												if ( css_id ) {
													/**
													 * rule found, read values from there
													 */
													media = media || TVE.main.media_query_tpl();
													media_rule = TVE.CSS_Rule_Cache.media_rule( media );
													if ( media_rule ) {
														style = media_rule.style_by_selector( build_selector( css_id, suffix, prefix ) );
														css_value = read_from_style( style, rules, is_array );
													}
												}
												if ( forceCSS && ! css_value ) {
													css_value = element_css( $element, rules );
												}

												/* one final check */
												if ( ! css_value ) {
													css_value = is_array ? {} : '';
												}

												return css_value;
											}

											return this.each( function () {
												var css_id = this.getAttribute( 'data-css' );

												if ( css_id ) {
													if ( TVE.Editor_Page.editor.find( '[data-css="' + css_id + '"]' ).length > 1 ) {
														/* the css id already exists => we generate a new one and we copy the old css */
														var new_css_id = TVE.CSS_Rule_Cache.generate_id();
														this.setAttribute( 'data-css', new_css_id );
														TVE.head_css_copy( css_id, new_css_id );
														css_id = new_css_id;
													}
												} else {
													css_id = TVE.CSS_Rule_Cache.uniq_id( this );
												}
												var selector = build_selector( css_id, suffix, prefix );
												TVE.head_css( selector, rules, media );
											} );
										},
										/**
										 * Collects all CSS style rules defined in the stylesheet for this element and all its descendants
										 *
										 * @return {object} map with each media query as key and relevant css rules as value
										 */
										collect_head_css: function () {
											var rule_hash = {},
												all_media = TVE.main.all_media(),
												ids = '';

											this.add( this.find( '[data-css^="tve-u-"]' ) ).each( function () {
												var css_id = this.getAttribute( 'data-css' );
												if ( ! css_id || css_id.indexOf( 'tve-u-' ) !== 0 ) {
													return true;
												}
												ids += (ids ? '|' : '') + css_id;
											} );

											ids = new RegExp( '(' + ids + ')', 'g' );

											for ( var i = 0, media; media = all_media[i ++]; ) {
												var media_rule = TVE.CSS_Rule_Cache.media_rule( media ); // grab the media rule
												rule_hash[media] = '';
												for ( var j = 0, _rule; _rule = media_rule.cssRules[j ++]; ) {
													if ( _rule.selectorText.match( ids ) ) {
														rule_hash[media] += _rule.cssText;
													}
												}
											}

											return rule_hash;
										},

										/**
										 * Collects the custom color defined on an element.
										 * This is an old way (used in TCB 1.5) of customizing elements
										 * This method is only for backwards compatibility reasons
										 *
										 * @param setIt
										 * @returns {*}
										 */
										color_selector: function ( setIt ) {
											if ( typeof setIt !== 'undefined' ) {
												if ( setIt ) {
													return this.attr( 'data-tve-custom-colour', setIt );
												}
												return this.removeAttr( 'data-tve-custom-colour' );
											}
											return this.attr( 'data-tve-custom-colour' );
										},

										/**
										 * clone custom CSS added in the header stylesheet.
										 * for each element, grab the existing CSS rules, regenerate the IDs and insert the css with the new ID selectors
										 *
										 * @returns {*}
										 */
										head_css_clone: function () {
											return this.each( function () {
												var css_id = this.getAttribute( 'data-css' );
												if ( ! css_id || css_id.indexOf( 'tve-u-' ) !== 0 ) {
													return true;
												}
												TVE.head_css_copy( '[data-css="' + css_id + '"]', '[data-css="' + TVE.CSS_Rule_Cache.uniq_id( this, true ) + '"]' );
											} );
										},

										/**
										 * Copy head CSS from the target to all of the elements
										 *
										 * @param target
										 * @returns {*}
										 */
										head_css_copy: function ( target ) {
											if ( target.jquery ) {
												target = target[0];
											}
											var css_id = target.getAttribute( 'data-css' );
											if ( ! css_id || css_id.indexOf( 'tve-u-' ) !== 0 ) {
												return this;
											}
											return this.each( function () {
												TVE.head_css_copy( '[data-css="' + css_id + '"]', '[data-css="' + TVE.CSS_Rule_Cache.uniq_id( this, true ) + '"]' );
											} );
										}
									} );

									/**
									 * adds a CSS declaration to the head <style> of the page
									 *
									 * @param {string} selector
									 * @param {Object} rules CSS rule map, property:value pairs. Supports !important in the css value
									 * @param {string|Array} [media] media query for the rules. Optional. if not set, it will take the current editing device
									 *
									 */
									extension.head_css = function ( selector, rules, media ) {

										media = media || TVE.main.media_query_tpl();
										media = media === '_ALL' ? TVE.main.all_media() : [media];

										if ( ! TVE.state_manager.is_default() ) {

											var state_preview_selector;

											if ( TVE.state_manager.is_child() ) {

												var parent = '[data-css="' + TVE.CSS_Rule_Cache.uniq_id( TVE.state_manager.get_parent() ) + '"]';

												state_preview_selector = '.' + TVE.state_manager.css_class() + parent + ' ' + selector;

												/* when not on default state and also in a child, in order to apply the current pseudo state (hover, pressed etc.) we need to do it on the parent element */
												selector = parent + TVE.state_manager.get_pseudo() + ' ' + selector;
											} else {
												/* when we're not in the default state, we apply the pseudo css for this */
												/* the :hover rule should always be applied on the element having .edit_mode class */
												var uniq_id = TVE.CSS_Rule_Cache.uniq_id( TVE.ActiveElement );

												state_preview_selector = '.' + TVE.state_manager.css_class() + '[data-css="' + uniq_id + '"]' + ' ' + selector.replace( '[data-css="' + uniq_id + '"]', '' );
												state_preview_selector = '#tve_editor ' + state_preview_selector.replace( '#tve_editor', '' ); // enforce this on the #tve_editor id
												state_preview_selector = jQuery.trim( state_preview_selector.replace( /([ ]{2})/g, ' ' ) );

												selector = '[data-css="' + uniq_id + '"]' + TVE.state_manager.get_pseudo() + ' ' + selector.replace( '[data-css="' + uniq_id + '"]', '' );
												selector = '#tve_editor ' + selector.replace( '#tve_editor', '' ); // enforce this on the #tve_editor id
												selector = jQuery.trim( selector.replace( /([ ]{2})/g, ' ' ) );
											}

											/* when not on default state, we add preview css for this  */
											TVE.write_css( state_preview_selector, rules, media );
										}

										TVE.add_undo_step( selector, rules, media );

										TVE.write_css( selector, rules, media );
									};

									/**
									 * Add undo and redo for the manger
									 *
									 * @param {string} selector
									 * @param {Object} rules CSS rule map, property:value pairs. Supports !important in the css value
									 * @param {string|Array} [media] media query for the rules. Optional. if not set, it will take the current editing device
									 */
									extension.add_undo_step = function ( selector, rules, media ) {

										if ( ! TVE.SKIP_CSS_STATE ) {
											if ( TVE.UNDO_RULES ) {
												$.each( rules, function ( k, v ) {
													/* check if the rules from the undo object are for the current element */
													if ( typeof TVE.UNDO_RULES[k] === 'undefined' ) {
														delete TVE.UNDO_RULES;
														return false;
													}
												} );
											}

											var undo_rules = null;

											if ( TVE.UndoManager.temp.get() ) {
												/* in case we have a registered temporary state, we use that one as undo rule */
												undo_rules = TVE.UndoManager.temp.get();
												TVE.UndoManager.temp.delete()
											}

											if ( undo_rules === null ) {
												undo_rules = TVE.UNDO_RULES || TVE.head_css_get( selector, rules, media, true )
											}

											TVE.UndoManager.add( {
												undo: function () {
													var current_css_state = TVE.SKIP_CSS_STATE;
													TVE.SKIP_CSS_STATE = true;
													TVE.head_css( selector, undo_rules, media );
													TVE.SKIP_CSS_STATE = current_css_state;
												},
												redo: function () {
													var current_css_state = TVE.SKIP_CSS_STATE;
													TVE.SKIP_CSS_STATE = true;
													TVE.head_css( selector, rules, media );
													TVE.SKIP_CSS_STATE = current_css_state;
												}
											} );

											delete TVE.UNDO_RULES;
										} else {
											if ( ! TVE.UNDO_RULES ) {
												TVE.UNDO_RULES = TVE.head_css_get( selector, rules, media, true );
											}
										}
									};

									/**
									 * Write CSS in head style
									 * @param selector
									 * @param rules
									 * @param media
									 * @param force_important {boolean} force important for rules
									 */
									extension.write_css = function ( selector, rules, media, force_important ) {

										for ( var i = 0, _media; _media = media[i ++]; ) {
											var _css_style = ( this.CSS_Rule_Cache.media_rule( _media ) ).style_by_selector( selector );

											$.each( rules, function ( prop, value ) {
												var important = '';
												if ( typeof value === 'string' && value.indexOf( 'important' ) !== - 1 ) {
													value = $.trim( value.replace( /!(\s*)important/, '' ) );
													important = 'important';
												}

												if ( ! value ) {
													_css_style.removeProperty( prop );
												}

												if ( force_important ) {
													important = 'important';
												}

												_css_style.setProperty( prop, value, important );
											} );
										}
									};

									/**
									 * Return css values from the head style
									 * @param selector identifier for the element we want to get css from
									 * @param rules css rules
									 * @param media
									 * @param force {boolean} if true, when the element doesn't have a head css, it will search in the style.
									 * @returns {{}}
									 */
									extension.head_css_get = function ( selector, rules, media, force ) {
										var css = {};

										if ( force ) {
											var $element = $( selector );
										}

										media = media || TVE.main.media_query_tpl();
										media = media === '_ALL' ? TVE.main.all_media() : [media];

										for ( var i = 0, _media; _media = media[i ++]; ) {
											var style = ( this.CSS_Rule_Cache.media_rule( _media ) ).style_by_selector( selector );

											$.each( rules, function ( prop, value ) {
												css[prop] = style.getPropertyValue( prop );
												if ( css[prop] == '' && force ) {
													css[prop] = $element.css( prop );
												}

												if ( typeof value === 'string' && value.indexOf( 'important' ) !== - 1 ) {
													css[prop] += '!important';
												}
											} );
										}

										return css;
									};

									/**
									 * Copy the stylesheet rules from old_id to new_id
									 * Re-inserts each CSS rule for all media queries
									 *
									 * @param {string} old_selector
									 * @param {string} new_selector
									 */
									extension.head_css_copy = function ( old_selector, new_selector ) {
										var all_media = TVE.main.all_media();

										for ( var i = 0, media; media = all_media[i ++]; ) {

											var media_rule = this.CSS_Rule_Cache.media_rule( media ); // grab the media rule
											var size = media_rule.cssRules.length;

											for ( var j = 0; j < size; j ++ ) {
												if ( media_rule.cssRules[j].cssText.indexOf( old_selector ) !== - 1 ) {
													var css_text = media_rule.cssRules[j].cssText.replace( new RegExp( old_selector, 'i' ), new_selector );
													media_rule.insertRule( css_text, media_rule.cssRules.length );
												}
											}
										}
									};

									extension.CSS_Rule_Cache = {
										page_index: Math.floor( Math.random() * 100000 ),
										/**
										 * generate a unique data-css ID for a DOM element. if the id exists, return it.
										 *
										 * @param elem
										 * @param {Boolean} [force_generate] if true, it will generate a new id even if one exists
										 * @returns {string|*}
										 */
										uniq_id: function ( elem, force_generate ) {
											if ( typeof force_generate === 'undefined' ) {
												force_generate = false;
											}
											if ( elem.jquery ) {
												elem = elem[0];
											}

											var css_id = elem.getAttribute( 'data-css' );

											if ( force_generate || ! css_id ) {
												css_id = this.generate_id();
												elem.setAttribute( 'data-css', css_id );
											}

											return css_id;
										},
										generate_id: function () {
											return 'tve-u-' + (new Date().getTime() + (this.page_index ++)).toString( 16 );
										},
										/**
										 * Searches for a media rule having the properties defined by media string
										 * Adds it if it doesn't exist
										 * @param {string} media
										 * @param {Number} [insert_at] index where to insert the rule
										 *
										 * @returns {CSSMediaRule} rule
										 */
										media_rule: function ( media, insert_at ) {
											/** @var {CSSStyleSheet} TVE.stylesheet */
											/**
											 * Check if a media rule matches a media query string
											 *
											 * @param {MediaList} media_list
											 * @param {string} media_str
											 * @returns {boolean}
											 */
											function media_match( media_list, media_str ) {
												for ( var i = 0; i < media_list.length; i ++ ) {
													if ( media_list.item( i ) == media_str ) {
														return true;
													}
												}
												return false;
											}

											var found = false,
												insert_delta = 0;
											if ( ! this[media] ) {
												for ( var i = 0, _rule; _rule = TVE.stylesheet.cssRules[i ++]; ) {

													if ( _rule.type === CSSRule.IMPORT_RULE ) {
														insert_delta ++;
														continue;
													}

													if ( _rule.type === CSSRule.MEDIA_RULE && _rule.media && _rule.media.length ) {
														if ( media_match( _rule.media, media ) ) {
															found = true;
															this[media] = _rule;
															break;
														}
													}
												}

												if ( ! found ) {
													if ( typeof insert_at === 'undefined' ) {
														insert_at = TVE.main.media_rule_index();
													}
													insert_at += insert_delta;
													if ( insert_at > TVE.stylesheet.cssRules.length ) {
														insert_at = TVE.stylesheet.cssRules.length;
													}
													TVE.stylesheet.insertRule( '@media ' + media + '{}', insert_at );
													this[media] = TVE.stylesheet.cssRules[insert_at];
												}

												/**
												 * return a style object by its selector
												 * adds a new style if nothing found
												 *
												 * @param {string} selector
												 * @returns {*}
												 */
												this[media].style_by_selector = function ( selector ) {
													for ( var i = 0, _rule; _rule = this.cssRules[i ++]; ) {
														if ( _rule.selectorText == selector ) {
															return _rule.style;
														}
													}
													this.insertRule( selector + '{}', 0 );
													return this.cssRules[0].style;
												}
											}

											return this[media];
										},
										clear: function () {
											var self = this;
											$.each( TVE.main.responsive, function ( _key, data ) {
												delete self[data.media];
											} );
										},
										/**
										 * parse the existing rules, build the cache and add any necessary rules, if they don't exist
										 */
										init: function () {
											var self = this;

											/**
											 * loop through each of the 3 media queries and insert the media style, if not found
											 */
											$.each( TVE.main.responsive, function ( _key, data ) {
												self.media_rule( data.media, data.rule_index );
											} );

											var desktop_media = this.media_rule( TVE.main.responsive.desktop.media );
											if ( desktop_media.cssText.indexOf( ':hover' ) !== - 1 ) {
												/** Process each selector that contains :hover and append an extra rule with the same cssText, but with .tve-state-hover prefix **/
												var len = desktop_media.cssRules.length, rule;
												for ( var i = 0; i < len; i ++ ) {
													rule = desktop_media.cssRules[i];
													if ( rule.selectorText.indexOf( ':hover' ) !== - 1 ) {
														var new_css_text = rule.cssText.replace( /(\s+)([^:]+):hover/g, '$1.tve-state-hover$2' );
														if ( new_css_text === rule.cssText ) {
															new_css_text = rule.cssText.replace( /^([^:]+):hover/g, '$1.tve-state-hover' );
														}
														desktop_media.insertRule( new_css_text, desktop_media.cssRules.length );
													}
												}
											}
										},
										/**
										 * Add import rule to head css
										 * @param font
										 */
										insertImport: function ( font ) {
											TVE.stylesheet.insertRule( '@import url("' + font + '")', 0 );
										},
										/**
										 * Return array of import rules from head css
										 * @returns {Array}
										 */
										getImports: function () {
											var imports = [];

											for ( var i = 0, _rule; _rule = TVE.stylesheet.cssRules[i ++]; ) {

												if ( _rule.type === CSSRule.IMPORT_RULE ) {
													imports[i] = _rule.cssText;
												}
											}

											return imports;
										},
										/**
										 * Return head css in text format. Specify rule type if you want only some rules to be returned
										 * @param rule_type
										 * @returns {string}
										 */
										toText: function ( rule_type ) {
											var css = '';

											for ( var i = 0, _rule; _rule = TVE.stylesheet.cssRules[i ++]; ) {

												if ( rule_type ) {
													if ( _rule.type === rule_type ) {
														css += _rule.cssText;
													}
												} else {
													css += _rule.cssText;
												}
											}

											return css;
										}
									};

									/**
									 * ################################### END HEAD CSS FUNCTIONALITY ###################################
									 */

									/**
									 * Remove the current background overlay
									 */
									extension.remove_overlay = function () {
										$( '.tve-background-overlay' ).remove();
										$( '.tve-element-overlay' ).removeClass( 'tve-element-overlay' );
										TVE.inner.$body.removeClass( 'tcb-states' );
									};

									extension.body_overlay = function () {
										if ( ! $( '.tve-background-overlay' ).length ) {
											TVE.inner.$body.append( '<div class="tve-background-overlay"></div>' );
										}
									};

									extension.remove_body_overlay = function () {
										$( '.tve-background-overlay' ).remove();
										TVE.inner.$body.removeClass( 'tcb-states' );
									};

									$.fn.extend( {
										/**
										 * Display background overlay to highlight the current element
										 *
										 * @returns {tve_overlay}
										 */
										tve_overlay: function () {
											TVE.body_overlay();
											this.addClass( 'tve-element-overlay' );

											return this;
										}
									} );

									extension.generateElementPreview = function ( $element, $this, func, form ) {
										var $clone = $( '<div id="tcb-template-clone-elem" style="position: absolute; left: -8000px; bottom: -5000px;"></div>' ).append( $element.clone() );
										TVE.inner.jQuery( 'body' ).prepend( $clone );

										//Remove stuff that causes conflicts with dom-to-image library
										$clone.find( 'img' ).removeAttr( 'srcset' );

										TVE.inner.window.domtoimage.toBlob( $clone.children().first()[0], {
											style: {'padding': '0', 'margin': '0', 'outline': 'none'}
										} ).then( function ( blob ) {
											$clone.remove();

											if ( typeof func === 'function' ) {
												form.append( 'img_data', blob, form.get( 'template_name' ) + '.png' );
												func( $this, form );
											}
										} ).catch( function ( error ) {
											console.error( 'oops, something went wrong!', error );
										} );
									};

									module.exports = extension;

								})( jQuery );
							},
							"jquery-plugins.js": function (exports, module, require) {
								(function ( $ ) {
									/* backwards compatibility for social sharing element */
									$.fn.tve_social = function () {
										var $element = this,
											_type = this.hasClass( 'thrv_social_default' ) ? 'default' : 'custom',
											sdk = {
												fb_like: 'fb',
												g_share: 'google',
												g_plus: 'google',
												t_share: 'twitter',
												t_follow: 'twitter',
												in_share: 'linkedin',
												pin_share: 'pinterest',
												xing_share: 'xing'
											};

										return {
											getRequiredSDKs: function () {
												if ( _type === 'custom' && $element.find( '[data-s="fb_share"]' ).length ) {
													return ['fb'];
												}
												var sdk = [];
												if ( _type === 'default' ) {
													$element.find( '.tve_s_item' ).each( function () {
														sdk.push( sdk[this.getAttribute( 'data-s' )] );
													} );
												}

												return sdk;
											}
										};
									};
								})( jQuery );
							},
							"landing-fonts.js": function (exports, module, require) {
								/**
								 * Font setup for landing pages - TODO: delete this file before release
								 */
								(function ( $ ) {

									var landing_fonts = {
										$main_menu: null,
										initElement: function ( $btn, $element, event ) {
											tve_refresh( false );
											var $wrapper = jQuery( '.tve_wrap_all' );
											$wrapper.addClass( 'tve_landing_fonts' );
											event.target = $wrapper;
											event.currentTarget = $wrapper;
											tve_editor_init( event, $wrapper );

											TVE.CONST.tve_globals.landing_fonts = TVE.CONST.tve_globals.landing_fonts || {};
										},
										addToGlobals: function ( selector, rule, value ) {
											TVE.CONST.tve_globals['landing_fonts'][selector] = TVE.CONST.tve_globals['landing_fonts'][selector] || {};
											TVE.CONST.tve_globals['landing_fonts'][selector][rule] = value;
										},
										removeFromGlobals: function ( selector, rule ) {
											if ( TVE.CONST.tve_globals['landing_fonts'][selector] && TVE.CONST.tve_globals['landing_fonts'][selector][rule] ) {
												delete TVE.CONST.tve_globals['landing_fonts'][selector][rule];
											}
										},
										getSelectorMenu: function ( selector ) {
											if ( ! this.$main_menu ) {
												return null;
											}
											return this.$main_menu.find( 'ul.tve_menu[data-selector="' + selector + '"]' );
										},
										setFontFamily: function ( $button ) {
											tve_set_selected_dropdown( $button );
											var _selector = $button.data( 'selector' ),
												_font_family = $button.data( 'font-family' ),
												_css_class = $button.data( 'cls' );

											this.addToGlobals( _selector, 'font-family', _font_family );
											TVE.CONST.tve_globals.landing_fonts[_selector]['css_class'] = _css_class;
											this.add_css_rule( _selector, 'font-family: ' + _font_family );
										},
										clearFontFamily: function ( $button ) {
											var _selector = $button.data( 'selector' ),
												_menu = this.getSelectorMenu( _selector );
											this.remove_css_rule( _selector, 'font-family' );
											this.removeFromGlobals( _selector, 'font-family' );
											delete TVE.CONST.tve_globals.landing_fonts[_selector]['css_class'];
											tve_set_selected_dropdown( _menu.find( '.tve_font_list li' ).first(), true );
										},
										setFontSize: function ( $input ) {
											var _selector = $input.data( 'selector' ),
												_size = tve_handle_integer_or_float( $input.val() ),
												_unit = this.getSelectorMenu( _selector ).find( '.tve_landing_fonts_size_unit[data-selector="' + _selector + '"]' ).text();

											this.add_css_rule( _selector, 'font-size:' + _size + _unit + "" );
											this.addToGlobals( _selector, 'font-size', _size + _unit + "" );
										},
										setFontSizeUnit: function ( $button ) {
											var _selector = $button.data( 'selector' ),
												_size = tve_handle_integer_or_float( this.getSelectorMenu( _selector ).find( 'input.tve_landing_fonts_size[data-selector="' + _selector + '"]' ).val() ),
												_unit = $button.text().indexOf( "em" ) !== - 1 ? 'em' : 'px';

											tve_set_selected_dropdown( $button );

											this.add_css_rule( _selector, 'font-size:' + _size + _unit + "" );
											this.addToGlobals( _selector, 'font-size', _size + _unit + "" );
										},
										setFontLineHeight: function ( $input ) {
											var _selector = $input.data( 'selector' ),
												_size = tve_handle_integer_or_float( $input.val() ),
												_unit = this.getSelectorMenu( _selector ).find( '.tve_landing_fonts_line_height_unit[data-selector="' + _selector + '"]' ).text();

											this.add_css_rule( _selector, 'line-height:' + _size + _unit + "" );
											this.addToGlobals( _selector, 'line-height', _size + _unit + "" );
										},
										setFontLineHeightUnit: function ( $button ) {
											var _selector = $button.data( 'selector' ),
												_size = tve_handle_integer_or_float( this.getSelectorMenu( _selector ).find( 'input.tve_landing_fonts_line_height[data-selector="' + _selector + '"]' ).val() ),
												_unit = $button.text().indexOf( "em" ) !== - 1 ? 'em' : 'px';

											tve_set_selected_dropdown( $button );

											this.add_css_rule( _selector, 'line-height:' + _size + _unit + "" );
											this.addToGlobals( _selector, 'line-height', _size + _unit + "" );
										},
										remove_css_rule: function ( selector, rule ) {
											tve_remove_css_rule( "#tve_editor " + selector, rule );
											if ( selector === 'p' ) {
												tve_remove_css_rule( "#tve_editor li", rule );
											}
										},
										add_css_rule: function ( selector, rule ) {
											tve_add_css_rule( "#tve_editor " + selector, rule, 0 );
											if ( selector === 'p' ) {
												tve_add_css_rule( "#tve_editor li", rule, 0 );
											}
										},
										onMenuLoad: function ( $element, $menu ) {
											this.$main_menu = $menu;

											$.each( TVE.CONST.tve_globals.landing_fonts, function ( selector, rules ) {
												var _submenu = $menu.find( '.tve_menu[data-selector="' + selector + '"]' );

												if ( rules['font-family'] ) {
													var $li = _submenu.find( '.tve_font_list li[data-font-family="' + rules['font-family'] + '"]' );
													tve_set_selected_dropdown( $li );
												}

												if ( rules['font-size'] ) {
													var _font_size = tve_handle_integer_or_float( rules['font-size'] ),
														_unit = rules['font-size'].indexOf( "px" ) !== - 1 ? "px" : "em",
														_unit_li = _submenu.find( "li.tve_landing_fonts_size_" + _unit + "[data-selector='" + selector + "']" );
													_submenu.find( 'input.tve_landing_fonts_size[data-selector="' + selector + '"]' ).val( _font_size );
													tve_set_selected_dropdown( _unit_li );
												}

												if ( rules['line-height'] ) {
													var _line_height = tve_handle_integer_or_float( rules['line-height'] ),
														_unit = rules['line-height'].indexOf( "px" ) !== - 1 ? "px" : "em",
														_unit_li = _submenu.find( "li.tve_landing_fonts_line_height_" + _unit + "[data-selector='" + selector + "']" );
													_submenu.find( 'input.tve_landing_fonts_line_height[data-selector="' + selector + '"]' ).val( _line_height );
													tve_set_selected_dropdown( _unit_li );
												}
											} );
										},
										fontUsed: function ( font_class ) {
											var _found = false;
											$.each( TVE.CONST.tve_globals.landing_fonts, function ( selector, rules ) {
												if ( rules.css_class === font_class ) {
													_found = true;
													return;
												}
											} );

											return _found;
										},
										colorChanged: function ( data ) {
											if ( ! data.force_selector ) {
												return;
											}
											var _selector = data.force_selector.replace( "#tve_editor ", "" );
											this.add_css_rule( _selector, "color: " + data.color_value );
											this.addToGlobals( _selector, 'color', data.color_value );
										}
									};

									module.exports = landing_fonts;

								})( jQuery );
							},
							"selection-manager.js": function (exports, module, require) {
								/**
								 * Created on 2/13/2017.
								 */
								/**
								 * Handles selection of elements inside the editor
								 */
								(function ( $ ) {
									var $active_highlight = null;

									module.exports = {
										/**
										 * Clone and delete icons
										 */
										selectors: require( './selectors' ),
										$clone: null,
										$delete: null,
										$el_icons: null,
										$el_name: null,
										$root: null,
										is_disabled: function () {
											var is_canvas = this.$root.hasClass( 'canvas-mode' );
											return TVE.Editor_Page.is_disabled() && ! is_canvas;
										},
										add_icons: function () {
											if ( ! this.$el_icons ) {
												this.$el_name = $( '#tcb-el-name' );
												this.$drag_handle = $( '#tve-drag-handle' );
												this.$el_icons = $( '#tcb-el-icons' );
												this.$clone = this.$el_icons.find( '.tcb-icon-copy' );
												this.$delete = this.$el_icons.find( '.tcb-icon-trash' );

												$( document )
													.on( 'mousedown.tcb', $.proxy( this.click_blur, this ) )
													.on( 'keyup.tcb', $.proxy( this.keyup_blur, this ) )
													.on( 'click', '.tcb-icon-trash', $.proxy( this.click_delete, this ) )
													.on( 'click', '.tcb-icon-copy', $.proxy( this.click_duplicate, this ) )
													.on( 'mouseleave.tcb', '#tcb-el-icons,#tve-drag-handle', $.proxy( function ( e ) {
														/* if we move the mouse from the drag handle to icons we don't hide icons */
														if ( TVE.state() === TVE.STATE_EDIT || ( e.relatedTarget && ( e.relatedTarget.id === 'tcb-el-icons' || e.relatedTarget.id === 'tve-drag-handle' ) ) ) {
															return;
														}
														this.hide_icons();
													}, this ) )
											}
										},
										hide_icons: function () {
											this.$el_icons.hide();
											this.$el_name.hide();
											this.$target = null;
											TVE.drag.hide_handle();
											$( '.active_delete,.active_duplicate,.active_highlight' ).removeClass( 'active_delete active_duplicate active_highlight' );

											return this;
										},
										/**
										 * Show and position the icons relative to the $target element passed as parameter
										 *
										 * @param {jQuery} $target
										 */
										show_icons: function ( $target ) {
											if ( $target.is( '.canvas-mode' ) ) {
												return false;
											}
											var _type = TVE._type( $target ),
												coords = this.getElementCoords( $target ),
												handle_position, icons_position;

											/* default icons position -> top right corner */
											icons_position = {
												top: ( coords.top - 20 ) + 'px',
												left: ( coords.left + coords.width - 39 ) + 'px'
											};
											handle_position = {
												top: coords.top + 'px',
												left: coords.left + ( coords.width / 2 ) - 25 + 'px'
											};

											/* set the name of the element -> top left */
											this.$el_name.html( TVE.Elements[_type] ? TVE.Elements[_type].name : 'Element' );

											/* for elements with a width smaller than 100, we move the drag handle */
											this.$drag_handle.toggleClass( 'tcb-drag-small', coords.width < 150 );
											if ( coords.width < 150 ) {
												handle_position.left = ( coords.left + coords.width - 59) + 'px';
											}

											this.$drag_handle.css( handle_position ).hide();
											this.$el_icons.css( icons_position ).hide();
											this.$el_name.hide();

											TVE.drag.handle_mouseover( $target );
											$target.addClass( 'active_delete' );

											if ( TVE.main.device === 'desktop' ) {
												this.$target = $target;
												this.$el_icons.show();
											}

											if ( $target.is( this.selectors.no_icons ) ) {
												$target.addClass( 'active_highlight' );
												this.$el_icons.hide();
											} else {
												/* hide delete or clone icons if they are not to be displayed */
												this.$delete[$target.is( this.selectors.no_delete ) ? 'hide' : 'show']();
												this.$clone[$target.is( this.selectors.no_clone ) ? 'hide' : 'show']();
											}

											/* display element name only for elements wider than 200 px */
											if ( coords.width > 200 ) {
												this.$el_name.css( {
													top: coords.top - 23 + 'px',
													left: coords.left - 1 + 'px'
												} ).show();
											}

											if ( $target.is( this.selectors.get( 'no_icons' ) ) ) {
												$target.addClass( 'active_highlight' );
												if ( $target.hasClass( 'tve_p_lb_control' ) || $target.hasClass( 'tve_p_lb_content' ) ) {
													$target.closest( '.tve_p_lb_content' ).addClass( 'active_highlight' );
												}
												return this.$el_icons.hide();
											}
										},
										/**
										 * Bind all the needed event listeners on the Root node (ussualy this will be the editor node)
										 * @param $root
										 */
										init: function ( $root ) {
											if ( $root[0] === TVE.Editor_Page.editor[0] ) {
												/**
												 * Case: editing lightboxes and Landing page (body background etc)
												 */
												$root = $( document.body );
											}
											this.add_icons();

											this.$root = $root;

											var editable = this.selectors.get( 'editable' );

											$root.off( 'mouseenter.tcb mouseover.tcb mouseleave.tcb mousedown.tcb click.tcb ' )
												.on( 'mouseenter.tcb', this.selectors.get( 'mouseover' ), $.proxy( this.mouseenter, this ) )
												.on( 'mouseleave.tcb', this.selectors.get( 'mouseover' ), $.proxy( this.mouseleave, this ) )
												.on( 'mousedown.tcb', editable, $.proxy( this.prevent_focus, this ) )
												.on( 'click.tcb', editable, $.proxy( this.element_click, this ) );
										},
										/**
										 * Clears focus and removes focus from any editable element
										 *
										 * @param {Boolean} [hide_icons] Defaults to true
										 */
										blur: function ( hide_icons ) {
											if ( this.is_disabled() ) {
												return;
											}

											if ( this.$root.is( '.canvas-mode' ) ) {
												this.$root.removeClass( 'edit_mode' )
													.find( '.edit_mode' ).removeClass( 'edit_mode' );
											} else {
												$( '.edit_mode' ).removeClass( 'edit_mode canvas-mode' );
											}

											hide_icons = typeof hide_icons === 'undefined' ? true : hide_icons;
											if ( hide_icons ) {
												this.hide_icons();
											}

											TVE.main.clear_focus();
											TVE.Editor_Page.$body.removeClass( 'tcb-distraction-free' );
										},
										/**
										 * Clears focus when pressing Esc key
										 * @param e
										 */
										keyup_blur: function ( e ) {
											if ( e.which === 27 ) {
												this.blur();
											}
										},
										/**
										 * Clears focus when clicking outside any editable element
										 * @param e
										 * @returns {boolean}
										 */
										click_blur: function ( e ) {
											var $elem = $( e.target );

											/* we don't blur when: */
											if ( $elem.closest( '.edit_mode' ).length || /* we have an element in edit mode and we click inside */
											     e.target.classList.contains( 'no-blur' ) || /* element specifies that it doesn't trigger blur */
											     $elem.closest( '.tve-froala' ).length || /* no blur on mousedown inside a text element */
											     $elem.closest( '.no-blur' ).length || /* no blur on parent */
											     TVE.prevent_blur || /* global flag that allows skipping blur */
											     $elem.closest( this.selectors.get( 'editable' ) ).not( '.tve_lp' ).length || /* another element entering edit state */
											     e.target.classList.contains( 'ui-resizable-handle' ) /* we click on the resize handle on a element that we're not editing */
											) {
												return true;
											}

											this.blur();
											return true;
										},
										/**
										 * Main entry point for selecting an element
										 *
										 * @param e
										 * @returns {boolean}
										 */
										element_click: function ( e ) {
											if ( TVE.Editor_Page.GLOBAL_PREVENT_FOCUS || ( window.getSelection && window.getSelection().toString() ) ) {
												return false;
											}
											var $element = $( e.currentTarget );
											if ( e.target.classList.contains( 'ui-resizable-handle' ) ) {
												return false;
											}
											/**
											 * If in hover state, check if the element can actually be edited
											 */
											if ( ! this.allow_state_selection( $element ) ) {
												return true;
											}
											/**
											 * Special case: click on a TCB-action button ( .tcb-click )
											 */
											if ( e.target.classList.contains( 'tcb-click' ) ) {
												/* allow the event to propagate further */
												return true;
											}
											/**
											 * If the user clicks outside of a .inline-placeholder-action button, but inside a placeholder element, do nothing. The click needs to originate from the button
											 */
											var $placeholder_button = $element.children( '.tcb-inline-placeholder-action' );
											if ( $placeholder_button.length ) {
												if ( $placeholder_button[0] !== e.target && ! $.contains( $placeholder_button[0], e.target ) ) {
													return false;
												}
											}
											e.preventDefault();
											if ( $element.is( this.selectors.get( 'not_editable' ) ) ) {
												/**
												 * find the first parent editable
												 */
												$element = $element.parents( '.thrv_wrapper' ).not( this.selectors.get( 'not_editable' ) ).first();
												if ( ! $element.length ) {
													return true;
												}
											}
								//			this.hide_icons();
											TVE.Editor_Page.focus_element( $element, e );
											return false;
										},
										/**
										 * Prevent focus on inputs elements (e.g. Lead Generation element)
										 * @param e
										 */
										prevent_focus: function ( e ) {
											if ( $( e.target ).is( 'input, textarea, select' ) ) {
												e.preventDefault();
											}
										},
										/**
										 * Hide the clone, delete and drag icons on mouseleave
										 *
										 * @param e
										 * @returns {boolean}
										 */
										mouseleave: function ( e ) {
											if ( this.is_disabled() ) {
												return false;
											}
											if ( e.relatedTarget === this.$clone[0] ||
											     e.relatedTarget === this.$el_name[0] ||
											     e.relatedTarget === this.$delete[0] ||
											     e.relatedTarget === window.$tve_drag_handle[0]
											) {
												return false;
											}
											if ( TVE.state() === TVE.STATE_EDIT ) {
												if ( $active_highlight ) {
													$active_highlight.removeClass( 'active_highlight' );
												}
												/* trigger the mouseenter event to catch cases where parent needs icons displayed */
												$( e.relatedTarget ).trigger( 'mouseenter' );
												return false;
											}
											this.hide_icons();
											/* trigger the mouseenter event to catch cases where parent needs icons displayed */
											$( e.relatedTarget ).trigger( 'mouseenter' );

											return false;
										},
										/**
										 * handle mouseenter events
										 * @param e
										 * @returns {boolean}
										 */
										mouseenter: function ( e ) {

											if ( this.is_disabled() ) {
												return false;
											}

											var $target = $( e.currentTarget );

											if ( ! this.allow_state_selection( $target ) ) {
												return true;
											}

											if ( $target.is( this.selectors.get( 'no_highlight' ) ) ) {
												return true;
											}

											if ( $target.is( this.selectors.no_highlight ) ) {
												return true;
											}

											if ( e.target.classList.contains( 'ui-resizable-handle' ) ) {
												return false;
											}

											if ( TVE.state() === TVE.STATE_EDIT ) {
												if ( $active_highlight ) {
													$active_highlight.removeClass( 'active_highlight' );
												}
												$target.addClass( 'active_highlight' );
												$active_highlight = $target;
												return false;

											}

											this.hide_icons();
											this.show_icons( $target );

											e.stopPropagation();
										},
										/**
										 * trigger the removal of an element when clicking the delete icon
										 * @param e
										 */
										click_delete: function ( e ) {
											if ( ! this.$target ) {
												return false;
											}
											TVE.Editor_Page.editor.find( '.active_delete, .active_highlight, .active_duplicate, .edit_mode' ).removeClass( 'edit_mode active_highlight active_delete active_duplicate' );

											TVE.Editor_Page.before_action()
												.remove_element( this.$target )
												.after_action();

											this.hide_icons();
										},
										/**
										 * Trigger the cloning of an element when clicking the duplicate icon
										 * @param e
										 */
										click_duplicate: function ( e ) {
											if ( ! this.$target ) {
												return false;
											}
											TVE.Editor_Page.before_action()
												.duplicate_element( this.$target )
												.after_action();
										},
										/**
										 * Some elements need to be measured without padding
										 *
										 * @param {jQuery} $target
										 */
										getElementCoords: function ( $target ) {
											var coords = $target.offset();
											coords.width = $target.outerWidth();

											if ( coords.top < 20 ) {
												coords.top = 20;
											}

											return coords;
										},
										/**
										 * Repositions the icons relative to the $target element
										 *
										 * @param $target
										 */
										reposition_icons: function ( $target ) {
											var coords = this.getElementCoords( $target ),
												handle_position, icons_position;

											/* default icons position -> top right corner */
											icons_position = {
												top: ( coords.top - 20 ) + 'px',
												left: ( coords.left + coords.width - 39 ) + 'px'
											};
											handle_position = {
												top: coords.top + 'px',
												left: coords.left + ( coords.width / 2 ) - 25 + 'px'
											};

											/* for elements with a width smaller than 100, we move the drag handle */
											this.$drag_handle.toggleClass( 'tcb-drag-small', coords.width < 150 );
											if ( coords.width < 150 ) {
												handle_position.left = ( coords.left + coords.width - 59) + 'px';
											}

											this.$drag_handle.css( handle_position );
											this.$el_icons.css( icons_position );

											/* display element name only for elements wider than 200 px */
											if ( coords.width > 200 ) {
												this.$el_name.css( {
													top: coords.top - 23 + 'px',
													left: coords.left - 1 + 'px'
												} ).show();
											} else {
												this.$el_name.hide();
											}
										},
										/**
										 * Checks if the current element can be selected when one of its parents is in hover state
										 *
										 * @param $target
										 * @returns {boolean}
										 */
										allow_state_selection: function ( $target ) {
											if ( TVE.state_manager.is_default() ) {
												return true;
											}

											var type = TVE._type( $target );

											return TVE.Elements[type] && TVE.Elements[type][TVE.state_manager.get_state()];
										}
									};

								})( jQuery );
							},
							"selectors.js": function (exports, module, require) {
								module.exports = {
									/**
									 * All editable elements
									 */
									editable: '.thrv_wrapper:not(.thrv_text_element, .thrv_heading), .tve_ts_o span, span.tve_ts_copy-aut, .tve_ts_copy-aut span .tve_btnLink span, .tve_ct_title, .thrv_tw_qs_button span span, .tve_editable, .thrv-inline-text,.thrv-styled-list-item, .tve_faqB h4, .canvas-mode .tve_lg_input_container, .tcb-col',
									/**
									 * Elements that are not editable
									 */
									not_editable: '.tcb-not-editable, .tcb-not-editable *, .thrive_leads_shortcode *, .thrive-shortcode-html, .thrive-shortcode-html *, .tve_custom_html_placeholder, ' +
									              '.tve_custom_html_placeholder *, .thrv_custom_html_shortcode *, .thrv_post_grid *, .tve_no_edit, .tve_more_tag, .table_placeholder,  ' +
									              '.table_placeholder *, .image_placeholder, .image_placeholder *, .borderless_placeholder, .borderless_placeholder *, .ui-datepicker-header *, ' +
									              '.tve_wp_shortcode *, #tve_mce_holder *, .code_placeholder, .thrv_widget *, .tve_ts_o img, .thrv_widget_menu ul*' +
									              ',.thrv_lead_generation .thrv-columns' +
									              ',.thrv_lead_generation .tcb-col' +
									              ',.thrv_lead_generation:not(.canvas-mode) .thrv_icon',
									/**
									 * Elements that should react on mouseenter (have their menus displayed)
									 */
									mouseover: '.thrv_wrapper:not(.canvas-mode .thrv-columns), ' +
									           '.tve_clearfix li, .tve_faq, .tve_p_lb_control, ' +
									           '.thrv_feature_grid .tve_gri > .tve_image,.tve_element_hover, ' +
									           'p.tve_more_tag, .tcb-col, .tve_faqB h4, ' +
									           '.tve_editable, .canvas-mode .tve_lg_input_container',
									/**
									 * Elements that should not have a highlight effect on mouseover
									 */
									no_highlight: '.thrive-shortcode-html *, .thrive_leads_shortcode *, .tcb-no-highlight' +
									              ',.thrv_lead_generation:not(.canvas-mode) .thrv_icon' +
									              ',.thrv_lead_generation .thrv-columns' +
									              ',.thrv_lead_generation:not(.canvas-mode) .tcb-col' +
									              '',
									/**
									 * Elements that should not have neither duplicate nor delete icons
									 */
									no_icons: '.tve_table_cell, .thrv_tw_quote p, .tve_p_lb_control, .tve_editor_main_content,' +
									          '.tve_lp_content, .tve_no_icons, .thrv_widget_menu .tve_menu_title, .tve_lg_input_container .thrv_icon,' +
									          '.thrive-shortcode-html, .thrive-shortcode-html *, .tve_faqB h4, .tve_editable,' +
									          '.tve_lg_input_container, .tve_lead_generated_inputs_container .thrv-columns, .thrv_lead_generation .thrv_icon,' +
									          '.canvas-mode',
									/**
									 * Elements that should not have the "duplicate" icon displayed
									 */
									no_clone: '.tve_gri .image_placeholder, .table_placeholder, .tcb-no-clone, .tve_no_duplicate, .tve_more_tag, .tcb-col, .thrv-inline-text',
									/**
									 * Elements that should not have the "delete" icon displayed
									 */
									no_delete: '.tcb-no-delete',
									get: function ( type ) {

										var elem = null;

										if ( this[type] !== undefined ) {
											elem = TVE.apply_filters( 'selectors_' + type, this[type] );
										}

										return elem;
									}
								};
							},
							"table": {
								"cell-manager.js": function (exports, module, require) {
									/** Cell merge functionality for tables */
									var TVE_Table_Grid = require( './grid' ),
										/* holds the current selection */
										selection = [];

									(function ( $ ) {
										$.fn.extend( {
											tve_rows: function () { //set or return the number of rows from the table, based on data-rows attribute
												if ( arguments.length === 0 ) {
													return parseInt( this.attr( 'data-rows' ) );
												}
												return this.attr( 'data-rows', arguments[0] );
											},
											tve_cols: function () { //set or return the number of rows from the table, based on data-rows attribute
												if ( arguments.length === 0 ) {
													return parseInt( this.attr( 'data-cols' ) );
												}
												return this.attr( 'data-cols', arguments[0] );
											}
										} );

										var cell_manager = {
											table: null,
											$el: null,
											buttons: null,
											drag: {
												mouse_down: false,
												start_element: null,
												current_element: null,
												is_head: false
											},
											mouse_move_cells: '> thead > tr > th:not(.tve_merge_disabled), > tbody > tr > td:not(.tve_merge_disabled)',
											head_cells: '> thead > tr > th',
											body_cells: '> tbody > tr > td',
											head: null,
											body: null,
											grid: null,
											/**
											 *
											 * @param {jQuery} [$table] table object
											 */
											init: function ( $table ) {
												var restore_selection = true,
													self = this;
												if ( typeof $table !== 'undefined' ) {
													restore_selection = false;
													selection = [];
													this.table = $table;
													/* show the notification just the first time */
													TVE.page_message( 'Hold down the left mouse button on a cell and drag it across the highlighted table to select multiple cells!', false, 5000 );
												}

												this.head = this.table.find( '> thead' );
												this.body = this.table.find( '> tbody' );

												this.$el = this.table.parent().addClass( 'canvas-mode' );

												this.table.addClass( 'tve_merge_cells' ).find( 'th, th *, td, td *' ).disableSelection();
												if ( ! this.buttons ) {
													this.buttons = $( '#tcb-table-panel' );
												}

												TVE.Editor_Page.disable();
												TVE.Editor_Page.GLOBAL_PREVENT_FOCUS = true;
												TVE.main.switch_menu_to( 'custom', 'table' );

												this.showActionButtons();
												this.bind();

												this.table.tve_rows( 0 ); // mark it as 0, so we can add it up when instantiating the grid
												// the number of rows from the table = head rows + body rows

												var headGrid = this.__head_grid = new TVE_Table_Grid( this.head, true ),
													bodyGrid = this.__body_grid = new TVE_Table_Grid( this.body, true );

												if ( isNaN( this.table.tve_cols() ) || isNaN( this.table.tve_rows() ) ) {
													this.table.tve_rows( headGrid.getRowCount() + bodyGrid.getRowCount() );
													this.table.tve_cols( Math.max( headGrid.getColCount(), bodyGrid.getColCount() ) );
												}

												if ( restore_selection && selection.length ) {
													$.each( selection, function ( index ) {
														if ( index === 0 ) {
															this.cell.trigger( 'mousedown' );
														} else {
															this.cell.trigger( 'mousemove' );
														}
													} );
													selection[selection.length - 1].cell.trigger( 'mouseup' );
												} else {
													this.enableButtons( this.table.data( 'selected-cells' ) || [] );
												}
											},
											showActionButtons: function () {
												this.buttons.show().find( '.tcb-table-btn' ).off( 'click' ).on( 'click', $.proxy( this.onActionClick, this ) );

												this.positionButtons();
											},
											positionButtons: function () {
												var position = this.$el.offset(),
													body_offset = TVE.Editor_Page.$body.offset();

												this.buttons.css( {
													left: ( position.left - body_offset.left ) + 'px',
													top: ( position.top - body_offset.top ) + 'px',
													width: this.$el.outerWidth()
												} ).find( '.below-element' ).css( 'top', this.$el.outerHeight() + 'px' );
											},
											saveSelection: function () {
												selection = this.table.data( 'selected-cells' ) || [];
											},
											clearSelection: function () {
												selection = [];
											},
											onActionClick: function ( e ) {
												var fn = e.currentTarget.getAttribute( 'data-fn' );
												if ( this[fn] ) {
													return this[fn]( e.currentTarget.getAttribute( 'data-arg' ) || null );
												}
											},
											bind: function () {
												this.table.off().on( 'mousedown', this.head_cells + ', ' + this.body_cells, jQuery.proxy( this.mouseDown, this ) );
												this.table.on( 'mousemove', this.mouse_move_cells, jQuery.proxy( this.mouseOver, this ) );
												this.table.on( 'mouseup', this.head_cells + ', ' + this.body_cells, jQuery.proxy( this.mouseUp, this ) );

												$( TVE.Editor_Page ).bind( 'editor.onenable', jQuery.proxy( this.cancel, this ) );
											},
											mouseDown: function ( e ) {
												var $cell = $( e.currentTarget );
												this.reset();

												this.drag.mouse_down = true;
												this.drag.start_element = $cell.addClass( 'tve_merge_selected' );

												if ( $cell.is( 'td' ) ) {
													this.table.find( this.head_cells ).addClass( 'tve_merge_disabled' );
													this.drag.is_head = false;
												} else {
													this.table.find( this.body_cells ).addClass( 'tve_merge_disabled' );
													this.drag.is_head = true;
												}
												this.grid = new TVE_Table_Grid( this.drag.is_head ? this.head : this.body, false );

												this.grid.setStartCell( this.drag.start_element );
												return false;
											},
											mouseUp: function ( e ) {
												this.drag.mouse_down = false;
												if ( ! this.table.data( 'selected-cells' ) && this.grid ) {
													this.table.data( 'selected-cells', this.grid.getRange( this.drag.start_element, $( e.currentTarget ) ) );
												}
												this.table.find( '.tve_merge_disabled' ).removeClass( 'tve_merge_disabled' );
												this.enableButtons( this.table.data( 'selected-cells' ) );
											},
											enableButtons: function ( selected_cells ) {
												this.buttons.find( '.m-disable' ).prop( 'disabled', true );
												this.$el.addClass( 'edit_mode' ).find( '.edit_mode' ).removeClass( 'edit_mode' );
												TVE.main.switch_menu_to( 'custom', 'table' );
												if ( ! selected_cells || selected_cells.length < 1 ) {
													return;
												}
												if ( selected_cells.length > 1 ) {
													this.buttons.find( '.m-enable-more' ).prop( 'disabled', false );
												} else { // selected_cells.length = 1
													this.buttons.find( '.m-enable-one' ).prop( 'disabled', false );
													var has_span = parseInt( selected_cells[0].cell.attr( 'rowspan' ) || 1 ) + parseInt( selected_cells[0].cell.attr( 'colspan' ) || 1 ) > 2;
													this.buttons.find( '[data-fn="split"]' ).prop( 'disabled', ! has_span );
													var $cell = selected_cells[0].cell;
													this.select_element( $cell );
													$cell.__col = (this.head.length ? this.__head_grid : this.__body_grid).getCell( 0, selected_cells[0].real_col );
													$cell.__row = $cell.parent().children( 'td,th' ).first();
												}
											},
											select_element: function ( $element ) {
												this.$el.removeClass( 'edit_mode' ).find( 'td,th' ).removeClass( 'edit_mode' );
												TVE.main.element_selected( $element.addClass( 'edit_mode' ), {}, false );
											},
											mouseOver: function ( e ) {
												if ( ! this.drag.mouse_down ) {
													return false;
												}
												this.table.find( 'td,th' ).removeClass( 'tve_merge_selected' );
												this.drag.current_element = $( e.currentTarget );

												var _selected = this.grid.getRange( this.drag.start_element, this.drag.current_element );
												this.table.data( 'selected-cells', _selected );
												jQuery.each( _selected, function () {
													this.cell.addClass( 'tve_merge_selected' );
												} );
											},
											/**
											 *
											 * @param {Boolean} [keep_selections] whether or not to preserve the selection. Defaults to false
											 */
											reset: function ( keep_selections ) {
												keep_selections = typeof keep_selections === 'undefined' ? false : keep_selections;
												if ( ! keep_selections ) {
													this.table.find( '.tve_merge_selected' ).removeClass( 'tve_merge_selected' );
												}
												this.table.find( '.tve_merge_disabled' ).removeClass( 'tve_merge_disabled' );
												this.table.data( 'selected-cells', null ).data( 'selected-colspan', null ).data( 'selected-rowspan', null );
												this.drag = {
													mouse_down: false,
													start_element: null,
													current_element: null,
													is_head: false
												};
											},
											/**
											 *
											 * @param {Boolean} [keep_selections] whether or not to preserve the selection. Defaults to false
											 */
											cancel: function ( keep_selections ) {
												keep_selections = typeof keep_selections === 'undefined' ? false : keep_selections;
												this.buttons.hide();
												this.reset( keep_selections );
												this.table.removeClass( 'tve_merge_cells tve_table_light' ).off().find( 'th, th *, td, td *' ).enableSelection();
												this.$el.removeClass( 'canvas-mode' );

												$( TVE.Editor_Page ).unbind( 'editor.onenable' );
												TVE.Editor_Page.enable();
												delete TVE.Editor_Page.GLOBAL_PREVENT_FOCUS;
												this.select_element( this.$el );

												return this;
											},
											merge: function () {
												if ( ! this.table.data( 'selected-cells' ) ) {
													return;
												}

												var $cell = $(), html = '', $toRemove = $();

												jQuery.each( this.table.data( 'selected-cells' ), function ( index ) {
													if ( index == 0 ) {
														$cell = this.cell;
													} else {
														$toRemove = $toRemove.add( this.cell );
														html += this.cell.html();
													}
												} );
												this.clearSelection();
												this.cancel();
												TVE.Editor_Page.before_action();
												var $root = $( '<div></div>' ).appendTo( $cell );
												$cell.attr( {
													rowspan: this.grid.selection_rowspan,
													colspan: this.grid.selection_colspan
												} );

												if ( this.grid.selection_rowspan > 1 || this.grid.selection_colspan > 1 ) {
													TVE.Components.table.disable_sort();
													this.table.removeClass( 'tve_make_sortable' );
												}
												TVE.drag.insert( html, $root, false, true );
												$toRemove.remove();
												TVE.Editor_Page.after_action();
												this.init();
											},
											split: function () {
												if ( ! this.table.data( 'selected-cells' ) ) {
													return;
												}
												var _selected = this.table.data( 'selected-cells' ),
													grid = this.grid;
												this.clearSelection();
												this.cancel();
												TVE.Editor_Page.before_action();
												jQuery.each( _selected, function () {
													if ( this.colspan == 1 && this.rowspan == 1 ) {
														return true;
													}
													grid.split( this );
												} );

												TVE.Editor_Page.after_action();
												this.init();
											},
											addRow: function () {
												var _rows = this.table.tve_rows(),
													_cols = this.table.tve_cols(),
													grid;

												this.table.tve_rows( _rows + 1 );
												if ( _cols === 0 ) { // no column in the table
													return;
												}
												if ( _rows === 0 ) { //no row in the table, build first the head of the table
													grid = new TVE_Table_Grid( this.head );
												} else { //to maintain the table styles, we clone the last row
													grid = new TVE_Table_Grid( this.body );
												}
												this.saveSelection();
												this.cancel();
												TVE.Editor_Page.before_action();
												grid.insertRow( grid.grid.length - 1, 'after', _cols );
												TVE.Editor_Page.after_action();
												this.alternateColors();
												this.init();
											},
											addColumn: function () {
												var _rows = this.table.tve_rows(),
													_cols = this.table.tve_cols();
												this.table.tve_cols( _cols + 1 );
												if ( _rows === 0 ) { // no row in the table
													return;
												}
												this.saveSelection();
												this.cancel();
												TVE.Editor_Page.before_action();
												if ( this.table.find( '> thead > tr' ).length ) {
													(new TVE_Table_Grid( this.head )).insertColumn( _cols - 1, 'after', this.table.find( '> thead > tr' ).length );
												}
												if ( this.table.find( '> tbody > tr' ).length ) {
													(new TVE_Table_Grid( this.body )).insertColumn( _cols - 1, 'after', _rows - this.table.find( '> thead > tr' ).length );
												}
												TVE.Editor_Page.after_action();
												this.init();
											},
											removeColumn: function () {
												if ( ! this.drag.start_element ) {
													return;
												}
												var $cell = this.drag.start_element,
													is_head = this.drag.is_head;
												this.clearSelection();
												this.cancel();
												TVE.Editor_Page.before_action();

												var refColIndex = this.grid.selection_start.col,
													removed_cols = this.grid.removeColumn( $cell );

												if ( is_head ) {
													(new TVE_Table_Grid( this.body )).removeColumn( null, refColIndex, removed_cols );
												} else {
													(new TVE_Table_Grid( this.head )).removeColumn( null, refColIndex, removed_cols );
												}
												this.table.tve_cols( this.table.tve_cols() - removed_cols );

												TVE.Editor_Page.after_action();
												this.init();
											},
											removeRow: function () {
												if ( ! this.drag.start_element ) {
													return;
												}
												var $cell = this.drag.start_element,
													grid = new TVE_Table_Grid( $cell.parent().parent() );

												this.cancel();
												this.clearSelection();
												TVE.Editor_Page.before_action();

												var rows_to_remove = grid.removeRow( $cell );
												this.table.tve_rows( this.table.tve_rows() - rows_to_remove );

												if ( $cell.is( 'th' ) ) {
													TVE.Components.table.disable_sort();
													this.table.removeClass( 'tve_make_sortable' );
												}
												TVE.Editor_Page.after_action();

												this.alternateColors();

												this.init();
											},
											insertColumn: function ( where ) {
												if ( ! this.drag.start_element ) {
													return;
												}
												this.table.tve_cols( this.table.tve_cols() + 1 );
												if ( this.table.tve_rows() == 0 ) {
													return;
												}
												var colIndex = this.grid[where == 'before' ? 'selection_start' : 'selection_end'].col;
												this.saveSelection();
												this.cancel();

												TVE.Editor_Page.before_action();
												if ( this.table.find( '> thead > tr' ).length ) {
													(new TVE_Table_Grid( this.table.find( '> thead' ) )).insertColumn( colIndex, where, this.table.find( '> thead > tr' ).length );
												}
												if ( this.table.find( '> tbody > tr' ).length ) {
													(new TVE_Table_Grid( this.table.find( '> tbody' ) )).insertColumn( colIndex, where, this.table.tve_rows() - this.table.find( '> thead > tr' ).length );
												}
												TVE.Editor_Page.after_action();

												this.init();
											},
											insertRow: function ( where ) {
												if ( ! this.drag.start_element ) {
													return;
												}
												this.table.tve_rows( this.table.tve_rows() + 1 );
												if ( this.table.tve_cols() === 0 ) {
													return;
												}
												var c = this.grid[where === 'before' ? 'selection_start' : 'selection_end'];
												this.saveSelection();
												this.cancel();

												TVE.Editor_Page.before_action();
												this.grid.insertRow( c.row, where, this.table.tve_cols(), c.col );
												TVE.Editor_Page.after_action();

												this.init();
											},
											alternateColors: function () {
												/* check if alternating colors is checked */
												if ( ! this.table.hasClass( 'tve_table_alternating' ) ) {
													return;
												}

												/* save the custom colors */
												var _odd_custom_color = this.body.find( 'tr.tve_odd' ).first().attr( 'data-tve-custom-colour' ),
													_even_custom_color = this.body.find( 'tr.tve_even' ).first().attr( 'data-tve-custom-colour' );

												/* re-assign the classes */
												this.body.find( 'tr' ).each( function ( index, tr ) {
													var $this = $( tr );
													$this.removeClass( 'tve_odd tve_even' );
													$this.addClass( index % 2 === 0 ? 'tve_odd' : 'tve_even' );
													if ( _odd_custom_color && (index % 2 === 0) ) {
														$this.attr( 'data-tve-custom-colour', _odd_custom_color );
													}
													if ( _even_custom_color && (index % 2 !== 0) ) {
														$this.attr( 'data-tve-custom-colour', _even_custom_color );
													}
												} );
											}
										};

										module.exports = cell_manager;
									})( jQuery );
								},
								"editor.js": function (exports, module, require) {
									/**
									 * Table editor plugin - manages tables inline, directly in the editor frame
									 */

									var cell_manager = require( './cell-manager' );

									/**
									 * builds a table row
									 *
									 * @param cell_tag
									 * @param cols
									 *
									 * @return {String} html code for a table row
									 */
									function table_row( cell_tag, cols ) {
										var html = '';
										for ( var i = 0; i < cols; i ++ ) {
											html += '<' + cell_tag + ' class="tve_table_cell"></' + cell_tag + '>';
										}

										return '<tr class="tve_table_row">' + html + '</tr>';
									}

									var table = {
										/**
										 * enter a cell manager state
										 */
										cell_manager: function ( $element ) {
											return cell_manager.init( $element.find( '> .tve_table' ) );
										},
										/**
										 * Builds an empty table with rows rows and cols cols
										 *
										 * @param rows
										 * @param cols
										 *
										 * @returns {String} html for the table
										 */
										build: function ( rows, cols ) {
											var table = '<table data-rows="' + rows + '" data-cols="' + cols + '" class="tve_table tcb-fixed tve_no_inner_border tve_no_border tve_table_flat">';

											/* table head */
											table += '<thead>' + table_row( 'th', cols ) + '</thead>';

											/* table body */
											table += '<tbody>';
											for ( var i = 1; i < rows; i ++ ) {
												table += table_row( 'td', cols );
											}
											table += '</tbody></table>';

											return table;
										},
										/**
										 * Refresh edit buttons positions
										 */
										refresh: function () {
											cell_manager.positionButtons();
										},
										close_editor: function () {
											cell_manager.cancel();
										}
									};

									module.exports = table;
								},
								"grid.js": function (exports, module, require) {
									(function ( $ ) {
										function _rowspan( col ) {
											col = col.jquery ? col[0] : col;

											return parseInt( col.getAttribute( 'rowspan' ) || 1 );
										}

										function _colspan( col ) {
											col = col.jquery ? col[0] : col;

											return parseInt( col.getAttribute( 'colspan' ) || 1 );
										}

										function __cell( head ) {
											return head ? '<th class="tve_table_cell"></th>' : '<td class="tve_table_cell"></td>';
										}

										function _clone( $cell ) {
											return $cell.clone().removeAttr( 'data-css' ).removeAttr( 'style' ).html( '' );
										}

										/**
										 * map a grid over the table, this makes it easier to select multiple cells when rowspan / colspan attributtes are involved
										 *
										 * @param {jQuery} rowContainer can be either head or body
										 * @param {Boolean} update_counts whether or not to update the data- attributes of the table with the actual number of rows / cols
										 */
										var TVE_Table_Grid = function ( rowContainer, update_counts ) {

											var grid = [],
												td, total_cols = 0;

											rowContainer.find( '> tr' ).each( function ( i ) {
												$( this ).find( '> td, > th' ).each( function ( j ) {
													var x, y, rowspan, colspan, $td = $( this );

													/* it's possible that row is populated from previous rowspan cells */
													if ( grid[i] ) {
														while ( grid[i][j] ) {
															j ++;
														}
													}

													rowspan = _rowspan( this );
													colspan = _colspan( this );

													for ( y = i; y < i + rowspan; y ++ ) {
														if ( ! grid[y] ) {
															grid[y] = [];
														}

														for ( x = j; x < j + colspan; x ++ ) {
															grid[y][x] = {
																cell: $td,
																rowspan: rowspan,
																colspan: colspan,
																exists: y == i && x == j,
																processed: false,
																real_row: i,
																real_col: j
															};
														}
													}
												} );
											} );

											this.grid = grid;
											this.startPos = null;
											this.selection_colspan = 1;
											this.selection_rowspan = 1;
											this.container = rowContainer;
											this.is_head = rowContainer.is( 'thead' );
											this.selection_start = {
												row: null,
												col: null
											};
											this.selection_end = {
												row: null,
												col: null
											};
											/* update the data-rows and data-cols attributes of the table with the newly detected counts */
											if ( typeof update_counts !== 'undefined' && update_counts ) {
												rowContainer.parent().tve_rows( parseInt( rowContainer.parent().tve_rows() ) + this.grid.length );
												if ( this.grid[0] && this.grid[0].length ) { // wild case: when there is no column / row, the count should be the maximum value of the head / body
													rowContainer.parent().tve_cols( this.grid[0].length );
												}
											}
										};

										/**
										 * get a range of selected cells
										 * @param jQuery startCell
										 * @param jQuery endCell
										 */
										TVE_Table_Grid.prototype.getRange = function ( startCell, endCell ) {

											var start = this.startPos, end = this.getCellPosition( endCell );
											if ( ! start || ! end ) {
												return $();
											}
											var minRow = Math.min( start.x, end.x ),
												maxRow = Math.max( start.x, end.x ),
												minCol = Math.min( start.y, end.y ),
												maxCol = Math.max( start.y, end.y ),
												endCol = maxCol,
												endRow = maxRow,
												i = 0, j, item, found = false;

											//reset processed state of each cell
											for ( var i = 0, row; row = this.grid[i ++]; ) {
												for ( var j = 0, item; item = row[j ++]; ) {
													item.processed = false;
												}
											}

											do {
												found = false;
												// case: cells in first selected row have colspan
												i = minRow;
												while ( i <= endRow ) {
													item = this.grid[i][minCol];
													i += item.rowspan;
													if ( item.processed || item.exists ) {
														continue;
													}
													if ( item.colspan > 1 ) {
														minCol = item.real_col;
														found = true;
														item.processed = true;
													}
												}
												// case: cells in first selected column have rowspan
												j = minCol;
												while ( j <= endCol ) {
													item = this.grid[minRow][j];
													j += item.colspan;
													if ( item.processed || item.exists ) {
														continue;
													}
													if ( item.rowspan > 1 ) {
														minRow = item.real_row;
														found = true;
														item.processed = true;
													}
												}
												//expand the rest of the selection with colspan / rowspan values
												for ( i = minRow; i <= endRow; i ++ ) {
													for ( j = minCol; j <= endCol; j ++ ) {
														item = this.grid[i][j];
														if ( ! item.exists || item.processed ) {
															continue;
														}
														if ( item.colspan > 1 && item.colspan - 1 + j > endCol ) {
															endCol = j + item.colspan - 1;
															found = true;
															item.processed = true;
														}
														if ( item.rowspan > 1 && item.rowspan - 1 + i > endRow ) {
															endRow = i + item.rowspan - 1;
															found = true;
															item.processed = true;
														}
													}
												}
											} while ( found );

											var list = [];
											for ( i = minRow; i <= endRow; i ++ ) {
												for ( j = minCol; j <= endCol; j ++ ) {
													if ( this.grid[i][j] && this.grid[i][j].exists ) {
														list.push( this.grid[i][j] );
													}
												}
											}

											this.selection_rowspan = endRow - minRow + 1;
											this.selection_colspan = endCol - minCol + 1;

											this.selection_start.row = minRow;
											this.selection_start.col = minCol;
											this.selection_end.row = endRow;
											this.selection_end.col = endCol;

											return list;
										};

										TVE_Table_Grid.prototype.getCellPosition = function ( cell ) {
											for ( var i = 0, rl = this.grid.length; i < rl; i ++ ) {
												for ( var j = 0, cl = this.grid[i].length; j < cl; j ++ ) {
													if ( this.grid[i][j]['cell'][0] === cell[0] ) {
														return {
															x: i,
															y: j
														};
													}
												}
											}
											return null;
										};

										TVE_Table_Grid.prototype.setStartCell = function ( cell ) {
											this.startPos = this.getCellPosition( cell );
										};

										/**
										 * split a cell from the table
										 * @param item
										 */
										TVE_Table_Grid.prototype.split = function ( item ) {
											var $clone = null;
											item.cell.attr( 'colspan', 1 ).attr( 'rowspan', 1 );

											// fill in cells to the right in the same row
											for ( var i = 1; i < item.colspan; i ++ ) {
												$clone = _clone( item.cell );
												item.cell.after( $clone );
												TVE.drag.bind_draggable( $clone );
											}

											if ( item.rowspan == 1 ) {
												return;
											}
											//cells for the rows below
											var tr = item.cell.parent();
											for ( var row = item.real_row + 1; row < item.real_row + item.rowspan; row ++ ) {
												tr = tr.next( 'tr' );
												if ( tr.find( '> td, > th' ).length == 0 ) {
													//this means that all cells from the previous row have rowspan that's covering this row
													for ( var c = 0; c < item.colspan; c ++ ) {
														$clone = _clone( item.cell );
														tr.append( $clone );
														TVE.drag.bind_draggable( $clone );
													}
													continue;
												}
												//find the first cell to the left without rowspan from the current row
												for ( var j = item.real_col - 1; j >= 0; j -- ) {
													if ( this.grid[row][j].real_row == row ) {
														for ( var c = 0; c < item.colspan; c ++ ) {
															$clone = _clone( item.cell );
															this.grid[row][j].cell.after( $clone );
															TVE.drag.bind_draggable( $clone );
														}
														break;
													}
												}
												if ( item.real_col == 0 || j == - 1 ) {
													//no cell found to the left -> insert the clone before the first cell from the row
													for ( var c = 0; c < item.colspan; c ++ ) {
														$clone = _clone( item.cell );
														tr.prepend( $clone );
														TVE.drag.bind_draggable( $clone );
													}
												}
											}
										};

										/**
										 * remove column by index from table
										 * @param jQuery cell optional
										 * @param colIndex
										 * @param cols_to_remove
										 */
										TVE_Table_Grid.prototype.removeColumn = function ( $cell, colIndex, cols_to_remove ) {
											if ( $cell ) {
												cols_to_remove = _colspan( $cell )
												colIndex = (this.getCellPosition( $cell )).y;
											}

											for ( var i = 0, row; row = this.grid[i ++]; ) {
												for ( var col = colIndex; col < colIndex + cols_to_remove; col ++ ) {
													var item = row[col];
													if ( item.colspan == 1 || ($cell && item.cell[0] === $cell[0]) ) {
														item.cell.remove();
														continue;
													}
													if ( item.real_col >= colIndex && item.real_col + item.colspan <= colIndex + cols_to_remove ) {
														item.cell.remove();
														continue;
													}

													if ( item.colspan > 1 ) {
														if ( item.real_col <= colIndex ) {
															if ( item.real_col + item.colspan >= colIndex + cols_to_remove ) {
																item.cell.attr( 'colspan', item.colspan - cols_to_remove );
															} else {
																item.cell.attr( 'colspan', Math.abs( colIndex - item.real_col ) );
															}
														} else {
															item.cell.attr( 'colspan', item.real_col + item.colspan - colIndex - cols_to_remove );
														}
													} else {
														item.cell.remove();
													}
												}

											}
											return cols_to_remove;
										};

										/**
										 * remove row by index from table
										 * @param jQuery $cell
										 */
										TVE_Table_Grid.prototype.removeRow = function ( $cell ) {

											var rowsToRemove = _rowspan( $cell ),
												coords = this.getCellPosition( $cell ),
												$toRemove = $();

											//first, split all possible rowspans that might be in the rows marked for deletion
											for ( var i = coords.x; i <= coords.x + rowsToRemove - 1; i ++ ) {
												for ( var j = 0; j < this.grid[coords.x].length; j ++ ) {
													var item = this.grid[i][j];
													if ( j == coords.y || _rowspan( item.cell ) == 1 ) {
														$toRemove = $toRemove.add( this.container.find( '> tr:nth-child(' + (i + 1) + ')' ) );
														continue;
													}

													if ( ! item.exists ) {
														item.cell.attr( 'rowspan', _rowspan( item.cell ) - 1 );
														j += _colspan( item.cell ) - 1;
													} else {
														if ( _rowspan( item.cell ) + i <= coords.x + rowsToRemove ) {
															// ok, the whole row will be removed eventually
														} else {
															// "trim" the cell by cloning it, moving it to the next row, and decrement the rowspan
															var diff_rowspan = coords.x + rowsToRemove - i;
															var clone = _clone( item.cell ).attr( 'rowspan', _rowspan( item.cell ) - diff_rowspan );
															item.cell.attr( 'rowspan', diff_rowspan );

															//append the clone to the next tr
															var tr = $cell.parent().next(),
																row = coords.x + rowsToRemove;
															//if it's on the last row, there is nothing left to do
															if ( tr.length > 0 ) {
																if ( tr.find( '> td, > th' ).length == 0 ) {
																	//this means that all cells from the previous row have rowspan that's covering this row
																	tr.append( clone );
																}
																//find the first cell to the left without rowspan from the current row
																for ( var col = item.real_col - 1; col >= 0; col -- ) {
																	if ( this.grid[row][col].real_row == row ) {
																		this.grid[row][col].cell.after( clone );
																		break;
																	}
																}
																if ( item.real_col == 0 || col == - 1 ) {
																	//no cell found to the left -> insert the clone before the first cell from the row
																	tr.prepend( clone );
																}
															}
														}
													}
												}
											}
											$toRemove.remove();
											return rowsToRemove;
										};

										/**
										 * add another cell to the end of each row
										 *
										 * @param refColIndex - reference col for the target cell
										 * @param where - 'before' or 'after'
										 * @param number_of_rows
										 */
										TVE_Table_Grid.prototype.insertColumn = function ( refColIndex, where, number_of_rows ) {
											var _cell = __cell( this.is_head ),
												hasCells = this.grid[0] && this.grid[0].length,
												$inserted = $();

											for ( var i = 0; i < number_of_rows; i ++ ) {
												var item = (hasCells ? this.grid[i][refColIndex] : null),
													$tr;
												if ( ! item ) {
													$tr = this.container.find( '> tr:nth-child(' + (i + 1) + ')' );
													$tr = $tr.length ? $tr : $( '<tr class="tve_table_row"></tr>' ).appendTo( this.container );
													$inserted = $inserted.add( $( _cell ) );
													$tr.append( $inserted.last() );
													continue;
												}
												var $clone = _clone( item.cell ).attr( 'colspan', '1' ).attr( 'rowspan', '1' ),
													$tr = this.getRealRow( i ),
													colspanSet = false;

												if ( refColIndex == this.grid[0].length - 1 && where == 'after' ) { //row is empty or index is the last col and we insert after
													$tr.append( $clone );
													$inserted = $inserted.add( $clone );
													continue;
												}
												//if index is 0 and we insert before: prepend
												if ( refColIndex == 0 && where == 'before' ) {
													$tr.prepend( $clone );
													$inserted = $inserted.add( $clone );
													continue;
												}

												if ( item.colspan > 1 ) {
													if ( where == 'after' && item.real_col + item.colspan - 1 > refColIndex ) { // we have 2 cases: if the actual cell is the target of the operation -> insert after; if the cell is not on the row of the operation -> increase colspan
														item.cell.attr( 'colspan', item.colspan + 1 );
														colspanSet = true;
													} else if ( where == 'before' && item.real_col < refColIndex ) {
														item.cell.attr( 'colspan', item.colspan + 1 );
														colspanSet = true;
													}
												}
												if ( ! colspanSet ) {
													item = where == 'after' ? this.getLastRealCell( i, refColIndex ) : this.getNextRealCell( i, refColIndex );
													var fn = where;

													if ( item === null ) {
														item = where == 'after' ? this.getNextRealCell( i, refColIndex ) : this.getLastRealCell( i, refColIndex );
														fn = where == 'after' ? 'before' : 'after';
													}
													if ( item === null ) { // this means that there is no actual cell in $tr => append it to the TR
														$tr.append( $clone );
														$inserted = $inserted.add( $clone );
														continue;
													}
													item.cell[fn]( $clone );
													$inserted = $inserted.add( $clone );
												} else {
													i += item.rowspan - 1;
												}
											}

											TVE.drag.bind_draggable( $inserted );
										};

										/**
										 * insert new row in the table, before or after the row specified by refRowIndex
										 *
										 * @param refRowIndex
										 * @param where
										 * @param number_of_cols
										 */
										TVE_Table_Grid.prototype.insertRow = function ( refRowIndex, where, number_of_cols ) {
											var _cell = __cell( this.is_head ),
												_newRow = $( '<tr class="tve_table_row"></tr>' );

											if ( refRowIndex === - 1 ) {
												for ( var i = 0; i < number_of_cols; i ++ ) {
													_newRow.append( $( _cell ) );
												}
												this.container.append( _newRow );
												return;
											}

											var $tr = this.getRealRow( refRowIndex ),
												_cells = $();

											for ( var j = 0; j < number_of_cols; j ++ ) {
												var item = this.grid[refRowIndex][j],
													rowspanSet = false;

												if ( item.rowspan > 1 ) {
													if ( where == 'after' && item.real_row + item.rowspan - 1 > refRowIndex ) {
														item.cell.attr( 'rowspan', item.rowspan + 1 );
														rowspanSet = true;
													} else if ( where == 'before' && item.real_row < refRowIndex ) {
														item.cell.attr( 'rowspan', item.rowspan + 1 );
														rowspanSet = true;
													}
												}
												if ( ! rowspanSet ) {
													_cells = _cells.add( _clone( this.grid[refRowIndex][j].cell ).attr( {
														rowspan: 1,
														colspan: 1
													} ) );
												}
											}
											$tr[where]( _newRow.append( _cells ) );

											TVE.drag.bind_draggable( _newRow );
										};

										/**
										 * get the real row (jquery object) for rowIndex
										 * @param rowIndex
										 */
										TVE_Table_Grid.prototype.getRealRow = function ( rowIndex ) {
											if ( ! this.grid[rowIndex] ) {
												return $();
											}
											for ( var col = 0, item; item = this.grid[rowIndex][col ++]; ) {
												if ( item.real_row == rowIndex ) {
													return item.cell.parent();
												}
											}
											/* at this point, it must be that there's no real column in this row, we might as well return the row */
											return this.container.find( 'tr:nth-child(' + (++ rowIndex) + ')' );
										};

										/**
										 * get the last real cell starting from colIndex and going to the left
										 * @param rowIndex
										 * @param colIndex
										 */
										TVE_Table_Grid.prototype.getLastRealCell = function ( rowIndex, colIndex ) {
											if ( ! this.grid[rowIndex] ) {
												return null;
											}
											for ( var col = colIndex; col >= 0; col -- ) {
												if ( this.grid[rowIndex][col].real_row == rowIndex && this.grid[rowIndex][col].real_col == col ) {
													return this.grid[rowIndex][col];
												}
											}
											return null;
										};

										/**
										 * get the next real cell starting from colIndex and going to the right
										 * @param rowIndex
										 * @param colIndex
										 */
										TVE_Table_Grid.prototype.getNextRealCell = function ( rowIndex, colIndex ) {
											if ( ! this.grid[rowIndex] ) {
												return null;
											}
											for ( var col = colIndex, len = this.grid[rowIndex].length; col < len; col ++ ) {
												if ( this.grid[rowIndex][col].real_row == rowIndex && this.grid[rowIndex][col].real_col == col ) {
													return this.grid[rowIndex][col];
												}
											}
											return null;
										};

										/**
										 * get the number of rows from this container
										 */
										TVE_Table_Grid.prototype.getRowCount = function () {
											return this.grid.length;
										};

										/**
										 * get the number of columns from this container
										 */
										TVE_Table_Grid.prototype.getColCount = function () {
											if ( ! this.grid[0] ) {
												return 0;
											}
											return this.grid[0].length;
										};

										/**
										 *
										 * @param {Number} rowIndex
										 * @param {Number} colIndex
										 *
										 * @return jQuery
										 */
										TVE_Table_Grid.prototype.getCell = function ( rowIndex, colIndex ) {
											return this.grid[rowIndex][colIndex].cell;
										};

										module.exports = TVE_Table_Grid;

									})( jQuery );
								}
							}
						}
					}
				}
			}
		}
	}
})("workspace/editor/js/editor/src/editor");
